<!DOCTYPE html>
<html>
<head>
    <title>Fourier Transform</title>
    <meta charset="UTF-8">
    <link rel="icon" type="image/jpg" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=">
</head>
<body>
<script>
window.onload = start;

    var gl = null;
    var cnvs0 = null;
    var ext0;
    var ext1;
    var ext2;
    var vxSh8a;
    var frSh8a;
    var frSh8c;
    var frSh8fun;
    var vxSh9a;
    var frSh9b;
    var frSh9bfun;
    var frSh9g;
    var frSh9fun;
    var frSh9funTitle;
    var shaderCreator;
    var shaderP0;
    var shdVtx0;
    var shdMtx0;
    var shdTex0;
    var shaderP0b;
    var shdVtx0b;
    var shdMtx0b;
    var shaderP0c;
    var shdVtx0c;
    var shdMtx0c;
    var shaderP1;
    var shdVtx1;
    var shdMtx1;
    var shdTex1;
    var shaderP2;
    var shdVtx2;
    var shdMtx2;
    var shdTex2;
    var shaderP2b;
    var shdVtx2b;
    var shdMtx2b;
    var shaderP3;
    var shdVtx3;
    var shdMtx3;
    var shaderP4;
    var shdVtx4;
    var shdMtx4;
    var shaderP5a;
    var shdVtx5a;
    var shdMtx5a;
    var shaderP5b;
    var shdVtx5b ;
    var shdMtx5b ;
    var shdTex5b ;
    var shaderP5c;
    var shdVtx5c ;
    var shdMtx5c ;
    var shdTex5c ;
    var shaderP6a;
    var shdVtx6a ;
    var shdMtx6a ;
    var shaderP6b;
    var shdVtx6b ;
    var shdMtx6b ;
    var shaderP6c;
    var shdVtx6c ;
    var shdMtx6c ;
    var shaderP6d;
    var shdVtx6d ;
    var shdMtx6d ;
    var shaderP6e;
    var shdVtx6e ;
    var shdMtx6e ;
    var shdTex6e ;
    var shaderP6f;
    var shdVtx6f ;
    var shdMtx6f ;
    var shdTex6f ;
    var shaderP6g;
    var shdVtx6g ;
    var shdMtx6g ;
    var shaderP7a1;
    var shdVtx7a1 ;
    var shdMtx7a1 ;
    var shdTex7a1 ;
    var shaderP7a2;
    var shdVtx7a2 ;
    var shdMtx7a2 ;
    var shdTex7a2 ;
    var shaderP7b;
    var shdVtx7b ;
    var shdMtx7b ;
    var shdTex7b ;
    var shaderP7c;
    var shdVtx7c ;
    var shdMtx7c ;
    var shdTex7c ;
    var shaderP7d;
    var shdVtx7d ;
    var shdMtx7d ;
    var shdTex7d ;
    var shaderP8a;
    var shdVtx8a ;
    var shdMtx8a ;
    var shdTex8a0;
    var shdTex8a1;
    var shaderP8b;
    var shdVtx8b ;
    var shdMtx8b ;
    var shdTex8b0;
    var shdTex8b1;
    var shaderP8c;
    var shdVtx8c ;
    var shdMtx8c ;
    var shdTex8c ;
    var shaderP9a;
    var shdVtx9a ;
    var shdMtx9a ;
    var shdTex9a0;
    var shdTex9a1;
    var shaderP9b;
    var shdVtx9b ;
    var shdMtx9b ;
    var shdTex9b ;
    var iniShdr9b;
    var shaderP9c;
    var shdVtx9c ;
    var shdMtx9c ;
    var shdTex9c ;
    var shaderP9d;
    var shdVtx9d ;
    var shdMtx9d ;
    var shdTex9d0;
    var shdTex9d1;
    var shdTex9d2;
    var shdTex9d3;
    var shaderP9e;
    var shdVtx9e ;
    var shdMtx9e ;
    var shdTex9e ;
    var shaderP9f;
    var shdVtx9f ;
    var shdTex9f ;
    var iniShdr9g;
    var iniRndrStps9g;
    var shaderP9k;
    var shdVtx9k ;
    var shdTex9k4;
    var shdTex9k5;
    var shdTex9k6;
    var shdTex9k7;
    var shdTex9k8;
    var shdTex9k9;
    var shdTex9k10;
    var shdTex9k11;
    var meshBuff;
    var textMode ;
    var texCreator;
    var tex0;
    var tex1;
    var tex2;
    var frameBuffCreator;
    var shdMtx ;
    var shdMtxB;
    var resizeWindow;
    function start()
    {
        document.body.style.touchAction = "none";
        document.body.style.margin = "0px";
        document.body.style.fontFamily = "consolas";
        document.body.style.background = "rgb(229,229,229)";

        startWebGL();
        interface1();
        interface2();
        interface3();
        interface4();
        //interface5();
        interface6();
        interface8();
        interface7();
        interface9();
 
        resizeWindow = function()
        {
            //render1Gl();
            //render2Gl();
            //render3Gl();
            //render3bGl();
            //render4Gl();
            //render5aGl();
            //render5bGl();
            render6aGl();
            render6bGl();
            render6cGl();
            render6dGl();
            cirTbl2();//render6eGl();
            cirTbl3();//render6fGl();
            render7bGl();
            ft2D7c();
            ft2D7d();
            rendC9GL();
        }
        window.onresize = resizeWindow;
    }
    function startWebGL()
    {
        cnvs0 = document.createElement("canvas");
        //cnvs0.style.position = "absolute";
        //document.body.appendChild(cnvs0);

        gl = cnvs0.getContext("webgl",{ alpha: false,
                                        antialias: false,
                                        depth: true,
                                        stencil: false,
                                        premultipliedAlpha: true,
                                        //preserveDrawingBuffer: false,
                                        //failIfMajorPerformanceCaveat: false
                                        });
        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);
        gl.disable(gl.BLEND);
        gl.depthFunc(gl.GEQUAL);
        gl.enable(gl.DEPTH_TEST);

        ext0 = gl.getExtension('OES_texture_float');
        ext1 = gl.getExtension('WEBGL_color_buffer_float');
        ext2 = gl.getExtension('EXT_float_blend');

        //shaders
        let vxSh0 =
        `precision highp float;
        attribute float vtx;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec4 u;
        void main()
        {
            float f = fract(vtx);
        	vec2 s = vec2(0.,-1.);
        	if(f == .25){s.y = 2.;}
        	if(f == .5){s.x = 1.732;}
        	if(f == .75){s.x = -1.732;}
            float r = mtx[2].x;
            vec2 t = vec2(mod(vtx,r), floor(vtx/r)+.5);
            vec4 p = texture2D(tex,t/r).xyzw;
            u = vec4(s,p.z,f-.5);
            s*=2.; if(p.z>.5) s*=1.5;
            t = ((s+p.xy)-mtx[1].xy)*mtx[1].z*vec2(mtx[1].w,1.);
            gl_Position = vec4(t,1.,1.)*.5;
        }`;
        let frSh0 =
        `precision highp float;
        varying vec4 u;
        void main()
        {
            float l = length(u.xy);
            if(l > 1.){discard;}
            float a = u.z;
            float f = u.w;
            vec3 b = .5+.5*cos(a+f*2.+.5+vec3(.0,.6,1.2));
            if(a>0.5) b = vec3(.9,.3,.3)+f;
            if(a>1.5) b = vec3(.3,.9,.3)+f;
            if(a>2.5) b = vec3(.3,.3,.9)+f;
            gl_FragColor = vec4(b,6.-l*6.);
        }`;
        let vxSh0b =
        `precision highp float;
        attribute float vtx;
        varying vec2 uv;
        void main()
        {
            vec4 a = vec4(-1.,1.,1.,1.);
            if(vtx == .50)  a.x = 3.;
            if(vtx == .75)  a.y =-3.;
            uv = a.xy*.5+.5;
            gl_Position = a*.5;
        }`;
        let frSh0b =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec2 u = uv;
            float pi2 = 6.28318530718;
    
            float c = .1;
            vec2 v;
            float a;
            float xmx = 308.;
            float ymx = 8.;
            float camz = 130.;
            vec2 camw = vec2(900./1200.,1.);
            
            float fq0 = mtx[0].x;   float fq1 = mtx[3].x;
            float ph0 = mtx[0].y;   float ph1 = mtx[3].y;
            float ps0 = mtx[0].z;   float ps1 = mtx[3].z;
            float wd0 = mtx[0].w;   float wd1 = mtx[3].w;
            
            v = vec2(-xmx*.5,98.)/camz*camw* .5 + .5;
            v = (u-v)*vec2(1./(1.-v.x*2.),2.*camz);
            a = sin(v.x*fq0 + ph0)*ymx*exp( pow(v.x-ps0,2.)*-wd0 );
            a = v.y-a;
            a = .5-abs(a)*.5;
            c+= max(a,0.);

            v = vec2(-xmx*.5,67.)/camz*camw* .5 + .5;
            v = (u-v)*vec2(1./(1.-v.x*2.),2.*camz);
            a = sin(v.x*fq1 + ph1)*ymx*exp( pow(v.x-ps1,2.)*-wd1 );
            a = v.y-a;
            a = .5-abs(a)*.5;
            c+= max(a,0.);

            v = vec2(-xmx*.5,32.)/camz*camw* .5 + .5;
            v = (u-v)*vec2(1./(1.-v.x*2.),2.*camz);
            a = sin(v.x*fq0 + ph0)*ymx*exp( pow(v.x-ps0,2.)*-wd0 ) +
                sin(v.x*fq1 + ph1)*ymx*exp( pow(v.x-ps1,2.)*-wd1 );
            a = v.y-a;
            a = .5-abs(a)*.5;
            c+= max(a,0.);
            
            if(v.x >= 1. || v.x < 0. || mtx[2].w!=0.) c = .1;
            
            gl_FragColor = vec4(.1,.1,c,1.);
        }`;
        let vxSh0c =
        `precision highp float;
        attribute float vtx;
        varying vec2 uv;
        void main()
        {
            vec4 a = vec4(-1.,1.,1.,1.);
            if(vtx == .50)  a.x = 3.;
            if(vtx == .75)  a.y =-3.;
            uv = a.xy;
            gl_Position = (a*vec4(.4,.1,1.,1.)-vec4(.52,.15,0.,0.))*.5;
        }`;
        let frSh0c =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        float ob(vec3 p)
        {
            #define pi 3.1415926535897932384626433832795
            vec2 r;
            
            float r1 = -mtx[2].z*pi*.5;
            
            r = cos(r1-vec2(0.,pi*.5));
            p = mat3( r.x,0.,r.y,
                       0.,1.,0.,
                     -r.y,0.,r.x)*p;
            
            r = cos(-r1+(p.x+70.)*mtx[2].z*mtx[2].y*.029*pi*.5-vec2(0.,pi*.5));
            p = mat3( 1.,  0., 0.,
                      0., r.x,r.y,
                      0.,-r.y,r.x)*p;

            p.x = abs(p.x)-36.;
            p.x =-abs(p.x)+20.;
            p.y-=4.;
            
            mat3 m = mat3( cos(.9),sin(.9), 0.,
                          -sin(.9),cos(.9), 0.,
                          0., 0., 1.);
            mat3 n = mat3( cos(.6),sin(.6), 0.,
                          -sin(.6),cos(.6), 0.,
                          0., 0., 1.);
            mat3 o = mat3( cos(.2),sin(.2), 0.,
                          -sin(.2),cos(.2), 0.,
                          0., 0., 1.);
            
            vec3 a = max(abs(   p-vec3( 0., 0.,0.) )-vec3(6.,0.,0.),0.);
            vec3 b = max(abs(   p-vec3( 6.,-4.,0.) )-vec3(0.,4.,0.),0.);
            vec3 c = max(abs(   p-vec3( 9.,-8.,0.) )-vec3(3.,0.,0.),0.);
            vec3 d = max(abs(   p-vec3(-8., 3.,0.) )-vec3(0.,0.,3.),0.);
            vec3 e = max(abs(m*(p-vec3( 9.,-4.,0.)))-vec3(5.,0.,0.),0.);
            vec3 f = max(abs(n*(p-vec3( 0.,-4.,0.)))-vec3(7.,0.,0.),0.);
            vec3 g = max(abs(o*(p-vec3(-7.,-3.,0.)))-vec3(0.,6.,0.),0.);
            vec3 h = p-vec3(2.,-8.,0.);
                 h.x = abs(h.x)-11.;
                 h.xy = vec2(0.,length(h.xy)-5.);

            float l =       length(a)-1. ;
                  l = min(l,length(b)-1.);
                  l = min(l,length(c)-1.);
                  l = min(l,length(d)-1.);
                  l = min(l,length(e)-1.);
                  l = min(l,length(f)-1.);
                  l = min(l,length(g)-1.);
                  l = min(l,length(h)-1.);
            
            return l;
        }
        void main()
        {
            vec2 u = abs(uv); if(max(u.x,u.y)>1.){discard;}
                 u = uv*vec2(4.*12./9.,1.)*.19;
            vec3 l = vec3(0.,0.,1.);
            vec3 p = vec3(71.*u,-120.);
            float d = 0.;
            for (int i = 0; i < 40; ++i)
            {
                d = ob(p);
                p += d*l;
            }
            vec3 n = vec3(.1);
            if(d<1.)
            {
                float a = ob(p);
                n = normalize(vec3(
                      ob(p+vec3(.001,0.,0.)) - a,
                      ob(p+vec3(0.,.001,0.)) - a,
                      ob(p+vec3(0.,0.,.001)) - a)); 
            }
        	gl_FragColor = vec4(abs(n),1.0);
        }`;
        let vxSh1 =
        `precision highp float;
        attribute float vtx;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        void main()
        {
            float f = fract(vtx);
        	vec2 s = vec2(0.,-1.);
        	if(f == .25){s.y = 2.;}
        	if(f == .5){s.x = 1.732;}
        	if(f == .75){s.x = -1.732;}
            float r = mtx[2].x;
            vec2 t = vec2(mod(vtx,r), floor(vtx/r)+.5);
            vec4 p = texture2D(tex,t/r).xyzw;
            uv = s;
            v0 = p+f*vec4(0.,0.,0.,1.);
            t = ((s+p.xy)-mtx[1].xy)*mtx[1].z*vec2(mtx[1].w,1.);
            gl_Position = vec4(t,p.z,1.)*.5;
        }`;
        let frSh1 =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        float sgnz(float a)
        {
            float b = 0.;
            if(a > .001) b = 1.;
            if(a <-.001) b =-1.;
            return b;
        }
        void main()
        {
            vec2 u = abs(uv);
            float l = length(uv);

            float id = v0.w;
            
            float n = mtx[2].y;
            float nv = 1./n;
            float i = floor(id/(n*n));
            if((i <  4. && (u.x > .5 || u.y > .5)) ||
               (i == 4. && (u.x > .7 || u.y > .7)) ||
               (i == 5. && l>.7)) discard;

            float x = floor(mod(id,n));
            float y = floor(mod(id,n*n)*nv);

            float pi2 = 6.28318530718;

            float s = float(i == 1. || i == 3.);
            
            float a = pi2*x*y*nv;
                  a-= pi2*.25 * s;
                  a = cos(a);
            if(i == 0. || i == 1.) a = abs(a);
            if(i == 2. || i == 3.) a = sgnz(a);
            if(i == 4.)            a = .5*(x+y)*nv;
            if(i == 5.)            a = .3+fract(id);

            vec3 b = mix(vec3(.3,.3,.9),
                         vec3(.3,.9,.3),a);
            vec3 c = mix(vec3(.2,.2,.2),
                         vec3(.8,.8,.8),a*.5+.5);
            if(i == 0. || i == 1.) b = b;
            if(i == 2. || i == 3.) b = c;
            
            c = mix(b, vec3(1.), max(222.*(.2-l)*nv,0.)*float(v0.z>.5));

            if(i == 5.) {l = 222.*(.7-l)*nv;}
            else        {l = 1.;}

            gl_FragColor = vec4(c,l);
        }`;
        let vxSh2 =
        `precision highp float;
        attribute float vtx;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        void main()
        {
            float f = fract(vtx);
        	vec2 s = vec2(0.,-1.);
        	if(f == .25){s.y = 2.;}
        	if(f == .5){s.x = 1.732;}
        	if(f == .75){s.x = -1.732;}
            float r = mtx[2].x;
            vec2 t = vec2(mod(vtx,r), floor(vtx/r)+.5);
            vec4 p = texture2D(tex,t/r).xyzw;
            uv = s;
            v0 = p+f*vec4(0.,0.,0.,1.);
            t = ((s+p.xy)-mtx[1].xy)*mtx[1].z*vec2(mtx[1].w,1.);
            gl_Position = vec4(t,1.,1.)*.5;
        }`;
        let frSh2 =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        float sgnz(float a)
        {
            float b = 0.;
            if(a > .001) b = 1.;
            if(a <-.001) b =-1.;
            return b;
        }
        void main()
        {
            vec2 u = abs(uv);

            float id = v0.w;
            
            float n = mtx[2].y;
            float i = floor(id/(n*n));
            if(u.x > .5 || u.y > .5) discard;

            float x = floor(mod(id,n));
            float y = floor(mod(id,n*n)/n);

            float pi2 = 6.28318530718;

            float s = float(i == 1. || i == 3.);
            
            float a = pi2*x*y/n;
                  a-= pi2*.25 * s;
                  a = cos(a);
            if(i == 0. || i == 1.) a = abs(a);
            if(i == 2. || i == 3.) a = sgnz(a);

            vec4 b = mix(vec4(.3,.3,.9,1.),
                         vec4(.3,.9,.3,1.),a);
            vec4 c = mix(vec4(.2,.2,.2,1.),
                         vec4(.8,.8,.8,1.),a*.5+.5);
            if(i == 0. || i == 1.) b = b;
            if(i == 2. || i == 3.) b = c;

            gl_FragColor = b;
        }`;
        let vxSh2b =
        `precision highp float;
        attribute float vtx;
        varying vec2 uv;
        void main()
        {
            vec4 a = vec4(-1.,1.,0.,1.);
            if(vtx == .50)  a.x = 3.;
            if(vtx == .75)  a.y =-3.;
            uv = a.xy*.5+.5;
            gl_Position = a*.5;
        }`;
        let frSh2b =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec2 u = uv;
            float pi2 = 6.28318530718;
    
            vec2 k = u*2.;
            vec2 kf = fract(k);
            
            bool o1 = k.x< 1.;//math sin-cos
            bool o2 = k.y>=1.;//wave line-gradient
            
            float n = mtx[0].x;
            
            u = kf*1.1-vec2(!o1,o2)*.1;
            
            vec2 v = u*n;
            vec2 fl = floor(v);
            vec2 fr = fract(v);
            
            float y = (fr.y*2.-1.)*2.;
            float x = u.x*pi2*(n-fl.y-1.);
            
            float a = 0.;
            
            if(o1) a = cos(x);
            else   a = sin(x);
            
            float a1 = y-a;
                  a1 = 8.*(.125-abs(a1));
                  a1 = max(a1,0.);
            if(o2) a = a1;

            float b = fract(v.x*.5);
                  b = float(b<.5)*.1+.2;
            
            vec4 c = vec4(b);
            
            vec4 c1 = mix(vec4(.4,.4,.9,1.),
                          vec4(.4,.9,.4,1.),a*.5+.5);
            
            if( o2             ) c+=  a;
            if(!o2 && abs(y)<1.) c = c1;
            if(u.x >= 1. || u.x < 0. ||
               u.y >= 1. || u.y < 0.) c = vec4(.9);
            gl_FragColor = c;
        }`;
        let vxSh3 =
        `precision highp float;
        attribute float vtx;
        varying vec2 uv;
        void main()
        {
            vec4 a = vec4(-1.,1.,0.,1.);
            if(vtx == .50)  a.x = 3.;
            if(vtx == .75)  a.y =-3.;
            uv = a.xy;
            gl_Position = a*.5;
        }`;
        let frSh3 =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        float sgnz(float a)
        {
            float b = 0.;
            if(a > .001) b = 1.;
            if(a <-.001) b =-1.;
            return b;
        }
        void main()
        {
            vec2 u = uv*vec2(mtx[0].x,1.)-vec2(.0455,.0);
            float pi2 = 6.28318530718;
            
            vec2 u3A = u;
            vec2 u3B = u+(1.-mtx[0].y)*vec2(0.,1.);
            
            vec2 uA = fract(u3A)*1.1;
            vec2 uB = fract(u3B)*1.1;

            float n1 = mtx[0].z;
            float n2 = pow(2.,n1);
            vec2 u1A = vec2(uA.x,1.-uA.y);
                 u1A = floor(u1A*n2);
            vec2 u1B = floor(uB*n2);
            
            float f = n1+.5;
            vec2 u2A = u1A+.5;
            u1A = vec2(0.);
            for(float i = 0.; i < 8.; ++i)
            {
                vec2 c = u2A/pow(2.,i);
                	 c = mod(c,vec2(2.));
                     c = step(vec2(1.),c);
                u1A += c*pow(2.,n1-1.-i)*float(i < f);
            }
            
            float o = float(mod(u3A.x,2.) >= 1.);
            float a;
            a = pi2*u1A.x*u1A.y/n2;
            a = cos(a - pi2*.25*o);

            float g = fract(sin(u1B.x*19362.93671+.2)*47652.72562)*2.-1.;
            if(uB.y >= 1. || u3B.y >= 1.) g = 1.;
            if(u3A.y < 0.) a = 1.;
            a*=g;
            
            if(u3A.x<0.)	a = abs(a);
            else			a = sgnz(a);

            vec4 b = mix(vec4(.3,.3,.9,1.),
                         vec4(.3,.9,.3,1.),a);
            vec4 c = mix(vec4(.2,.2,.2,1.),
                         vec4(.8,.8,.8,1.),a*.5+.5);
            if(u3A.x<0.) b = b;
            else         b = c;

            c = mix(b,vec4(.9,.9,.9,1.),
                    float(  (max(uA.x,uA.y)>=1.||u3A.y>=1.||u3A.y<0.) && 
                            (max(uB.x,uB.y)>=1.||u3B.y>=1.||u3B.y<0.)));
            
            gl_FragColor = c;
        }`;
        let vxSh4 =
        `precision highp float;
        attribute float vtx;
        varying vec2 uv;
        void main()
        {
            vec4 a = vec4(-1.,1.,0.,1.);
            if(vtx == .50)  a.x = 3.;
            if(vtx == .75)  a.y =-3.;
            uv = a.xy*vec2(1.,-1.)+vec2(0.,.93);
            uv*=1.7;
            gl_Position = a*.5;
        }`;
        let frSh4 =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec2 u = uv*vec2(mtx[0].x,1.)-vec2(.0455,.0);
            float pi2 = 6.28318530718;
            
            u -= float(u.x>=0.)*vec2(0.,.6);
            u *= vec2(1.,.85);
            
            vec2 u3 = u;
            u = fract(u)*1.1/vec2(1.,.85);

            float n1 = floor(u3.y)*2.+1.+float(u3.x>=0.);//3.;
            float n2 = pow(2.,n1);
            vec2 u1 = u*n2;
            vec2 u1f = abs(fract(u1)*2.-1.);
                 u1 = floor(u1);

            float f = n1+.5;
            vec2 u2 = u1+.5;
            u1 = vec2(0.);
            for(float i = 0.; i < 5.; ++i)
            {
                vec2 c = u2/pow(2.,i);
                	 c = mod(c,vec2(2.));
                     c = step(vec2(1.),c);
                u1 += c*pow(2.,n1-1.-i)*float(i < f);
            }
            
            float o = float(mod(u3.x,2.) >= 1.);
            float a;
            a = pi2*u1.x*u1.y/n2;
            a = cos(a - pi2*.25*o);
            float sgn = a;
            a = abs(a);

            vec4 c = mix(vec4(.3,.3,.9,1.),
                         vec4(.3,.9,.3,1.),a);

            sgn *= float(a>.0001);
 
            c = mix(c, vec4(0.), float(sgn<0.)*max((.3-max(u1f.x,u1f.y))*5.,0.));
            c = mix(vec4(1.), c, min(1.4-max(u1f.x,u1f.y)*.5,1.));
            c = mix(c,vec4(.9,.9,.9,1.),float(max(u.x,u.y)>=1.));
            c = mix(c,vec4(.9,.9,.9,1.),float(n1<1.||n1>=6.));
            
            gl_FragColor = c;
        }`;
        let vxSh5a =
        `precision highp float;
        attribute float vtx;
        varying vec2 uv;
        void main()
        {
            vec4 a = vec4(-1.,1.,0.,1.);
            if(vtx == .50)  a.x = 3.;
            if(vtx == .75)  a.y =-3.;
            uv = a.xy;
            gl_Position = a*.5;
        }`;
        let frSh5a =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec2 u = uv*vec2(mtx[0].x*.5,1.);
            float pi2 = 6.28318530718;
            float a = sin(u.x*pi2);
            float b = float(fract(u.x)<.5)*2.-1.;
            a = mix(a,b,mtx[0].y)+u.y*2.;
            gl_FragColor = mix(vec4(.2), vec4(.8), float(a>0.));
        }`;
        let vxSh5b =
        `precision highp float;
        attribute float vtx;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        void main()
        {
            float f = fract(vtx);
        	vec2 s = vec2(0.,-1.);
        	if(f == .25){s.y = 2.;}
        	if(f == .5){s.x = 1.732;}
        	if(f == .75){s.x = -1.732;}
            float r = mtx[2].x;
            vec2 t = vec2(mod(vtx,r), floor(vtx/r)+.5);
            vec4 p = texture2D(tex,t/r).xyzw;
            uv = s;
            v0 = p+f*vec4(0.,0.,0.,1.);
            t = ((s+p.xy)-mtx[1].xy)*mtx[1].z*vec2(mtx[1].w,1.);
            gl_Position = vec4(t,1.,1.)*.5;
        }`;
        let frSh5b =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        float sgnz(float a)
        {
            float b = 0.;
            if(a < 0.) b = 1.;
            return b;
        }
        void main()
        {
            vec2 u = abs(uv);

            float id = v0.w;
            
            float n = mtx[2].y;
            float i = floor(id/(n*n));
            if(u.x > .5 || u.y > .5) discard;

            float x = floor(mod(id,n));
            float y = floor(mod(id,n*n)/n);

            float pi2 = 6.28318530718;

            float s = float(i == 1. || i == 3.);
            
            float a = pi2*x*y/n + float(i == 2. || i == 3.)*.001;//.001 to differentiate + -, sign()
                  a-= pi2*.25 * s;
                  a = cos(a);

            u*=2.;

            vec4 c = vec4(0.);
            if(i == 2. || i == 3.) c = mix(c, vec4(0.,0.,0.,1.), sgnz(a)*max((.3-max(u.x,u.y))*5.,0.)); c = mix(vec4(.9,.9,.9,1.), c, min(1.4-max(u.x,u.y)*.5,1.));
            if(i == 0. || i == 1.) c = vec4(.5+.5*cos(x/n*.8+3.+vec3(.0,2.1,4.2)),1.);

            gl_FragColor = c;
        }`;
        let vxSh5c =
        `precision highp float;
        attribute float vtx;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        void main()
        {
            float f = fract(vtx);
        	vec2 s = vec2(0.,-1.);
        	if(f == .25){s.y = 2.;}
        	if(f == .5){s.x = 1.732;}
        	if(f == .75){s.x = -1.732;}
            float r = mtx[2].x;
            vec2 t = vec2(mod(vtx,r), floor(vtx/r)+.5);
            vec4 p = texture2D(tex,t/r).xyzw;
            uv = s;
            v0 = p;
            t = ((s+p.xy)-mtx[1].xy)*mtx[1].z*vec2(mtx[1].w,1.);
            gl_Position = vec4(t,1.,1.)*.5;
        }`;
        let frSh5c =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        float sgnz(float a)
        {
            float b = 0.;
            if(a < 0.) b = 1.;
            return b;
        }
        void main()
        {
            vec2 u = abs(uv);
            if(u.x > .5 || u.y > .5) discard;

            float x = abs(v0.w)-1.;
            float s = float(v0.w < 0.);
            float n = mtx[2].y;
            float pi2 = 6.28318530718;

            vec4 c = vec4(0.);
            c = vec4(.5+.5*cos(x/n*.8+3.+vec3(.0,2.1,4.2)),1.);
            c = mix(c, vec4(0.,0.,0.,1.), s*max((.3-max(u.x,u.y)*2.)*5.,0.));

            //c = mix(vec4(.9,.9,.9,1.), c, min(1.4-max(u.x,u.y)*.5,1.));

            gl_FragColor = c;
        }`;
        //666666666666666666666666666666
        let vxSh6a =
        `precision highp float;
        attribute float vtx;
        varying vec2 uv;
        void main()
        {
            vec4 a = vec4(-1.,1.,0.,1.);
            if(vtx == .50)  a.x = 3.;
            if(vtx == .75)  a.y =-3.;
            uv = a.xy*.5+.5;
            gl_Position = a*.5;
        }`;
        let frSh6a =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec2 u = uv;
            float pi = 3.1415926535897932384626433832795;
            vec4 col = vec4(.9,.9,.9,1.);
            float m1 = mtx[0].y;
            float m2 = mtx[0].z;
            float m20 = 1.-m2;
            
            vec2 v1 = (u*vec2(8.,9.)-vec2(3.,7.))/vec2(2.,1.);
            vec2 v2 = (u*vec2(8.,6.)-vec2(4.,2.))/vec2(1.,1.);
                 v2 = vec2(atan(v2.x,v2.y)+pi,length(v2))/vec2(pi*2.,1.);
            vec2 v3 = mix(v1,v2,m2);
            
            float d1 = float(v3.x < m1 && v3.x > 0. &&
                             v3.y < 1.  && v3.y > 0.);
            float d2 = float(v3.x < 1.  && v3.x > 0. &&
                             v3.y < 1.  && v3.y > 0.);
            col = mix(col, vec4(.5*.9,.5*.9,.5*.9,1.), d2);
            col = mix(col, vec4(.6*.9,.7*.9,.9*.9,1.), d1);
            
            float a1 = float(v1.x < m1 && v1.x > 0. &&
                             v1.y < 1.  && v1.y > 0.);
            float a2 = float(v1.x < 1.  && v1.x > 0. &&
                             v1.y < 1.  && v1.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.6,.7,.9,1.), a1);

            float b1 = float(v2.x < m1 && v2.x > 0. &&
                             v2.y < 1.  && v2.y > 0.);
            float b2 = float(v2.x < 1.  && v2.x > 0. &&
                             v2.y < 1.  && v2.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), b2);
            col = mix(col, vec4(.6,.7,.9,1.), b1);
            
            vec2 v4 = (u*vec2(12.,6.)-vec2(10.,2.))/vec2(1.,3.);
            float c1 = float(v4.x < 1.    && v4.x > 0.    &&
                             v4.y < m20+.1 && v4.y > m20-.1);
            float c2 = float(v4.x < 1.  && v4.x > 0. &&
                             v4.y < 1.  && v4.y > 0.);
            col = mix(col, vec4(.5,.5,.4,1.), c2);
            col = mix(col, vec4(.9,.9,.7,1.), c1);
            gl_FragColor = col;
        }`;
        let frSh6b =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec2 u = uv;
            
            float pi = 3.1415926535897932384626433832795;
            vec4 col = vec4(.9,.9,.9,1.);
            float m1 = mtx[0].y;
            float m2 = mtx[0].z;
            float m3 = mtx[0].w;
            float m30 = 1.-m3;
            float a1,a2,a3;
            
            vec2 v5 = (u*vec2(14.,12.)-vec2(6.,10.))/vec2(1.,1.);
            a1 = float(v5.x < m1  && v5.x > 0. &&
                       v5.y < 1.  && v5.y > 0.);
            a2 = float(v5.x < 1.  && v5.x > 0. &&
                       v5.y < 1.  && v5.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.6,.9,.6,1.), a1);
            
            vec2 v6 = (u*vec2(14.,12.)-vec2(9.,10.))/vec2(1.,1.);
            a1 = float(v6.x < m2  && v6.x > 0. &&
                       v6.y < 1.  && v6.y > 0.);
            a2 = float(v6.x < 1.  && v6.x > 0. &&
                       v6.y < 1.  && v6.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.6,.6,.9,1.), a1);
            
            m1 *= .5;
            m2 *= .5;
            
            vec2 v1 = (u*vec2(14.,12.)-vec2(7.,7.))/vec2(2.,1.);
            vec2 v2 = (u*vec2(14.,8.)-vec2(8.,2.))/vec2(1.,1.);
                 v2 = vec2(atan(v2.x,v2.y)+pi,length(v2))/vec2(pi*2.,1.);
            vec2 v3 = mix(v1,v2,m3);
            a1 = float(v3.x < m1  && v3.x > 0. &&
                       v3.y < 1.  && v3.y > 0.);
            a3 = float(v3.x < m1+m2  && v3.x > m1 &&
                       v3.y < 1.  && v3.y > 0.);
            a2 = float(v3.x < 1.  && v3.x > 0. &&
                       v3.y < 1.  && v3.y > 0.);
            col = mix(col, vec4(.5*.9,.5*.9,.5*.9,1.), a2);
            col = mix(col, vec4(.6*.9,.6*.9,.9*.9,1.), a3);
            col = mix(col, vec4(.6*.9,.9*.9,.6*.9,1.), a1);
            
            a1 = float(v1.x < m1  && v1.x > 0. &&
                       v1.y < 1.  && v1.y > 0.);
            a3 = float(v1.x < m1+m2  && v1.x > m1 &&
                       v1.y < 1.  && v1.y > 0.);
            a2 = float(v1.x < 1.  && v1.x > 0. &&
                       v1.y < 1.  && v1.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.6,.6,.9,1.), a3);
            col = mix(col, vec4(.6,.9,.6,1.), a1);

            a1 = float(v2.x < m1  && v2.x > 0. &&
                       v2.y < 1.  && v2.y > 0.);
            a3 = float(v2.x < m1+m2  && v2.x > m1 &&
                       v2.y < 1.  && v2.y > 0.);
            a2 = float(v2.x < 1.  && v2.x > 0. &&
                       v2.y < 1.  && v2.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.6,.6,.9,1.), a3);
            col = mix(col, vec4(.6,.9,.6,1.), a1);

            vec2 v4 = (u*vec2(21.,8.)-vec2(16.,2.))/vec2(1.,3.);
            a1 = float(v4.x < 1.    && v4.x > 0.    &&
                       v4.y < m30+.1 && v4.y > m30-.1);
            a2 = float(v4.x < 1.  && v4.x > 0. &&
                       v4.y < 1.  && v4.y > 0.);
            col = mix(col, vec4(.5,.5,.4,1.), a2);
            col = mix(col, vec4(.9,.9,.7,1.), a1);

            gl_FragColor = col;
        }`;
        let frSh6c =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec2 u = uv;
            
            float pi = 3.1415926535897932384626433832795;
            vec4 col = vec4(.9,.9,.9,1.);
            float m1 = mtx[0].y;
            float m2 = mtx[0].z;
            
            float a1,a2;
            vec2 v;
            
            ////////////////
            v = (u*vec2(12.,18.)-vec2(3.,16.))/vec2(2.,1.);
            a1 = float(v.x < m1 && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            a2 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.9,.6,.6,1.), a1);
            
            v = (u*vec2(12.,12.)-vec2(4.,8.))/vec2(1.,1.);
            v = vec2(atan(v.x,v.y)+pi,length(v))/vec2(pi*2.,1.);
            a1 = float(v.x < m1 && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            a2 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.9,.6,.6,1.), a1);
            
            ////////////////
            v = (u*vec2(12.,18.)-vec2(7.,16.))/vec2(2.,1.);
            a1 = float(v.x < m2 && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            a2 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.6,.9,.6,1.), a1);
            
            v = (u*vec2(12.,12.)-vec2(8.,8.))/vec2(1.,1.);
            v = vec2(atan(v.x,v.y)+pi,length(v))/vec2(pi*2.,1.);
            a1 = float(v.x < m2 && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            a2 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.6,.9,.6,1.), a1);
            
            ////////////////
            vec2 m3v = +cos(m1*pi*2.-pi*vec2(.0,.5))
                       +cos(m2*pi*2.-pi*vec2(.0,.5));
            float m3 = atan(-m3v.y,-m3v.x)/(pi*2.)+.5;
            v = (u*vec2(12.,12.)-vec2(6.,4.))/length(m3v);
            v = vec2(atan(v.x,v.y)+pi,length(v))/vec2(pi*2.,1.);
            a1 = float(v.x < m3 && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            a2 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.7,.7,.7,1.), a1);

            gl_FragColor = col;
        }`;
        let frSh6d =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec2 u = uv;
            
            float pi = 3.1415926535897932384626433832795;
            vec4 col = vec4(.9,.9,.9,1.);

            float n1 = mtx[0].y;
            float n2 = mtx[0].z;
            float n3 = mtx[0].w;
            
            float m1 = .1;
            float m2 = .2;
            float m3 = .3;
            float m4 = .5;
            float m5 = .25;
            
            float m45 = m4+m5;
            m4 = mix(m4,m45,n3);
            m5 = mix(m5,m45,0.);
            
            float p10 = mix(0.,1.,n1);
            float p11 = mix(5.,3.,n1);
            
            float p20a = mix(0.,.5,n2);
            float p21a = mix(1.,2.,n2);
            float p20b = mix(2.,1.5,n2);
            float p21b = mix(5.,4.,n2);
            
            float p30a = mix(0.,2.,n3);
            float p31a = mix(1.,5.,n3);
            float p30b = mix(2.,2.,n3);
            float p31b = mix(5.,5.,n3);

            vec4 c31 = vec4(.6,.9,.6,1.);//mix(vec4(.6,.9,.6,1.), vec4(.6,.9,.9,1.), n3);
            vec4 c32 = mix(vec4(.6,.7,.9,1.), vec4(.6,.7,.7,1.), n3);
            
            float a1,a2;
            vec2 v;
            
            ////////////////
            v = (u*vec2(3.,9.)-vec2(p10,6.))/vec2(1.,1.);
            a1 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.6,.9,.6,1.), a1);
            
            v = (u*vec2(6.,18.)-vec2(p11,13.))/vec2(1.,1.);
            v = vec2(atan(v.x,v.y)+pi,length(v))/vec2(pi*2.,1.);
            a1 = float(v.x < m1 && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            a2 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.8,.8,.8,1.), a1);
            
            ////////////////
            v = (u*vec2(3.,9.)-vec2(p20a,3.))/vec2(1.,1.);
            a1 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.6,.9,.6,1.), a1);
            
            v = (u*vec2(6.,18.)-vec2(p21a,7.))/vec2(1.,1.);
            v = vec2(atan(v.x,v.y)+pi,length(v))/vec2(pi*2.,1.);
            a1 = float(v.x < m2 && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            a2 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.8,.8,.8,1.), a1);
            
            v = (u*vec2(3.,9.)-vec2(p20b,3.))/vec2(1.,1.);
            a1 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.6,.7,.9,1.), a1);
            
            v = (u*vec2(6.,18.)-vec2(p21b,7.))/vec2(1.,1.);
            v = vec2(atan(v.x,v.y)+pi,length(v))/vec2(pi*2.,1.);
            a1 = float(v.x < m3 && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            a2 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.8,.8,.8,1.), a1);
            
            ////////////////
            //v = (u*vec2(3.,9.)-vec2(p30b,0.))/vec2(1.,1.);
            //a1 = float(v.x < 1. && v.x > 0. &&
            //           v.y < 1. && v.y > 0.);
            //col = mix(col, c32, a1);

            v = (u*vec2(6.,18.)-vec2(p31b,1.))/vec2(1.,1.);
            v = vec2(atan(v.x,v.y)+pi,length(v))/vec2(pi*2.,1.);
            a1 = float(v.x < m5 && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            a2 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.8,.8,.8,1.), a1);

            v = (u*vec2(3.,9.)-vec2(p30a,0.))/vec2(1.,1.);
            a1 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, c31, a1);
            
            v = (u*vec2(6.,18.)-vec2(p31a,1.))/vec2(1.,1.);
            v = vec2(atan(v.x,v.y)+pi,length(v))/vec2(pi*2.,1.);
            a1 = float(v.x < m4 && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            a2 = float(v.x < 1. && v.x > 0. &&
                       v.y < 1. && v.y > 0.);
            col = mix(col, vec4(.4,.4,.4,1.), a2);
            col = mix(col, vec4(.8,.8,.8,1.), a1);

            gl_FragColor = col;
        }`;
        let vxSh6e =
        `precision highp float;
        attribute float vtx;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        void main()
        {
            float f = fract(vtx);
        	vec2 s = vec2(0.,-1.);
        	if(f == .25){s.y = 2.;}
        	if(f == .5){s.x = 1.732;}
        	if(f == .75){s.x = -1.732;}
            float r = mtx[2].x;
            vec2 t = vec2(mod(vtx,r), floor(vtx/r)+.5);
            vec4 p = texture2D(tex,t/r).xyzw;
            uv = s;
            v0 = p;
            t = ((s+p.xy)-mtx[1].xy)*mtx[1].z*vec2(mtx[1].w,1.);
            gl_Position = vec4(t,1.,1.)*.5;
        }`;
        let frSh6e =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        void main()
        {
            if(uv.x > .5 || uv.y > .5 ||
               uv.x <-.5 || uv.y <-.5) discard;

            float id = v0.w+.5;
            float n = mtx[2].y;
            float x = floor(mod(id,n));
            float y = floor(mod(id,n*n)/n);

            float pi2 = 6.28318530718;

            float a = fract(x*y/n);
            vec4 col = .5+.5*cos(v0.z/n*1.4+2.8+vec4(.0,2.1,4.2,.0));
            vec2 v = vec2(atan(uv.x,uv.y)+pi2*.5,length(uv)*2.)/vec2(pi2,1.);
            //float a1 = float(v.x < a && v.y < 1.);
            //float a2 = float(v.y < 1.);
            float t = clamp(150.*(1.-v.y)/n, 0., 1.);
            col = mix(col, vec4(.4,.4,.4,1.), t);
            col = mix(col, vec4(.8,.8,.8,1.), t*float(v.x < a));
            
            gl_FragColor = col;
        }`;
        let vxSh6f =
        `precision highp float;
        attribute float vtx;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        void main()
        {
            float f = fract(vtx);
        	vec2 s = vec2(0.,-1.);
        	if(f == .25){s.y = 2.;}
        	if(f == .5){s.x = 1.732;}
        	if(f == .75){s.x = -1.732;}
            float r = mtx[2].x;
            vec2 t = vec2(mod(vtx,r), floor(vtx/r)+.5);
            vec4 p = texture2D(tex,t/r).xyzw;
            uv = s;
            v0 = p;
            t = ((s+p.xy)-mtx[1].xy)*mtx[1].z*vec2(mtx[1].w,1.);
            gl_Position = vec4(t,1.,1.)*.5;
        }`;
        let frSh6f =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        void main()
        {
            if(uv.x > .5 || uv.y > .5 ||
               uv.x <-.5 || uv.y <-.5) discard;

            float n = mtx[2].y;
            float a = v0.z;         //circle angle
            float c = v0.w/n;       //square color

            float pi2 = 6.28318530718;
            vec2 v = vec2(atan(uv.x,uv.y)+pi2*.5, length(uv)*2.)/vec2(pi2,1.);

            float t = clamp(150.*(1.-v.y)/n, 0., 1.);

            vec4 col = vec4(.9,.9,.9,0.);
            col = mix(col, .5+.5*cos(c*1.4+2.8+vec4(.0,2.1,4.2,.0)),    float(c >= 0.));
            col = mix(col, vec4(.4,.4,.4,1.),                           float(a >= 0.)              *t);
            col = mix(col, vec4(.8,.8,.8,1.),                           float(a >= 0. && v.x < a )  *t);
            if(col.w == 0.) discard;

            gl_FragColor = col;
        }`;
        let vxSh6g =
        `precision highp float;
        attribute float vtx;
        uniform mat4 mtx;
        varying vec2 uv;
        varying float v0;
        void main()
        {
            float f = fract(vtx);
        	vec2 s = vec2(0.,-1.);
        	if(f == .25){s.y = 2.;}
        	if(f == .5){s.x = 1.732;}
        	if(f == .75){s.x = -1.732;}

            uv = s;
            float l = mtx[0].z;
            
            float p1 = pow(2.,l);
            float m1 =   mod(vtx,p1);    v0 = m1/p1;
            float d1 = floor(vtx/p1);
            float d11= d1-1.;

            p1 = p1-1.;

            float p2 = pow(2.,d1);        
            float m2 = floor(mod(m1,p2));
            float d2 = floor(    m1/p2 );

            float m3 = floor(mod(p1,p2));
            float d3 = floor(    p1/p2 );

            float p21= pow(2.,d11);        
            float m21= floor(mod(m1,p21));
            float d21= floor(    m1/p21 );

            float m31= floor(mod(p1,p21));
            float d31= floor(    p1/p21 );

            
            float sx = .17/l;
            float sy = .6/l;

            float xl =    m3 *sx*1.5 + d3 *sx*(p2 *1.5+1.);
            float xl1=    m31*sx*1.5 + d31*sx*(p21*1.5+1.);
            vec2 t = vec2(m2 *sx*1.5 + d2 *sx*(p2 *1.5+1.) - xl *.5,    -d1 *sy*2.+l*.5*sy*2.);
            vec2 t1= vec2(m21*sx*1.5 + d21*sx*(p21*1.5+1.) - xl1*.5,    -d11*sy*2.+l*.5*sy*2.);

            float a = mtx[0].w*l-d1+1.;
            t = mix(t1,t,min(a,1.));

            gl_Position = vec4(t+s*(sx*4.5)*mtx[0].xy,1.,1.)*.5*float(a>0.);
        }`;
        let frSh6g =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        varying float v0;
        void main()
        {
            if(uv.x > .5 || uv.y > .5 ||
               uv.x <-.5 || uv.y <-.5) discard;

            gl_FragColor = mix(vec4(.4,.4,1.,.0),vec4(.4,1.,.4,.0),v0);
        }`;
        let vxSh7a1 =
        `precision highp float;
        attribute float vtx;
        varying vec2 uv;
        void main()
        {
            vec4 a = vec4(-1.,1.,1.,1.);
            if(vtx == .50)  a.x = 3.;
            if(vtx == .75)  a.y =-3.;
            uv = a.xy*.5+.5;
            uv.y = 1.-uv.y;
            gl_Position = a*.5;
        }`;
        let frSh7a1 =
        `precision highp float;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec2 u = uv;
            float pi2 = 6.28318530718;
    
            float s = mtx[0].x;     //steps
            float n = mtx[0].y;     //points
            float rez = mtx[0].z;   //texture resolution 1/x
            
            vec2 k = u*vec2(4.,2.);
            vec2 kf = fract(k);
            float o1 = floor(k.x);	//wave smooth-aliased2-aliased1
            bool o2 = k.y >= 1.;    //math cos-sin
            
            u = kf*1.1-.05;
            
            vec2 fl = floor(u*s)/s;
            if(o1>=2.) u = fl;
            
            float cosi1 = float(o2)*pi2*-.25;
            
            float a = 0.;
            for(float i = .5; i < 8.; ++i)
            {
                vec2 t = texture2D(tex,vec2(i,.5)*rez).xy;
                           t*= s;
                if(o1==3.) t = floor(t);
                a += cos(pi2 * (u.x*t.x+u.y*t.y) + cosi1)*float(i<n);
            }

            vec4 c = vec4(.9);
            if(k.x >= 3. && n<1.5) c = vec4(1.,.2,.2,.0);
            
            vec4 c2 = mix(vec4(.4,.4,.9,1.),
                          vec4(.4,.9,.4,1.),a/n*.5+.5);
            
            c = mix(c,c2,float(!( u.x >= 1. || u.x < 0. ||
                                  u.y >= 1. || u.y < 0. || k.x < 1.)));

            gl_FragColor = c;
        }`;
        let frSh7a2 =
        `precision highp float;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec2 u = uv;
            float pi2 = 6.28318530718;
    
            float s = mtx[0].x;     //steps
            float n = mtx[0].y;     //points
            float rez = mtx[0].z;   //texture resolution 1/x
            
            u = u*vec2(4.,2.)-vec2(0.,.5);	
            u = u*1.1-.05;
            
            vec2 fl = floor(u*s)/s;
                
            float a = .1;
            for(float i = .5; i < 8.; ++i)
            {
                vec2 t = texture2D(tex,vec2(i,.5)*rez).xy;
                t = u-t;
                a = max(a, (1.-dot(t,t)*512.) * float(i<n) );
            }
            
            vec2 b = max(cos(u*pi2*s)-.8,vec2(0.));
            a = max(a,max(b.x,b.y));

            vec4 c = a*vec4(1.);
            
            if(u.x >= 1. || u.x < 0. ||
               u.y >= 1. || u.y < 0. ) discard;
            gl_FragColor = c;
        }`;
        let vxSh7b =
        `precision highp float;
        attribute float vtx;
        varying vec2 uv;
        void main()
        {
            vec4 a = vec4(-1.,1.,1.,1.);
            if(vtx == .50)  a.x = 3.;
            if(vtx == .75)  a.y =-3.;
            uv = a.xy*.5+.5;
            gl_Position = a*.5;
        }`;
        let frSh7b =
        `precision highp float;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        void tdm(vec2 u, inout vec4 c, float s)
        {
            float st = (s*2.-2.)+2.;
            float mx = mtx[0].w*st;
            
            u = u*2.;
            u-= vec2(1.-max(mx-st+1.,0.),0.);
            u = u*1.05-.025;
            vec2 a = u;
            u = 1.-(1.-u)*clamp(mx,1.0909/s,1.);
            
            vec2 ub = floor(u*s);
            u = fract(u*s)*1.1-.05*clamp((mx-st+1.)*2.,0.,1.);
            u.x -= (1.-clamp(max(mx+1.,1.+1.)-(s-ub.x)     ,0.,1.))*1.1;
            u.y -= (1.-clamp(max(mx+3.,3.+s )-(s-ub.y)-1.-s,0.,1.))*1.1;
            u.y  =  1.-u.y;
            vec2 us = floor(u*s);

            float n = log2(s);
            vec2 u2 = us+.5;
            us = vec2(0.);
            for(float i = 0.; i < 5.; ++i)
            {
                vec2 o = u2/pow(2.,i);
                	 o = mod(o,vec2(2.));
                     o = step(vec2(1.),o);
                us+= o * pow(2.,n-1.-i)*float(i < n);
            }
            us /= s;
            
            vec4 col = +vec4(.0,.9,.0,1.)*us.x*(1.-us.y)
                       +vec4(.0,.0,.9,1.)*us.y*(1.-us.x)
                       +vec4(.9,.2,.0,1.)*us.y*us.x;
            
            float e = float( u.x >= 1. || u.x < 0. ||
        					 u.y >= 1. || u.y < 0. ||
                             a.x >= 1. || a.x < 0. ||
                             a.y >= 1. || a.y < 0. );
                
            c = mix(col,c, e);
        }
        void main()
        {
            vec2 u = uv;
            float pi2 = 6.28318530718;
            
            u *= 2.;
            float o = float(u.x>=1.);
            vec2 uo = u;
            u = fract(u)*1.05-.025;
            vec2 v = u;
            
            float s = mtx[0].x;
            
            vec2 k = u*s;
            vec2 k1 = fract(k);
            vec2 t = floor(k);
            t.y = s-1.-t.y;
            
            u = k1*1.1-.05;
            vec2 us = fract(u*s)*2.-1.;
            u = floor(u*s);
            u.y = s-1.-u.y;
            u = u/s;
            
            float ang = fract(u.x*t.x+u.y*t.y);	//circle angle
            vec2 agl = vec2(atan(us.x,us.y)+pi2*.5, length(us))/vec2(pi2,1.);
            float cir = clamp(180.*(1.-agl.y)*mtx[1].x/(s*s+s*.5-.5), 0., 1.);
                  cir*= float(uo.y<1. && uo.x<1. && ang >= 0.);
            
            float cosi1 = o*pi2*-.25;
            
            float a = cos(pi2 * (u.x*t.x+u.y*t.y) + cosi1);
            
            float h = 1.-float( u.x >= 1. || u.x < 0. ||
               				    u.y >= 1. || u.y < 0. ||
               				    v.x >= 1. || v.x < 0. ||
               				    v.y >= 1. || v.y < 0. );
            cir*=h;

            vec4 c = vec4(.9);

            vec2 tx = floor(texture2D(tex,vec2(.5,.5)*mtx[0].z).xy*s);
            if(t.x == tx.x && t.y == tx.y && uo.y>1. && mtx[0].y<1.5) c = vec4(1.,.2,.2,.0);
            
            vec4 c1 = mix(vec4(.4,.4,.9,1.),
                          vec4(.4,.9,.4,1.),a*.5+.5);
            
            c = mix(c, c1, float(uo.y>1.)*h);
            tdm(uv, c, s);
            c = mix(c, vec4(.4,.4,.4,1.), cir);
            c = mix(c, vec4(.8,.8,.8,1.), cir*float(agl.x < ang ));
            gl_FragColor = c;
        }`;
        let vxSh7c =
        `precision highp float;
        attribute float vtx;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        void main()
        {
            float f = fract(vtx);
        	vec2 s = vec2(0.,-1.);
        	if(f == .25){s.y = 2.;}
        	if(f == .5){s.x = 1.732;}
        	if(f == .75){s.x = -1.732;}
            float r = mtx[2].x;
            vec2 t = vec2(mod(vtx,r), floor(vtx/r)+.5);
            vec4 p = texture2D(tex,t/r).xyzw;
            uv = s;
            v0 = p;
            t = ((s+p.xy)-mtx[1].xy)*mtx[1].z*vec2(mtx[1].w,1.);
            gl_Position = vec4(t,1.,1.)*.5;
        }`;
        let frSh7c =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        void main()
        {
            if(uv.x > .5 || uv.y > .5 ||
               uv.x <-.5 || uv.y <-.5) discard;

            float pi2 = 6.28318530718;

            float n = mtx[2].y;

            float a = v0.z+.5;
            vec2 xy = vec2(mod(a,n),a/n);
                 xy = floor(xy)/n;

            vec4 col = +vec4(.0,.9,.0,1.)*xy.x*(1.-xy.y)
                       +vec4(.0,.0,.9,1.)*xy.y*(1.-xy.x)
                       +vec4(.9,.2,.0,1.)*xy.y*xy.x;
            if(mtx[2].z == 0.) col = vec4(.9);
            vec2 v = vec2(atan(uv.x,uv.y)+pi2*.5,length(uv)*2.)/vec2(pi2,1.);
            float t = clamp(300.*(1.-v.y)*mtx[0].z/(n*n+n*.5-.5), 0., 1.);
                  t*= float(mtx[2].z != 2.);
            col = mix(col, vec4(.4,.4,.4,1.), t);
            col = mix(col, vec4(.8,.8,.8,1.), t*float(v.x < v0.w));
            
            gl_FragColor = col;
        }`;
        let vxSh7d =
        `precision highp float;
        attribute float vtx;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        void main()
        {
            float f = fract(vtx);
        	vec2 s = vec2(0.,-1.);
        	if(f == .25){s.y = 2.;}
        	if(f == .5){s.x = 1.732;}
        	if(f == .75){s.x = -1.732;}
            float r = mtx[2].x;
            float r1 = 1./r;
            float a = floor(vtx)*2.+.5;
            vec2 t = vec2(mod(a,r), floor(a*r1)+.5);
            vec4 p1 = texture2D(tex,(t+vec2(0.,0.))*r1).xyzw;
            vec4 p2 = texture2D(tex,(t+vec2(1.,0.))*r1).xyzw;
            uv = s;
            v0 = vec4(p2.xy,p1.zw);
            t = ((s+p1.xy)-mtx[1].xy)*mtx[1].z*vec2(mtx[1].w,1.);
            gl_Position = vec4(t,p2.y,1.)*.5;
        }`;
        let frSh7d =
        `precision highp float;
        uniform mat4 mtx;
        varying vec2 uv;
        varying vec4 v0;
        void main()
        {
            if(uv.x > .5 || uv.y > .5 ||
               uv.x <-.5 || uv.y <-.5) discard;

            float pi2 = 6.28318530718;

            float n = mtx[2].y;

            float a = v0.z+.5;
            vec2 xy = vec2(mod(a,n),a/n);
                 xy = floor(xy)/n;

            vec4 d = +vec4(.0,.9,.0,1.)*xy.x*(1.-xy.y)
                     +vec4(.0,.0,.9,1.)*xy.y*(1.-xy.x)
                     +vec4(.9,.2,.0,1.)*xy.y*xy.x;
                 d.w = 1.;

            vec4 c = vec4(.9,.9,.9,.0);
            c = mix(c, d, float(v0.z >= 0.));

            vec2 v = vec2(atan(uv.x,uv.y)+pi2*.5,length(uv)*2.)/vec2(pi2,1.);
            float t = clamp(300.*(1.-v.y)*mtx[0].z/(n*n+n*.5-.5), 0., 1.);
                  t*= float(v0.w >= 0.);
            c = mix(c, vec4(.4,.4,.4,1.), t);
            c = mix(c, vec4(.8,.8,.8,1.), t*float(v.x < v0.w));
            
            gl_FragColor = c*vec4(1.,1.,1.,v0.x);
        }`;
        vxSh8a =
        `precision highp float;
        uniform mat4 mtx;
        attribute float vtx;
        varying vec2 uv;
        void main()
        {
            vec4 a = vec4(-1.,1.,1.,1.);
            if(vtx == .50){a.x = 1.;}
            if(vtx == .75){a.y =-1.;}

            if(vtx > 1.){a = vec4(1.,-1.,1.,1.);}
            
            if(vtx ==1.50){a.x =-1.;}
            if(vtx ==1.75){a.y = 1.;}

            uv = a.xy*.5+.5;

            if(a.y<0.){a.y = mtx[2].x;}
            else      {a.y = mtx[2].y;}

            gl_Position = a*.5;
        }`;
        frSh8a =
        `precision highp float;
        uniform sampler2D tex0;
        uniform sampler2D tex1;
        uniform mat4 mtx;
        varying vec2 uv;
        FUN
        void main()
        {
            vec4 t = texture2D(tex1,uv);                       //interlace data    
            vec4 a = texture2D(tex0,t.xy);                     //.x=real .y=imagin  .z=real .w=imagin
            gl_FragColor = preprocess(a,mtx[0].x,t.w,mtx[3].x,mtx[2].z);
        }`;
        var frSh8b =
        `precision highp float;
        uniform sampler2D tex0;
        uniform sampler2D tex1;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec4  t = texture2D(tex1,uv);                       //interlace data
            float i = t.z;

            float p1 = mtx[3].x;
            float p2 = mtx[3].y;
            float p3 = mtx[3].z;
            float sg = mtx[3].w;

            float v = i+.5;
                  v = mod(v,p1) + floor(v*p3)*p2;

            float v2 = v+p1;

            vec2 u1 = vec2(mod(v ,mtx[1].y),v *mtx[1].w)*mtx[1].z;
            vec2 u2 = vec2(mod(v2,mtx[1].y),v2*mtx[1].w)*mtx[1].z;
       
            vec4 t1 = texture2D(tex0,u1);                      //.x=real .y=imagin  .z=real .w=imagin
            vec4 t2 = texture2D(tex0,u2);                      //.x=real .y=imagin  .z=real .w=imagin

            vec2 b = cos(i*sg + vec2(0.,-.5)*3.1415926535897932384626433832795);
            
            gl_FragColor = t1 + t2.xxzz*b.xyxy + 
                                t2.yyww*b.yxyx*vec4(-1.,1.,-1.,1.);

            //vec4 t1 = texture2D(tex0,u1);                      //.x=length .y=length  .z=angle .w=angle
            //vec4 t2 = texture2D(tex0,u2);                      //.x=length .y=length  .z=angle .w=angle
            //vec4 m = vec4(0.,-.5, 0.,-.5)*pi;
            //t1 = + t1.xxyy*cos(t1.zzww + m       )
            //     + t2.xxyy*cos(t2.zzww + m + i*sg);
            //gl_FragColor = vec4(length(t1.xy), length(t1.zw), atan(t1.y,t1.x), atan(t1.w,t1.z));
        }`;
        frSh8c =
        `precision highp float;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        FUN
        void main()
        {
            gl_FragColor = visualize(tex);
            
          //x = min(x,1.);
          //gl_FragColor = vec4(x*1.6,x*1.6-.6,(cos(x*7.+4.5)*.5+.5)*(x*.8+.3),0.); //inferno colormap
        }`;
        frSh8fun =
`
//preprocess()  sound before applying FFT
//              does     modify the sound to see
//              does not modify the sound to hear
//v.xz    real|imaginary of left  sound channel before applying 1D FFT
//v.yw    real|imaginary of right sound channel before applying 1D FFT
//z       size     of      array for 1D FFT
//i       position of v in array for 1D FFT    range 0 to z-1
//o       position of      array for 1D FFT in the soundtrack
//a       value of the slider [a = ]
//use o+i for sample position
vec4 preprocess(vec4 v, float z, float i, float o, float a)
{
    i = (i+.5)/z-.5;
    i = i*a*64.;                    //gaussian function width is controlled by slider [a = ]
    i = 1./exp(i*i);
    v*= i;                          //apply gaussian function to sound samples
    v*= 1./sqrt(z);                 //apply normalization     to sound samples
    return v;                       
}

//visualize what is on the screen
//uv       = screen coordinates range 0 to 1
//tx2D     = texture with fourier transform with same format as "v" from preprocess()
//mtx[0].x = vertical zoom                          slider located at buttom left
//mtx[0].y = 1
//mtx[0].z = brightness                             slider located at left of [shaders] button
//mtx[0].w = size of array of 1D FFT
//mtx[1].x = amplitude|phase|real|imaginary         slider located at left of [shaders] button
//mtx[1].y = undo natural curve                     slider located at left of [shaders] button
//mtx[2].z = total number of 1D FFT results stored in tx
//mtx[2].w = one 1D FFT result may not fit inside one row of tx2D, how many rows?
//mtx[3].x = position where sound is playing
vec4 visualize(sampler2D tx2D)
{
    float pi = 3.141592653589;

    vec2 u = uv*mtx[0].yx;
    float i = (u.y + floor(u.x*mtx[2].z)) *mtx[2].w;
    vec2 v = vec2(fract(i),i/(mtx[2].z*mtx[2].w));
    vec4 t = texture2D(tx2D,v);

    float z = mtx[0].w;

    float w = u.y-1.-floor(u.y-.5)-.5/z;                        //undo natural 1/x curve
          w*= sqrt(z);
    if(mtx[1].y == 0.){w = 1.;}
    t *= w;

    vec2 x  = vec2(length(t.xy),length(t.zw));                  //amplitude
    vec2 x1 = vec2(atan(t.y,t.x), atan(t.w,t.z))/(pi*2.)+.5;    //phase
    vec2 x2 = t.xy;                                             //left  channel real|imaginary
    vec2 x3 = t.zw;                                             //right channel real|imaginary

    float f = mtx[1].x;
  //if(f==1.){x = x ;}
    if(f==2.){x = x1;}
    if(f==3.){x = x2;}
    if(f==4.){x = x3;}
    
    x *= mtx[0].z;
    if(f>=3.){x += .5;}
    
    float l = .0005/(.0005+abs(uv.x-mtx[3].x));                 //bright line sweeping horizontally as sound plays
    return vec4(dot(x,vec2(.2)),x,.0)+l;
}

`;
        vxSh9a =
        `precision highp float;
        attribute float vtx;
        varying vec2 uv;
        void main()
        {
            vec4 a = vec4(-1.,1.,1.,1.);
            if(vtx == .50){a.x = 3.;}
            if(vtx == .75){a.y =-3.;}
            uv = a.xy*.5+.5;
            gl_Position = a*.5;
        }`;
        let frSh9a =
        `precision highp float;
        uniform sampler2D tex0;
        uniform sampler2D tex1;
      //uniform sampler2D tex2;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec4 rd = texture2D(tex0,uv).xyzw;      //interlace
                 rd = floor(rd*255.9);
            vec2 u = vec2(rd.x + rd.y*256.,
                          rd.z + rd.w*256.);
                 u = (u+.5)*mtx[0].y;

            gl_FragColor = texture2D(tex1,u).xyzw*mtx[0].y;  //.x=real .y=imagin  .z=real .w=imagin
        }`;
        frSh9b =
        `precision highp float;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        FUN
        void main()
        {
            float ziz = mtx[0].x;
            float zdv = mtx[0].y;
          //float stp = mtx[0].w;

            float p1 = mtx[2].x;
            float p2 = mtx[2].y;
            float p3 = mtx[2].z;
            float sg = mtx[2].w;

            vec2 u = uv*ziz;

            vec2 v = mod(u,vec2(p1)) + floor(u*p3)*p2;
            vec2 u1 = v + p1*vec2(0.,0.);
            vec2 u2 = v + p1*vec2(1.,0.);
            vec2 u3 = v + p1*vec2(0.,1.);
            vec2 u4 = v + p1*vec2(1.,1.);

            //.x=real .y=imagin  .z=real .w=imagin
            vec4 t1 = texture2D(tex,u1*zdv).xyzw; 
            vec4 t2 = texture2D(tex,u2*zdv).xyzw;
            vec4 t3 = texture2D(tex,u3*zdv).xyzw;
            vec4 t4 = texture2D(tex,u4*zdv).xyzw;

            vec2 ra = floor(u)*sg;
            vec2 a0 = wave(dot(ra,vec2(1.,0.)) + vec2(.0,-.5)*3.1415926535897932384626433832795,sg);
            vec2 a1 = wave(dot(ra,vec2(0.,1.)) + vec2(.0,-.5)*3.1415926535897932384626433832795,sg);
            vec2 a2 = wave(dot(ra,vec2(1.,1.)) + vec2(.0,-.5)*3.1415926535897932384626433832795,sg);
            
            gl_FragColor = t1 + t2.xxzz*a0.xyxy
                              + t2.yyww*a0.yxyx*vec4(-1.,1.,-1.,1.)
                              + t3.xxzz*a1.xyxy
                              + t3.yyww*a1.yxyx*vec4(-1.,1.,-1.,1.)
                              + t4.xxzz*a2.xyxy
                              + t4.yyww*a2.yxyx*vec4(-1.,1.,-1.,1.);

            //float pi = 3.1415926535897932384626433832795;
            //vec2 ra = floor(u)*sg;
            //vec4 m = vec4(.0,-.5, .0,-.5)*pi;
            //t1 = + t1.xxyy*cos(t1.zzww + m + dot(ra,vec2(0.,0.)) )
            //     + t2.xxyy*cos(t2.zzww + m + dot(ra,vec2(1.,0.)) )
            //     + t3.xxyy*cos(t3.zzww + m + dot(ra,vec2(0.,1.)) )
            //     + t4.xxyy*cos(t4.zzww + m + dot(ra,vec2(1.,1.)) );
            //gl_FragColor = vec4(length(t1.xy), length(t1.zw), atan(t1.y,t1.x), atan(t1.w,t1.z));
        }`;
        frSh9bfun = 
`
float pi = 3.1415926535897932384626433832795;
vec2 wave(vec2 a, float s)
{
    return cos(a);
  //return +asin(cos(a))*(2./pi)*float(s<0.)
  //       +     cos(a)         *float(s>0.);
  //return step(vec2(0.),cos(a))*2.-1.;
}
//customize the wave equation used in the fourier transform
//a is the angle
//s < 0 if doing the         fourier tranform
//  > 0 if doing the inverse fourier tranform`;
        let frSh9c =
        `precision highp float;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            gl_FragColor = texture2D(tex,uv).xyzw*mtx[0].y;     //.x=real .y=imagin  .z=real .w=imagin
        }`;
        let frSh9d =
        `precision highp float;
        uniform sampler2D tex0;
        uniform sampler2D tex1;
        uniform sampler2D tex2;
        uniform sampler2D tex3;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            float pi = 3.1415926535897932384626433832795;

            vec2 u = uv*vec2(4.,1.);    float a = u.x;
                 u = fract(u);
                 u = u*vec2(1.,mtx[1].w);
            vec2 ua = u*mtx[0].w + mtx[0].yz;
            vec2 ub = u*mtx[1].z + mtx[1].xy;
            if(a< 2.){u = ua;}
            if(a>=2.){u = ub;}

               //u = acos(cos(u*pi))/pi;
                 u = fract(u);

            float m2 = length(u-1.-floor(u-.5))*8.;    //undo natural 1/x curve
            if(mtx[3].y==0.){m2 = 1.;}

            vec4 t0 = texture2D(tex0,u).xyzw;
            vec4 t1 = texture2D(tex1,u).xyzw;
            vec4 t2 = texture2D(tex2,u).xyzw;
            vec4 t3 = texture2D(tex3,u).xyzw;

                float ra = mtx[3].z;
            if(a>=2.){ra = mtx[3].w;
                      t0 = t2;
                      t1 = t3;}
            
            vec4 s1 = vec4(length(t0.xy),  length(t0.zw),  length(t1.xy),  length(t1.zw))*m2;    
            vec4 s2 = vec4(atan(t0.y,t0.x),atan(t0.w,t0.z),atan(t1.y,t1.x),atan(t1.w,t1.z));  s2 = (s2+pi)*.15915494309;
            vec4 n1 = vec4(t0.xz,t1.xz);
            vec4 n2 = vec4(t0.yw,t1.yw);

            if(ra==0.){s1 = n1;
                       s2 = n2;}
            if(mod(a,2.)>=1.)
                      {s1 = s2;}

            s1 *= mtx[3].x;

            if(ra==0.){s1 = s1*.5+.5;}

            gl_FragColor = s1*mtx[2];
        }`;
        let frSh9e =
        `precision highp float;
        uniform sampler2D tex;
        uniform mat4 mtx;
        varying vec2 uv;
        void main()
        {
            vec2 u = vec2(uv.x,1.-uv.y);
                 u = u*mtx[0].xy;
            vec4 t = texture2D(tex,u).xyzw;
                 t*= float(u.x<=1. && u.y<=1.);

            if(mtx[0].z == 0.){t = vec4(t.x,0.,t.y,0.);}
            if(mtx[0].z != 0.){t = vec4(t.z,0.,t.w,0.);}

            gl_FragColor = t;    //.x=real .y=imagin  .z=real .w=imagin       
        }`;
        let frSh9f =
        `precision highp float;
        uniform sampler2D tex;
        varying vec2 uv;
        void main()
        {
            gl_FragColor = texture2D(tex,uv).xyzw;          
        }`;
        frSh9g =
        `precision highp float;
        uniform sampler2D tex4;
        uniform sampler2D tex5;
        uniform sampler2D tex6;
        uniform sampler2D tex7;
        uniform sampler2D tex8;
        uniform sampler2D tex9;
        uniform sampler2D tex10;
        uniform sampler2D tex11;
        uniform mat4 mtx0;
        uniform mat4 mtx1;
        varying vec2 uv;
        FUN
        void main()
        {
            vec4 rg = vec4(0.);
            vec4 ba = vec4(0.);
            paint(rg,
                  ba,
                  mtx0[0].w,          
                  uv,                 
                  mtx0[1].xy,                
                  mtx0[1].zw,                
                  mtx0[0].xyz,                
                  mtx0[2].xyzw,               
                  mtx0[3],
                  mtx1[0].x);
            if(mtx1[0].y != 0.){rg = ba;}
            gl_FragColor = rg;
        }`;
frSh9fun = [
`
var shd1 = \`
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    vec2 u = uv;                                u = u-1.-floor(u-.5);
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);
    
    vec4 t0 = texture2D(tex4,uv).xyzw;
    vec4 t1 = texture2D(tex5,uv).xyzw;

    float pointSize      = sld.x*sld.x*cam.z;
    float edgeSize       = sld.y*sld.y*cam.z;
    float ringSize       = sld.z*sld.z*cam.z;
    float additionAmount = .1;
        //additionAmount = sld.w*2.-1.;         //uncomment this line to control with [d = ] slider

    float l = abs(length(u-m)-ringSize);
          l = max(l-pointSize,0.);
          l = l/edgeSize;
          l = 1./exp(l*l)*additionAmount;

                       vec4 a = vec4(1.,0.,1.,0.);
    if(mod(mus.x,2.) >= 1.){a = vec4(0.,1.,0.,1.);}
                            a*= l;
    rg = t0+a;
    ba = t1+a;
}
\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    vec2 u = uv;                                u = u-1.-floor(u-.5);
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);
    
    vec4 t0 = texture2D(tex4,uv).xyzw;
    vec4 t1 = texture2D(tex5,uv).xyzw;

    float pointSize      = sld.x*sld.x*cam.z;
    float edgeSize       = sld.y*sld.y*cam.z;
    float ringSize       = sld.z*sld.z*cam.z;
    float additionAmount = .1;//sld.w*2.-1.;

    float l = abs(length(u-m)-ringSize);
          l = max(l-pointSize,0.);
          l = l/edgeSize;
          l = 1./exp(l*l)*additionAmount;

    vec2 rt = cos(l + vec2(.0,-.5)*3.1415926535897932384626433832795);
    vec4 s0 = t0.xxzz*rt.xyxy + t0.yyww*rt.yxyx*vec4(-1.,1.,-1.,1.);
    vec4 s1 = t1.xxzz*rt.xyxy + t1.yyww*rt.yxyx*vec4(-1.,1.,-1.,1.);

    vec2 k0 = vec2(length(t0.xy), length(t0.zw));   vec2 f0 = l/k0;  if(k0.x==0.){f0.x = 0.;} if(k0.y==0.){f0.y = 0.;}
    vec2 k1 = vec2(length(t1.xy), length(t1.zw));   vec2 f1 = l/k1;  if(k1.x==0.){f1.x = 0.;} if(k1.y==0.){f1.y = 0.;}
    rg = t0 * (1. + f0).xxyy;
    ba = t1 * (1. + f1).xxyy;

    if(mod(mus.x,2.) >= 1.){rg = s0;
                            ba = s1;}
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    vec2 u = uv;                                u = u-1.-floor(u-.5);
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);
    
    vec4 t0 = texture2D(tex4,uv).xyzw;
    vec4 t1 = texture2D(tex5,uv).xyzw;
    
    float pointSize      = sld.x*sld.x*cam.z;
    float edgeSize       = sld.y*sld.y*cam.z;
    float ringSize       = sld.z*sld.z*cam.z;
    float multiplyAmount = .5;//sld.w*2.;       //.5 = multiply by 1.5    -.5 = multiply by .5

    float l = abs(length(u-m)-ringSize);
          l = max(l-pointSize,0.);
          l = l/edgeSize;
          l = 1./exp(l*l)*multiplyAmount;
          l+= 1.; 

    vec4 a  = vec4(atan(t0.y,t0.x),atan(t0.w,t0.z),atan(t1.y,t1.x),atan(t1.w,t1.z))*l;
    vec4 s0 = cos(a.xxyy + vec4(.0,-.5,.0,-.5)*3.1415926)*vec2(length(t0.xy),length(t0.zw)).xxyy;
    vec4 s1 = cos(a.zzww + vec4(.0,-.5,.0,-.5)*3.1415926)*vec2(length(t1.xy),length(t1.zw)).xxyy;

    rg = t0*l;
    ba = t1*l;

    if(mod(mus.x,2.) >= 1.){rg = s0;
                            ba = s1;}
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    vec4 t0 = texture2D(tex4,uv).xyzw;
    vec4 t1 = texture2D(tex5,uv).xyzw;

    vec2  m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);
          m = abs(m);
    float e = 24./rez;
        //e = max(m.x,m.y);  //control with mouse
    
    vec2  a = abs(uv-1.-floor(uv-.5));
    float c = max(a.x,a.y);
          c = float(c>e)*(1.+e*rez*.25);

    rg = t0*c;
    ba = t1*c;
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    vec2 u = uv;                                u = u-1.-floor(u-.5)-.5/rez;
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);
    
    vec4 t0 = texture2D(tex4,uv).xyzw;
    vec4 t1 = texture2D(tex5,uv).xyzw;

    vec2  a = abs(u);
    float b = sld.y*sld.y;
          b = 24./rez;                      //comment this line to control range of frequencies to translate with slider
    
    float g = length(u)/b;
          g = 1./exp(g*g);
          g = float(a.x < b && a.y < b);    //comment this line for rare effect

    float l = dot(u,mud)*1024.*g;           //click and drag
    vec2 rt = cos(l + vec2(.0,-.5)*3.1415926535897932384626433832795);

    rg = t0.xxzz*rt.xyxy + t0.yyww*rt.yxyx*vec4(-1.,1.,-1.,1.);
    ba = t1.xxzz*rt.xyxy + t1.yyww*rt.yxyx*vec4(-1.,1.,-1.,1.);
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    vec2 u = uv;                                u = u-1.-floor(u-.5)-.5/rez;
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);
    
    vec4 t0 = texture2D(tex4,uv).xyzw;
    vec4 t1 = texture2D(tex5,uv).xyzw;

    vec2  a = abs(u);
    float b = sld.y*sld.y;
          b = 24./rez;                      //comment this line to control range of frequencies to waterwave with slider
    
    float g = float(a.x < b && a.y < b);

    float l = length(u)*16.*g;
    vec2 rt = cos(l + vec2(.0,-.5)*3.1415926535897932384626433832795);

    rg = t0.xxzz*rt.xyxy + t0.yyww*rt.yxyx*vec4(-1.,1.,-1.,1.);
    ba = t1.xxzz*rt.xyxy + t1.yyww*rt.yxyx*vec4(-1.,1.,-1.,1.);
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    float zoom = .5;
    vec2 u = uv-1.-floor(uv-.5);
         u = u*zoom;
    vec4 t0 = texture2D(tex4,u).xyzw;
    vec4 t1 = texture2D(tex5,u).xyzw;
                    u = fract(u*rez);
    float c = float(u.x<zoom &&
                    u.y<zoom);
    rg = t0*c;
    ba = t1*c;
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    float zoom = 2.;
    vec2 u = uv-1.-floor(uv-.5);
         u = u*zoom;                     float m = .25/rez;
    vec4 t0 = +texture2D(tex4,u+vec2( 1., 1.)*m).xyzw*1.
              +texture2D(tex4,u+vec2(-1., 1.)*m).xyzw*0.
              +texture2D(tex4,u+vec2( 1.,-1.)*m).xyzw*0.
              +texture2D(tex4,u+vec2(-1.,-1.)*m).xyzw*0.;
    vec4 t1 = +texture2D(tex5,u+vec2( 1., 1.)*m).xyzw*1.
              +texture2D(tex5,u+vec2(-1., 1.)*m).xyzw*0.
              +texture2D(tex5,u+vec2( 1.,-1.)*m).xyzw*0.
              +texture2D(tex5,u+vec2(-1.,-1.)*m).xyzw*0.;
    float c = float(u.x<.5 && u.x>=-.5 &&
                    u.y<.5 && u.y>=-.5 );
          c*= 4.;
    rg = t0*c;
    ba = t1*c;
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    vec2 u = uv;                                u = u-1.-floor(u-.5);
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);
    
    vec4 t0 = texture2D(tex4,uv).xyzw;
    vec4 t1 = texture2D(tex5,uv).xyzw;

    float edgeSize       = length(m);
    float additionAmount = .5*3.1415926535897932384626433832795;//sld.w*2.-1.;

    float l = length(u);
          l = l/edgeSize;
          l = 1./exp(l*l)*additionAmount;

    vec2 rt = cos(l + vec2(.0,-.5)*3.1415926535897932384626433832795);
    rg = t0.xxzz*rt.xyxy + t0.yyww*rt.yxyx*vec4(-1.,1.,-1.,1.);
    ba = t1.xxzz*rt.xyxy + t1.yyww*rt.yxyx*vec4(-1.,1.,-1.,1.);
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    vec2 u = uv;                                u = u-1.-floor(u-.5);
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);
    
    vec4 t0 = texture2D(tex4,uv).xyzw;
    vec4 t1 = texture2D(tex5,uv).xyzw;

    float a = float(!(sign(u.x)==sign(m.x) && 
                      sign(u.y)==sign(m.y) ));
    rg = t0 * a;
    ba = t1 * a;
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    vec2 u = uv;                                u = u-1.-floor(u-.5);
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);

    if((sign(u.x)==sign(m.x) && 
        sign(u.y)==sign(m.y) ))
    {
        u.x = .5-u.x;
        u.y = .5-u.y;
    }
    vec4 t0 = texture2D(tex4,u).xyzw;
    vec4 t1 = texture2D(tex5,u).xyzw;
    rg = t0;
    ba = t1;
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`

vec2 complexMultiply(vec2 a, vec2 b){return a.xx*b.xy+
                                            a.yy*b.yx*vec2(-1.,1.);}

                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    float pi = 3.1415926535897932384626433832795;

    vec2 u = (uv*2.-1.)*3.;
         u = complexMultiply(cos(mus.x*4.-vec2(.0,.5)*pi),u);
         u*= mus.y*4.;
    vec2 v = u;
    for(float i = 0.; i < 10.; ++i)
    {
        u = complexMultiply(u,u)-v;
        if(length(u)>=1.){u=normalize(u)*1.;}
    }
    rg = u.xyxy;
    ba = u.xyxy;
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`

vec2 complexMultiply(vec2 a, vec2 b){return a.xx*b.xy+
                                            a.yy*b.yx*vec2(-1.,1.);}

                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    float pi = 3.1415926535897932384626433832795;
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  //m = m-1.-floor(m-.5);
    vec2 u = ((uv-m+.5)*2.-1.)*8.;
    vec2 v = u;
    for(float i = 0.; i < 8.; ++i)
    {
        u = complexMultiply(u,u)-v;
        if(length(u)>=1.){u=normalize(u)*1.;}
    }
          v = uv-m;
    float a = 1./exp(dot(v,v)*128.);
    rg = u.xyxy*a;
    ba = u.xyxy*a;
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var shd1 = \`
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    vec2 u = uv;                                u = u-1.-floor(u-.5);
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);
    
    vec4 t0 = texture2D(tex4,uv).xyzw;
    vec4 t1 = texture2D(tex5,uv).xyzw;
    
    float amount = .2;
        //amount = fract(mus.x);        //uncomment this line to control with mouse

    float l = length(u);
          l = l/amount;
          l = exp(l*l);

    float range = .3;                   //limit range of affected frequencies
    if(length(u)>range){l=1.;}

    rg = t0*l;
    ba = t1*l;
}\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    var rd = inpX9 & (~1);              //inpX9 = integer = which of the 4 screen images was clicked 
    copy2D(4,rd+0);                     //copy2D(destination texture, source texture) 
    copy2D(5,rd+1);
    paint2D(rd,0);                      //paint2D(destination textures pair, shader in shadas array) 
    var dst = 0;                        //fft2D destination textures pair
    var src = 0;                        //fft2D source      textures pair
    var sgn = 0;                        //fft2D rotation amount, -1 to convert from space     to frequency
                                        //                        1 to convert from frequency to space
    if(inpX9<2){dst=2; src=0; sgn=-1;}
    else       {dst=0; src=2; sgn= 1;}
    fft2D(dst,src,sgn);
};`,
`
var wav = \`

void paint( out vec4 rg, out vec4 ba,
            float rez, vec2 uv, vec2 mus, vec2 mud, vec3 cam, vec4  rgba, vec4 sld,float roa)
{
    vec2 u = uv;                                u = u-1.-floor(u-.5)-.5/rez;
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);
    u*=2.;
    vec2 u1 = u-0.;
    vec2 u2 = u-fract(mus);
    float pi = 3.1415926535897932384626433832795;
    float l = .1;//mus.y;
          //l = .01/(l*l+dot(u1,u1));
          //l = 1./exp(dot(u1,u1)/l);
          //l = max(1.-dot(u1,u1)/l,0.);
          //l = min(1.,.1/length(u1));
          l = length(u1);
          //u1 = abs(u1); l = max(u1.x,u1.y);
          //l = 1./pow(length(u1)+1.,2.);
    rg = l*vec4(1.,0.,1.,0.);
    ba = rg;
}\`;
var wavs = \`

void paint( out vec4 rg, out vec4 ba,
            float rez, vec2 uv, vec2 mus, vec2 mud, vec3 cam, vec4  rgba, vec4 sld,float roa)
{
    vec2 u = clamp(uv*2.,vec2(0.5),vec2(1.5));//u = u-1.-floor(u-.5);
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);
    
    float pi = 3.1415926535897932384626433832795;
    const float n = 16.;
    float s = 0.;
    vec2 u1 = vec2(.8,.0)+.5;
    for(float i = 0.; i < n; ++i)
    {
        float ni = i/n;
        vec2 u2 = u1-u; u1 += cos(ni*ni*8.+pi*.5+vec2(.0,-.5)*pi)*2./n;
        float l = 1.5/rez;//ni*.0+.01;//mus.y;
              //s+= l*l/dot(u2,u2);
        //s += 1./exp(dot(u2,u2)/l);
        //s += max(1.-dot(u2,u2)/l,0.);
        //s += min(1.,.1/length(u2));
        s += length(u2);
        //u2 = abs(u2); s += max(u2.x,u2.y);
        //s += 1./pow(length(u2)+1.,2.);
    }
    s = s/n;
    
    //s+= (rand(uv)-.5)*float(uv.x>=.5 || uv.y>=.5);
    //s = sqrt(log(1./s)*.01);
    //s*=float(uv.x<.25 && uv.y<.25 && uv.x>=-.25 &&uv.y>=-.25);
    //s = s/exp(dot(uv,uv)*111.);
    vec2 r = max(abs(uv-.5)-.25,vec2(0.));
    s = s/exp(dot(r,r)*111.);
    rg = s*vec4(1.,0.,1.,0.);
    ba = rg;
}\`;

var conv = \`

vec2 cmul( vec2 a, vec2 b ){ return vec2( a.x*b.x - a.y*b.y, a.x*b.y + a.y*b.x ); }
vec2 cdiv( vec2 a, vec2 b ){ return vec2( dot(a,b), a.y*b.x - a.x*b.y ) / dot(b,b); }
void cmul(out vec4 o1,out vec4 o2, vec4 a1,vec4 a2, vec4 b1,vec4 b2){ o1 = vec4(cmul(a1.xy,b1.xy),cmul(a1.zw,b1.zw));
                                                                      o2 = vec4(cmul(a2.xy,b2.xy),cmul(a2.zw,b2.zw)); }
void cdiv(out vec4 o1,out vec4 o2, vec4 a1,vec4 a2, vec4 b1,vec4 b2){ o1 = vec4(cdiv(a1.xy,b1.xy),cdiv(a1.zw,b1.zw));
                                                                      o2 = vec4(cdiv(a2.xy,b2.xy),cdiv(a2.zw,b2.zw)); }
void paint( out vec4 rg, out vec4 ba,
            float rez, vec2 uv, vec2 mus, vec2 mud, vec3 cam, vec4  rgba, vec4 sld, float roa)
{
    vec4 t6 = texture2D(tex6,uv).xyzw;
    vec4 t7 = texture2D(tex7,uv).xyzw;
    vec4 t8 = texture2D(tex8,uv).xyzw;
    vec4 t9 = texture2D(tex9,uv).xyzw;
    cdiv(rg,ba, t6,t7, t8,t9);
    float a = 1./rez;
    rg *= a;
    ba *= a;
}\`;

var shadas = [wav,wavs,conv];

var renderSteps = function()        //this works only after pressing [resize] button for tex6 tex7 tex8 tex9 tex10 tex11
{
    paint2D( 2,0);  fft2D(6, 2,-1);
    paint2D( 2,1);  fft2D(8, 2,-1);
    paint2D(10,2);  fft2D(0,10, 1);
};`,
`
var wavelet = \`

void paint( out vec4 rg, out vec4 ba,
            float rez, vec2 uv, vec2 mus, vec2 mud, vec3 cam, vec4  rgba, vec4 sld,float roa)
{
    float pi = 3.1415926535897932384626433832795;

    vec2 m = cam.xy + fract(mus)*cam.z;  m = m-1.-floor(m-.5);
    vec2 u = uv;                         u = u-1.-floor(u-.5)-.5/rez;
         u = u/length(m);
    
    float l = sld.x*8.;
          l = 1.5;                              //comment this line to control frequency with slider
    float am = l*l/exp(dot(u,u))/dot(m,m)/rez;
    float ph = dot(u,normalize(m))*2.*l;
    rg = am*cos(ph + vec4(.0,-.5,.0,-.5)*pi);
    ba = rg;
}
\`;

var convol = \`

vec2 cmul( vec2 a, vec2 b ){ return vec2( a.x*b.x - a.y*b.y, a.x*b.y + a.y*b.x ); }
vec2 cdiv( vec2 a, vec2 b         ){ return vec2( dot(a,b), a.y*b.x - a.x*b.y ) / dot(b,b); }
void cmul(out vec4 o1,out vec4 o2, vec4 a1,vec4 a2, vec4 b1,vec4 b2){ o1 = vec4(cmul(a1.xy,b1.xy),cmul(a1.zw,b1.zw));
                                                                      o2 = vec4(cmul(a2.xy,b2.xy),cmul(a2.zw,b2.zw)); }
void cdiv(out vec4 o1,out vec4 o2, vec4 a1,vec4 a2, vec4 b1,vec4 b2){ o1 = vec4(cdiv(a1.xy,b1.xy),cdiv(a1.zw,b1.zw));
                                                                      o2 = vec4(cdiv(a2.xy,b2.xy),cdiv(a2.zw,b2.zw)); }
void paint( out vec4 rg, out vec4 ba,
            float rez, vec2 uv, vec2 mus, vec2 mud, vec3 cam, vec4  rgba, vec4 sld, float roa)
{
    vec4 t6 = texture2D(tex6,uv).xyzw;
    vec4 t7 = texture2D(tex7,uv).xyzw;
    vec4 t8 = texture2D(tex8,uv).xyzw;
    vec4 t9 = texture2D(tex9,uv).xyzw;
    cmul(rg,ba, t6,t7, t8,t9);
}\`;

var shadas = [wavelet,convol];
                                    //this works only after pressing [resize] button for tex6 tex7 tex8 tex9 tex10 tex11
                                    //then put the FFT of any image into tex6 tex7
var renderSteps = function()        //then run renderSteps()
{                           
    paint2D( 2,0);  fft2D(8, 2,-1);
    paint2D(10,1);  fft2D(0,10, 1);
};`,
`

var wavelet = \`

void paint( out vec4 rg, out vec4 ba,
            float rez, vec2 uv, vec2 mus, vec2 mud, vec3 cam, vec4  rgba, vec4 sld,float roa)
{
    float pi = 3.1415926535897932384626433832795;

    vec2 m = cam.xy + fract(mus)*cam.z;  m = m-1.-floor(m-.5);
    vec2 u = uv;                         u = u-1.-floor(u-.5)-.5/rez;    float v = float(length(u)*rez<.1)*rez;
         u = u/length(m);
    
    float l = sld.x*8.;
          l = 3.;                       //comment this line to control frequency with slider
    float am = l*l/exp(dot(u,u))/dot(m,m)/rez;
    float ph = dot(u,normalize(m))*2.*l*length(u);
    rg = am*cos(ph + -.5*pi)*vec4(1.,0.,1.,0.)+v*vec4(0.,1.,0.,1.);
    ba = rg;
}\`;

var convol = \`

vec2 cmul( vec2 a, vec2 b ){ return vec2( a.x*b.x - a.y*b.y, a.x*b.y + a.y*b.x ); }
vec2 cdiv( vec2 a, vec2 b         ){ return vec2( dot(a,b), a.y*b.x - a.x*b.y ) / dot(b,b); }
void cmul(out vec4 o1,out vec4 o2, vec4 a1,vec4 a2, vec4 b1,vec4 b2){ o1 = vec4(cmul(a1.xy,b1.xy),cmul(a1.zw,b1.zw));
                                                                      o2 = vec4(cmul(a2.xy,b2.xy),cmul(a2.zw,b2.zw)); }
void cdiv(out vec4 o1,out vec4 o2, vec4 a1,vec4 a2, vec4 b1,vec4 b2){ o1 = vec4(cdiv(a1.xy,b1.xy),cdiv(a1.zw,b1.zw));
                                                                      o2 = vec4(cdiv(a2.xy,b2.xy),cdiv(a2.zw,b2.zw)); }
void paint( out vec4 rg, out vec4 ba,
            float rez, vec2 uv, vec2 mus, vec2 mud, vec3 cam, vec4  rgba, vec4 sld, float roa)
{
    vec4 t6 = texture2D(tex6,uv).xyzw;
    vec4 t7 = texture2D(tex7,uv).xyzw;
    vec4 t8 = texture2D(tex8,uv).xyzw;
    vec4 t9 = texture2D(tex9,uv).xyzw;
    cmul(rg,ba, t6,t7, t8,t9);
}\`;

var rotate = \`

vec2 cmul( vec2 a, vec2 b ){ return vec2( a.x*b.x - a.y*b.y, a.x*b.y + a.y*b.x ); }
vec2 cdiv( vec2 a, vec2 b         ){ return vec2( dot(a,b), a.y*b.x - a.x*b.y ) / dot(b,b); }
void cmul(out vec4 o1,out vec4 o2, vec4 a1,vec4 a2, vec4 b1,vec4 b2){ o1 = vec4(cmul(a1.xy,b1.xy),cmul(a1.zw,b1.zw));
                                                                      o2 = vec4(cmul(a2.xy,b2.xy),cmul(a2.zw,b2.zw)); }
void cdiv(out vec4 o1,out vec4 o2, vec4 a1,vec4 a2, vec4 b1,vec4 b2){ o1 = vec4(cdiv(a1.xy,b1.xy),cdiv(a1.zw,b1.zw));
                                                                      o2 = vec4(cdiv(a2.xy,b2.xy),cdiv(a2.zw,b2.zw)); }
void paint( out vec4 rg, out vec4 ba,
            float rez, vec2 uv, vec2 mus, vec2 mud, vec3 cam, vec4  rgba, vec4 sld, float roa)
{
    float pi = 3.1415926535897932384626433832795;
    vec4 t1 = texture2D(tex8,uv).xyzw;
    vec4 t2 = texture2D(tex9,uv).xyzw;
    float ph = -uv.y*pi*.5;
    vec4 t3 = cos(ph + vec4(.0,-.5,.0,-.5)*pi);
    vec4 t4 = t3;
    cmul(rg,ba, t6,t7, t8,t9);
}\`;

var shadas = [wavelet,convol,rotate];
                                    //this works only after pressing [resize] button for tex6 tex7 tex8 tex9 tex10 tex11
                                    //then put the FFT of any image into tex6 tex7
var renderSteps = function()        //then run renderSteps()
{
    paint2D( 2,0);  fft2D(8, 2,-1);
    paint2D(10,1);  fft2D(8,10, 1);
    paint2D( 0,2);
};`,
`

var shd1 = \`

void paint( out vec4 rg, out vec4 ba,
            float rez, vec2 uv, vec2 mus, vec2 mud, vec3 cam, vec4  rgba, vec4 sld, float roa)
{
    vec2 m = fract(cam.xy + fract(mus)*cam.z);
    float x = uv.x + floor(uv.y*rez)*m.x;
    vec2  u = vec2(fract(x),x/rez);
    vec4 t6 = texture2D(tex6,u).xyzw;
    vec4 t7 = texture2D(tex7,u).xyzw;
    float a = float(uv.x<m.x);
    rg = t6*a;
    ba = t7*a;
}\`;

var shadas = [shd1];
                                        //this works only after loading a sound then pressing [resize] button for tex6 tex7
                                        //then put the FFT of the sound into tex6 tex7
var renderSteps = function()            //then run renderSteps()
{
    paint2D(0,0);
    fft2D(2,0,-1);
};`,
`
var shd1 = \`
float rand(vec2 co){
    return fract(sin(dot(co.xy ,vec2(23.9898,578.233))) * 1758.54153);
}
                            //texture2D() can load tex4 tex5 tex6 tex7 tex8 tex9 tex10 tex11
void paint( out vec4 rg,    //.xy = real|imaginary of red  color  .zw = real|imaginary of green color
            out vec4 ba,    //.xy = real|imaginary of blue color  .zw = real|imaginary of alpha color
            float rez,      //resolution of render target
            vec2  uv,       //pixel coordinate    range    0 to 1
            vec2  mus,      //mouse coordinate    range .x 0 to 4  because there are 4 images on screen
                            //                          .y 0 to 1
            vec2  mud,      //mouse movement since last frame
            vec3  cam,      //camera     .x position .y position .z zoom
            vec4  rgba,     //checkboxes .x red      .y green    .z blue .w alpha    0 = off  1 = on
            vec4  sld,      //PAINT sliders .x = a slider  .y = b slider  .z = c slider  .w = d slider
            float roa)      //slider view mode  0 = showing real|imaginary    1 = showing amplitud|phase
{
    vec2 u = uv;                                u = u-1.-floor(u-.5);
    vec2 m = fract(cam.xy + fract(mus)*cam.z);  m = m-1.-floor(m-.5);

    float r0 = rand(u-4.)*2.-1.;
    float g0 = rand(u-2.)*2.-1.;
    float b0 = rand(u+0.)*2.-1.;
    float r1 = rand(u+2.)*2.-1.;
    float g1 = rand(u+4.)*2.-1.;
    float b1 = rand(u+6.)*2.-1.;
    //vec2 v = abs(u);
    //float c = float(abs(max(v.x,v.y)-m.x)*8./m.y<.5);
    float c = 1./exp(pow((length(u)-m.x)*8./m.y,2.));
    rg = vec4(r0,r1,g0,g1)*c;
    ba = vec4(b0,b1, 0, 0)*c;
}
\`;

var shadas = [shd1];

var renderSteps = function()            //what to do when clicking screen
{
    paint2D(2,0);
    fft2D(0,2,1);
};`
];

        frSh9funTitle = ["addition to real|imaginary","addition to amplitud|phase","multiplication to amplitud|phase","square filter",
                         "low frequency translation","waterwave image","zoom out","zoom in","waves rotor","blackout cuadrant",
                         "flip cuadrant","image zoom & rotation","image translation","undo gaussian blur","inverse convolution",
                         "wavelet convolution","wavelet convolution transition","sound clamp","circular noise"];

        let frSh9k =
        `precision highp float;
        uniform sampler2D tex4;
        uniform sampler2D tex5;
        uniform sampler2D tex6;
        uniform sampler2D tex7;
        uniform sampler2D tex8;
        uniform sampler2D tex9;
        uniform sampler2D tex10;
        uniform sampler2D tex11;
        varying vec2 uv;
        void main()
        {
            vec2 u = uv*vec2(8.,1.);
            float a = floor(u.x);
            vec4 t = +texture2D(tex4 ,u)*float(a==0.)
                     +texture2D(tex5 ,u)*float(a==1.)
                     +texture2D(tex6 ,u)*float(a==2.)
                     +texture2D(tex7 ,u)*float(a==3.)
                     +texture2D(tex8 ,u)*float(a==4.)
                     +texture2D(tex9 ,u)*float(a==5.)
                     +texture2D(tex10,u)*float(a==6.)
                     +texture2D(tex11,u)*float(a==7.);
            gl_FragColor = t;
        }`;

        shaderCreator = function(vectexShaderCode, fragmentShaderCode)
        {
            var shader0 = gl.createShader(gl.VERTEX_SHADER);
            gl.shaderSource(shader0, vectexShaderCode);
            gl.compileShader(shader0);
            if(!gl.getShaderParameter(shader0, gl.COMPILE_STATUS)){alert(gl.getShaderInfoLog(shader0)); gl.deleteShader(shader0); return null;}
            
            var shader1 = gl.createShader(gl.FRAGMENT_SHADER);
            gl.shaderSource(shader1, fragmentShaderCode);
            gl.compileShader(shader1);
            if(!gl.getShaderParameter(shader1, gl.COMPILE_STATUS)){alert(gl.getShaderInfoLog(shader1)); gl.deleteShader(shader1); return null;}

            var shaderProgram = gl.createProgram();
            gl.attachShader(shaderProgram, shader0);
            gl.attachShader(shaderProgram, shader1);
            gl.linkProgram(shaderProgram);

            gl.detachShader(shaderProgram, shader0);
            gl.detachShader(shaderProgram, shader1);
            gl.deleteShader(shader0);
            gl.deleteShader(shader1);

            return shaderProgram;
        };

        //physics shaders
        shaderP0 = shaderCreator(vxSh0, frSh0);
        shdVtx0 = gl.getAttribLocation(shaderP0, "vtx");
        shdMtx0 = gl.getUniformLocation(shaderP0, "mtx");
        shdTex0 = gl.getUniformLocation(shaderP0, "tex");

        shaderP0b = shaderCreator(vxSh0b, frSh0b);
        shdVtx0b = gl.getAttribLocation(shaderP0b, "vtx");
        shdMtx0b = gl.getUniformLocation(shaderP0b, "mtx");

        shaderP0c = shaderCreator(vxSh0c, frSh0c);
        shdVtx0c = gl.getAttribLocation(shaderP0c, "vtx");
        shdMtx0c = gl.getUniformLocation(shaderP0c, "mtx");

        shaderP1 = shaderCreator(vxSh1, frSh1);
        shdVtx1 = gl.getAttribLocation(shaderP1, "vtx");
        shdMtx1 = gl.getUniformLocation(shaderP1, "mtx");
        shdTex1 = gl.getUniformLocation(shaderP1, "tex");

        shaderP2 = shaderCreator(vxSh2, frSh2);
        shdVtx2 = gl.getAttribLocation(shaderP2, "vtx");
        shdMtx2 = gl.getUniformLocation(shaderP2, "mtx");
        shdTex2 = gl.getUniformLocation(shaderP2, "tex");

        shaderP2b = shaderCreator(vxSh2b, frSh2b);
        shdVtx2b = gl.getAttribLocation(shaderP2b, "vtx");
        shdMtx2b = gl.getUniformLocation(shaderP2b, "mtx");

        shaderP3 = shaderCreator(vxSh3, frSh3);
        shdVtx3 = gl.getAttribLocation(shaderP3, "vtx");
        shdMtx3 = gl.getUniformLocation(shaderP3, "mtx");

        shaderP4 = shaderCreator(vxSh4, frSh4);
        shdVtx4 = gl.getAttribLocation(shaderP4, "vtx");
        shdMtx4 = gl.getUniformLocation(shaderP4, "mtx");

        shaderP5a = shaderCreator(vxSh5a, frSh5a);
        shdVtx5a = gl.getAttribLocation(shaderP5a, "vtx");
        shdMtx5a = gl.getUniformLocation(shaderP5a, "mtx");

        shaderP5b = shaderCreator(vxSh5b, frSh5b);
        shdVtx5b = gl.getAttribLocation(shaderP5b, "vtx");
        shdMtx5b = gl.getUniformLocation(shaderP5b, "mtx");
        shdTex5b = gl.getUniformLocation(shaderP5b, "tex");

        shaderP5c = shaderCreator(vxSh5c, frSh5c);
        shdVtx5c = gl.getAttribLocation(shaderP5c, "vtx");
        shdMtx5c = gl.getUniformLocation(shaderP5c, "mtx");
        shdTex5c = gl.getUniformLocation(shaderP5c, "tex");

        shaderP6a = shaderCreator(vxSh6a, frSh6a);
        shdVtx6a = gl.getAttribLocation(shaderP6a, "vtx");
        shdMtx6a = gl.getUniformLocation(shaderP6a, "mtx");

        shaderP6b = shaderCreator(vxSh6a, frSh6b);
        shdVtx6b = gl.getAttribLocation(shaderP6b, "vtx");
        shdMtx6b = gl.getUniformLocation(shaderP6b, "mtx");

        shaderP6c = shaderCreator(vxSh6a, frSh6c);
        shdVtx6c = gl.getAttribLocation(shaderP6c, "vtx");
        shdMtx6c = gl.getUniformLocation(shaderP6c, "mtx");

        shaderP6d = shaderCreator(vxSh6a, frSh6d);
        shdVtx6d = gl.getAttribLocation(shaderP6d, "vtx");
        shdMtx6d = gl.getUniformLocation(shaderP6d, "mtx");

        shaderP6e = shaderCreator(vxSh6e, frSh6e);
        shdVtx6e = gl.getAttribLocation(shaderP6e, "vtx");
        shdMtx6e = gl.getUniformLocation(shaderP6e, "mtx");
        shdTex6e = gl.getUniformLocation(shaderP6e, "tex");

        shaderP6f = shaderCreator(vxSh6f, frSh6f);
        shdVtx6f = gl.getAttribLocation(shaderP6f, "vtx");
        shdMtx6f = gl.getUniformLocation(shaderP6f, "mtx");
        shdTex6f = gl.getUniformLocation(shaderP6f, "tex");

        shaderP6g = shaderCreator(vxSh6g, frSh6g);
        shdVtx6g = gl.getAttribLocation(shaderP6g, "vtx");
        shdMtx6g = gl.getUniformLocation(shaderP6g, "mtx");

        shaderP7a1 = shaderCreator(vxSh7a1, frSh7a1);
        shdVtx7a1 = gl.getAttribLocation(shaderP7a1, "vtx");
        shdMtx7a1 = gl.getUniformLocation(shaderP7a1, "mtx");
        shdTex7a1 = gl.getUniformLocation(shaderP7a1, "tex");

        shaderP7a2 = shaderCreator(vxSh7a1, frSh7a2);
        shdVtx7a2 = gl.getAttribLocation(shaderP7a2, "vtx");
        shdMtx7a2 = gl.getUniformLocation(shaderP7a2, "mtx");
        shdTex7a2 = gl.getUniformLocation(shaderP7a2, "tex");

        shaderP7b = shaderCreator(vxSh7b, frSh7b);
        shdVtx7b = gl.getAttribLocation(shaderP7b, "vtx");
        shdMtx7b = gl.getUniformLocation(shaderP7b, "mtx");
        shdTex7b = gl.getUniformLocation(shaderP7b, "tex");

        shaderP7c = shaderCreator(vxSh7c, frSh7c);
        shdVtx7c = gl.getAttribLocation(shaderP7c, "vtx");
        shdMtx7c = gl.getUniformLocation(shaderP7c, "mtx");
        shdTex7c = gl.getUniformLocation(shaderP7c, "tex");

        shaderP7d = shaderCreator(vxSh7d, frSh7d);
        shdVtx7d = gl.getAttribLocation(shaderP7d, "vtx");
        shdMtx7d = gl.getUniformLocation(shaderP7d, "mtx");
        shdTex7d = gl.getUniformLocation(shaderP7d, "tex");

        shaderP8a = shaderCreator(vxSh8a, frSh8a.replace("FUN",frSh8fun));
        shdVtx8a = gl.getAttribLocation(shaderP8a, "vtx");
        shdMtx8a = gl.getUniformLocation(shaderP8a, "mtx");
        shdTex8a0= gl.getUniformLocation(shaderP8a, "tex0");
        shdTex8a1= gl.getUniformLocation(shaderP8a, "tex1");

        shaderP8b = shaderCreator(vxSh8a, frSh8b);
        shdVtx8b = gl.getAttribLocation(shaderP8b, "vtx");
        shdMtx8b = gl.getUniformLocation(shaderP8b, "mtx");
        shdTex8b0= gl.getUniformLocation(shaderP8b, "tex0");
        shdTex8b1= gl.getUniformLocation(shaderP8b, "tex1");

        shaderP8c = shaderCreator(vxSh8a, frSh8c.replace("FUN",frSh8fun));
        shdVtx8c = gl.getAttribLocation(shaderP8c, "vtx");
        shdMtx8c = gl.getUniformLocation(shaderP8c, "mtx");
        shdTex8c = gl.getUniformLocation(shaderP8c, "tex");

        //shaderP8d not here but iniShdr8d

        shaderP9a = shaderCreator(vxSh9a, frSh9a);
        shdVtx9a = gl.getAttribLocation(shaderP9a, "vtx");
        shdMtx9a = gl.getUniformLocation(shaderP9a, "mtx");
        shdTex9a0 = gl.getUniformLocation(shaderP9a, "tex0");
        shdTex9a1 = gl.getUniformLocation(shaderP9a, "tex1");

        shaderP9b = null;
        iniShdr9b = function(shdfun)
        {
            var frd = frSh9b.replace("FUN",shdfun);
            var shd = shaderCreator(vxSh9a, frd);   if(shd == null){return;}
            if(shaderP9b != null)
            {
                gl.useProgram(null);
                gl.deleteProgram(shaderP9b);
            }
            shaderP9b = shd;
            shdVtx9b = gl.getAttribLocation(shaderP9b, "vtx");
            shdMtx9b = gl.getUniformLocation(shaderP9b, "mtx");
            shdTex9b = gl.getUniformLocation(shaderP9b, "tex");
        }
        iniShdr9b(frSh9bfun);

        shaderP9c = shaderCreator(vxSh9a, frSh9c);
        shdVtx9c = gl.getAttribLocation(shaderP9c, "vtx");
        shdMtx9c = gl.getUniformLocation(shaderP9c, "mtx");
        shdTex9c = gl.getUniformLocation(shaderP9c, "tex");

        shaderP9d = shaderCreator(vxSh9a, frSh9d);
        shdVtx9d  = gl.getAttribLocation(shaderP9d, "vtx");
        shdMtx9d  = gl.getUniformLocation(shaderP9d, "mtx");
        shdTex9d0 = gl.getUniformLocation(shaderP9d, "tex0");
        shdTex9d1 = gl.getUniformLocation(shaderP9d, "tex1");
        shdTex9d2 = gl.getUniformLocation(shaderP9d, "tex2");
        shdTex9d3 = gl.getUniformLocation(shaderP9d, "tex3");

        shaderP9e = shaderCreator(vxSh9a, frSh9e);
        shdVtx9e  = gl.getAttribLocation(shaderP9e, "vtx");
        shdMtx9e  = gl.getUniformLocation(shaderP9e, "mtx");
        shdTex9e  = gl.getUniformLocation(shaderP9e, "tex");

        shaderP9f = shaderCreator(vxSh9a, frSh9f);
        shdVtx9f  = gl.getAttribLocation( shaderP9f, "vtx");
        shdTex9f  = gl.getUniformLocation(shaderP9f, "tex");

        iniShdr9g = function(shdfun)
        {
            var o = null;
            var f = frSh9g.replace("FUN",shdfun);
            var s = shaderCreator(vxSh9a, f);
            if( s == null){return o;}
            
            o = new Object();
            o.shaderP9g  = s;
            o.shdVtx9g   = gl.getAttribLocation( s,"vtx"  );
            o.shdMtx9g0  = gl.getUniformLocation(s,"mtx0" );
            o.shdMtx9g1  = gl.getUniformLocation(s,"mtx1" );
            o.shdTex9g4  = gl.getUniformLocation(s,"tex4" );
            o.shdTex9g5  = gl.getUniformLocation(s,"tex5" );
            o.shdTex9g6  = gl.getUniformLocation(s,"tex6" );
            o.shdTex9g7  = gl.getUniformLocation(s,"tex7" );
            o.shdTex9g8  = gl.getUniformLocation(s,"tex8" );
            o.shdTex9g9  = gl.getUniformLocation(s,"tex9" );
            o.shdTex9g10 = gl.getUniformLocation(s,"tex10");
            o.shdTex9g11 = gl.getUniformLocation(s,"tex11");
            return o;
        }
        iniRndrStps9g = function(s)
        {
            var f = new Function(   s +
                                    `
                                    var shsh9 = new Array(shadas.length);
                                    for(var i = 0; i < shadas.length; ++i)
                                    {
                                           shsh9[i] = iniShdr9g(shadas[i]);
                                        if(shsh9[i] == null){return;}
                                    }
                                    
                                    gl.useProgram(null);
                                    for(var i = 0; shs9g != null && i < shs9g.length; ++i)
                                    {
                                        gl.deleteProgram(shs9g[i].shaderP9g);
                                    }
                                    shs9g    = shsh9;
                                    rndrStps = renderSteps;

                                    `
                                 );
            f();
        }
        iniRndrStps9g(frSh9fun[0]);
 
        shaderP9k  = shaderCreator(vxSh9a, frSh9k);
        shdVtx9k   = gl.getAttribLocation( shaderP9k, "vtx"  );
        shdTex9k4  = gl.getUniformLocation(shaderP9k, "tex4" );
        shdTex9k5  = gl.getUniformLocation(shaderP9k, "tex5" );
        shdTex9k6  = gl.getUniformLocation(shaderP9k, "tex6" );
        shdTex9k7  = gl.getUniformLocation(shaderP9k, "tex7" );
        shdTex9k8  = gl.getUniformLocation(shaderP9k, "tex8" );
        shdTex9k9  = gl.getUniformLocation(shaderP9k, "tex9" );
        shdTex9k10 = gl.getUniformLocation(shaderP9k, "tex10");
        shdTex9k11 = gl.getUniformLocation(shaderP9k, "tex11");


        //meshes all in one buff
        let meshData = new Float32Array(512*512*3);
        let w = 0;
        for(let i = 0; i < 512*512; ++i)
        {
            meshData[w] = i+.25;    ++w;
            meshData[w] = i+.50;    ++w;
            meshData[w] = i+.75;    ++w;
        }
        meshBuff = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, meshBuff);
        gl.bufferData(gl.ARRAY_BUFFER, meshData, gl.STATIC_DRAW);

        //textures
        textMode = -1;//which example is user on to activate certain textures into GPU
        texCreator = function(format, x, y, type, txf, data, txId)
        {
            gl.activeTexture(txId);   
            let tx = gl.createTexture();
            gl.bindTexture(gl.TEXTURE_2D, tx);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, txf);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, txf);
            gl.texImage2D(gl.TEXTURE_2D, 0, format, x, y, 0, format, type, data);
            return tx;
        }
        var mdini = Math.max(Math.max(orbNPW,orbNPW2),orbNPW3);
            mdini = Math.max(Math.max(mdini,1<<x1D),1<<y1D);
        var tmitn = new Float32Array(mdini*mdini*4);
        tex0 = texCreator(gl.RGBA, orbNPW , orbNPW , gl.FLOAT, gl.NEAREST, tmitn, gl.TEXTURE0);
        tex1 = texCreator(gl.RGBA, orbNPW2, orbNPW2, gl.FLOAT, gl.NEAREST, tmitn, gl.TEXTURE1);
        tex2 = texCreator(gl.RGBA, orbNPW3, orbNPW3, gl.FLOAT, gl.NEAREST, tmitn, gl.TEXTURE2);

        //frameBuffers
        frameBuffCreator = function(texture)
        {
            var fb = gl.createFramebuffer();
            gl.bindFramebuffer(gl.FRAMEBUFFER, fb);
            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);
            return fb;
        }
        gl.bindFramebuffer(gl.FRAMEBUFFER, null);

        //global matrix used by shaders
        shdMtx = new Float32Array(16);
        shdMtxB= new Float32Array(16);
    }
    
    var orbN = 0;
    var orbNPW = 64;
    var orbNMAX = orbNPW*orbNPW;
    var camOrb1 = new Float32Array([0,0,130,1]);//XY position, Z zoom, W/H screen ratio
    var orbD1 = new Float32Array(orbNMAX*4);//2D positions list
    var orbD1b = new Float32Array(256*2);//saves ampli|phase
    var buL = new Array(32);
    var buL2 = new Array(32);
    var buL3 = new Array(2);
    var wavfun1 = null;
    var wavfun2 = null;
    var datA = null;
    var cnvs1 = null;
    var cntx1 = null;
    function interface1()
    {
        let buI = null;
        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = "70px";
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "1D FOURIER TRANSFORM";
        document.body.appendChild(buI);

        let dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "1200px";
        dv1.style.height = "900px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs1 = document.createElement("canvas");
        cnvs1.style.position = "absolute";
        //cnvs1.style.display = "block";
        cnvs1.style.border = "0px";
        cnvs1.style.margin = "0px";
        //cnvs1.style.marginLeft = "auto";
        //cnvs1.style.marginRight = "auto";
        cnvs1.style.width = "1200px";
        cnvs1.style.height = "900px";
        dv1.appendChild(cnvs1);
        cntx1 = cnvs1.getContext("2d");

        let smpl = 256;
        let dat = [
            0,smpl>>1,8,.01,     5,5, 21,   "frequency1",
            0,      1,0,.01,    28,5, 21,   "phase",
            0,     10,5,.01,    51,5, 21,   "gaussian position",
            0,     10,0,.01,    74,5, 21,   "gaussian width",

            0,smpl>>1,2,.01,     5,17, 21,   "frequency2",
            0,      1,0,.01,    28,17, 21,   "phase",
            0,     10,5,.01,    51,17, 21,   "gaussian position",
            0,     10,0,.01,    74,17, 21,   "gaussian width",

            0,      0,0,.01,    5,29, 90,    "frequency1 + frequency2",

            0,smpl   ,smpl>>3,1,   5, 1, 90,   "time domain samples",
            0,smpl<<1,smpl>>0,1,   5,68, 90,   "frequency domain samples",

            0,smpl>>1,1,.01,    5,45, 90,    "cycles",
            0,      1,0,.001,   65,57, 30,   "wrap wave around point",

            0,      1,0,1,      32,83, 36,   "real|imaginary    OR    amplitude|phase",
            0,      1,0,1,      89,63, 6,    "pro",
            0,      1,0,1,      32,13, 36,   "real|imaginary    OR    amplitude|phase",


            0,1,0,1/256,     5,5, 21,   "a",
            0,1,0,1/256,    28,5, 21,   "b",
            0,1,0,1/256,    51,5, 21,   "c",
            0,1,0,1/256,    74,5, 21,   "d",

            0,1,0,1/256,     5,9, 21,   "e",
            0,1,0,1/256,    28,9, 21,   "f",
            0,1,0,1/256,    51,9, 21,   "g",
            0,1,0,1/256,    74,9, 21,   "h",
        ];
        datA = dat;

        let a = dat.length / 8;
        for(let i = 0; i < a; ++i)
        {
            let io = i*8;
            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.fontSize = "18px";
            buI.style.position = "absolute";
            buI.style.left  = dat[io+4]+"%";//Math.floor(innerWidth *dat[io+4])+"px";
            buI.style.top   = dat[io+5]-2.7+"%";//Math.floor(innerHeight*dat[io+5])+10+"px";
            buI.style.width = dat[io+6]+"%";//Math.floor(innerWidth *dat[io+6])+"px";
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.style.color = "white";
            buI.innerHTML = dat[io+7];
            dv1.appendChild(buI);
            buL2[i] = buI;

            if(dat[io+0] == dat[io+1]) continue;

            buI = document.createElement("input");
            buI.style.position = "absolute";
            buI.style.left  = dat[io+4]+"%";//Math.floor(innerWidth *dat[io+4])+"px";
            buI.style.top   = dat[io+5]+1+"%";//Math.floor(innerHeight*dat[io+5])+10+"px";
            buI.style.width = dat[io+6]+"%";//Math.floor(innerWidth *dat[io+6])+"px";
            buI.type = "range";
            buI.min =   dat[io+0];
            buI.max =   dat[io+1];
            buI.value = dat[io+2];
            buI.step =  dat[io+3];
            buI.oninput = render1Html;
            dv1.appendChild(buI);
            buL[i] = buI;
        }

        buL[14].oninput = changPRO;

        buI = document.createElement("input");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = "18px";
        buI.style.position = "absolute";
        buI.style.left  = "10%";
        buI.style.top   = "17%";
        buI.style.width = "80%";
        buI.style.background = "#222222";
        buI.style.color = "#FFFFFF";
        buI.type = "text";
        buI.oninput = runEqu;
        buI.value = "return Math.sign(Math.sin(x*(1-a)*8*PI*2 + b*PI*2));";
        dv1.appendChild(buI);
        buL3[0] = buI;

        buI = document.createElement("input");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = "18px";
        buI.style.position = "absolute";
        buI.style.left  = "10%";
        buI.style.top   = "31%";
        buI.style.width = "80%";
        buI.style.background = "#222222";
        buI.style.color = "#FFFFFF";
        buI.type = "text";
        buI.oninput = runEqu;
        buI.value = "return Math.asin(Math.sin(x*(1-e)*4*PI*2 + f*PI*2))*.6;";
        dv1.appendChild(buI);
        buL3[1] = buI;

        wavfun1 = new Function('x', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', buL3[0].value);
        wavfun2 = new Function('x', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', buL3[1].value);

        changPRO();
        render1Html();
    }
    function render1Gl()
    {
        //inputWorld();

        let pxrt = 1;//window.devicePixelRatio*2;
        let rect = cnvs1.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width  = xrz;
        cnvs0.height = yrz;
        cnvs1.width  = xrz;
        cnvs1.height = yrz;
        
        //update input data
        //shdMtx[0] = xrz;
        //shdMtx[1] = yrz;
        //shdMtx[2] = inputX;
        //shdMtx[3] = yrz-inputY;
        //update camera data
        camOrb1[3] = xrz/yrz;
        shdMtx[4] =   camOrb1[0];
        shdMtx[5] =   camOrb1[1];
        shdMtx[6] = 1/camOrb1[2];
        shdMtx[7] = 1/camOrb1[3];
        shdMtx[8] = orbNPW;

        shdMtx[9] = buL[11].value*1;
        shdMtx[10] = buL[12].value*1;
        shdMtx[11] = buL[14].value*1;

        shdMtx[0] = buL[0].value*PI*2;    shdMtx[12] = buL[4].value*PI*2;
        shdMtx[1] = buL[1].value*PI*2;    shdMtx[13] = buL[5].value*PI*2;
        shdMtx[2] = buL[2].value*.1;      shdMtx[14] = buL[6].value*.1;
        shdMtx[3] = buL[3].value*1;       shdMtx[15] = buL[7].value*1;

        shdMtx[3]*=shdMtx[3];       shdMtx[3]*=shdMtx[3];
        shdMtx[15]*=shdMtx[15];     shdMtx[15]*=shdMtx[15];

        gl.viewport(0, 0, xrz, yrz);

        //gl.clearColor(.1,.1,.1,1);
        //gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        if(textMode != 0)
        {  textMode  = 0;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex0);
        }
        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, orbNPW, orbNPW, gl.RGBA, gl.FLOAT, orbD1);

        //draw background
        gl.useProgram(shaderP0b);
        gl.uniformMatrix4fv(shdMtx0b, false, shdMtx);
        gl.vertexAttribPointer(shdVtx0b, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx0b);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        //draw bycicle
        gl.useProgram(shaderP0c);
        gl.uniformMatrix4fv(shdMtx0c, false, shdMtx);
        gl.vertexAttribPointer(shdVtx0c, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx0c);
        if(shdMtx[10]!=0.) gl.drawArrays(gl.TRIANGLES, 0, 3);

        gl.enable(gl.BLEND);

        //draw orbs
        gl.useProgram(shaderP0);
        gl.uniform1i(shdTex0, 0);
        gl.uniformMatrix4fv(shdMtx0, false, shdMtx);
        gl.vertexAttribPointer(shdVtx0, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx0);
        gl.drawArrays(gl.TRIANGLES, 0, orbN*3);

        gl.disable(gl.BLEND);

        cntx1.drawImage(cnvs0, 0, 0);
    }
    function render1Html()
    {
        let w = 0;
        let dv = buL[9].value*1;
        let dv1 = 1/dv;
        let dv2 = dv;//>>1;

        let xmx = 308;
        let ymx = 8;
        let xg0 = -xmx*.5;      let yg0 =   98;
        let xg1 = -xmx*.5;      let yg1 =   67;
        let xg2 = -xmx*.5;      let yg2 =   32;
        let xg3 =       0;      let yg3 =  -20;
        let xg4 = -xmx*.5;      let yg4 =  -72;
        let xg5 = -xmx*.5;      let yg5 = -112;

        buL[0].max = dv2;
        buL[4].max = dv2;
        buL[11].max = dv2;

        let fq0 = buL[0].value*PI*2;    let fq1 = buL[4].value*PI*2;
        let ph0 = buL[1].value*PI*2;    let ph1 = buL[5].value*PI*2;
        let ps0 = buL[2].value*.1;      let ps1 = buL[6].value*.1;
        let wd0 = buL[3].value*1;       let wd1 = buL[7].value*1;
        
        wd0*=wd0;   wd0*=wd0;
        wd1*=wd1;   wd1*=wd1;

        let pro = (buL[14].value|0) == 0;//enable custom equation
        let roi = (buL[15].value|0) == 0;//read as real|imaginary OR ampli|phase

        if(pro)
        {
            for(let i = 0; i < dv; ++i)//frequency1
            {
                let s = i*dv1;
                orbD1[w] = s*xmx    + xg0;                  ++w;
                orbD1[w] =  + Math.sin(s*fq0+ph0) * ymx* Math.exp(Math.pow(s-ps0,2)*-wd0)
                                    + yg0;                  ++w;
                orbD1[w] = 0;                               ++w; ++w;
            }
            for(let i = 0; i < dv; ++i)//frequency2
            {
                let s = i*dv1;
                orbD1[w] = s*xmx    + xg1;                  ++w;
                orbD1[w] =  + Math.sin(s*fq1+ph1) * ymx* Math.exp(Math.pow(s-ps1,2)*-wd1)
                                    + yg1;                  ++w;
                orbD1[w] = 0;                               ++w; ++w;
            }
            for(let i = 0; i < dv; ++i)//frequency1+frequency2 realPart
            {
                let y = +   orbD1[dv*4*0+i*4+1] - yg0
                        +   orbD1[dv*4*1+i*4+1] - yg1;
                orbD1b[i*2+0] = y;
                let s = i*dv1;
                orbD1[w] = s*xmx    + xg2;                  ++w;
                orbD1[w] = y        + yg2;                  ++w;
                orbD1[w] = 0;                               ++w; ++w;
            }
            for(let i = 0; i < dv; ++i)//                      imaginPart
            {
                orbD1b[i*2+1] = 0;
            }
            for(let i = 0; i < dv; ++i)//convert to ampli|phase
            {
                let y1 = orbD1b[i*2+0];
                let y2 = orbD1b[i*2+1];
                orbD1b[i*2+0] = Math.sqrt(y2*y2 + y1*y1);
                orbD1b[i*2+1] = Math.atan2(y2,y1);
            }
        }
        else
        {
            let nu = 16;
            let aW = buL[nu].value*1; ++nu;     let bW = buL[nu].value*1; ++nu;
            let cW = buL[nu].value*1; ++nu;     let dW = buL[nu].value*1; ++nu;
            let eW = buL[nu].value*1; ++nu;     let fW = buL[nu].value*1; ++nu;
            let gW = buL[nu].value*1; ++nu;     let hW = buL[nu].value*1; ++nu;

            let yg0B = 63;
            let yg1B = 27;
            for(let i = 0; i < dv; ++i)//custom equ1
            {
                let x = i*dv1;
                let y = wavfun1(x,aW,bW,cW,dW,eW,fW,gW,hW)*ymx;
                orbD1b[i*2+0] = y;
                orbD1[w] = x*xmx    + xg0;                  ++w;
                orbD1[w] = y        + yg0B;                 ++w;
                orbD1[w] = 0;                               ++w; ++w;
            }
            for(let i = 0; i < dv; ++i)//custom equ2
            {
                let x = i*dv1;
                let y = wavfun2(x,aW,bW,cW,dW,eW,fW,gW,hW)*ymx;
                orbD1b[i*2+1] = y;
                orbD1[w] = x*xmx    + xg1;                  ++w;
                orbD1[w] = y        + yg1B;                 ++w;
                orbD1[w] = 0;                               ++w; ++w;
            }
            if(roi)
            {
                for(let i = 0; i < dv; ++i)//convert to ampli|phase
                {
                    let y1 = orbD1b[i*2+0];
                    let y2 = orbD1b[i*2+1];
                    orbD1b[i*2+0] = Math.sqrt(y2*y2 + y1*y1);
                    orbD1b[i*2+1] = Math.atan2(y2,y1);
                }
            }
        }
        let whg = 1.5; //wave height
        let xsum = 0;
        let ysum = 0;
        let xng = buL[11].value*1;
        for(let i = 0; i < dv; ++i)//cycles
        {
            let y = orbD1b[i*2+0];
            let x = orbD1b[i*2+1] - i*dv1*xng*PI*2;
            let x0 = Math.cos(x)*y;
            let y0 = Math.sin(x)*y;
            xsum += x0;
            ysum += y0;
            orbD1[w] = x0*whg + xg3;    ++w;
            orbD1[w] = y0*whg + yg3;    ++w;
            orbD1[w] = 0;               ++w; ++w;
        }
        let mxa = buL[12].value*1;
        let mxb = 1-mxa;
        if(mxa > 0 && mxa < 1 && pro)
        {
            for(let i = 0; i < dv; ++i)//wrap wave around point
            {
                orbD1[w] = orbD1[dv*4*2+i*4+0]*mxb + orbD1[dv*4*3+i*4+0]*mxa;   ++w;
                orbD1[w] = orbD1[dv*4*2+i*4+1]*mxb + orbD1[dv*4*3+i*4+1]*mxa;   ++w;
                orbD1[w] = 0;                                                   ++w; ++w;
            }
        }
        let whv = dv1*whg*3;

        //cycles center mass X
        orbD1[w] = xsum*whv         + xg3;      ++w;
        orbD1[w] = 0                + yg3;      ++w;
        orbD1[w] = 1;                           ++w; ++w;
        //cycles center mass Y
        orbD1[w] = 0                + xg3;      ++w;
        orbD1[w] = ysum*whv         + yg3;      ++w;
        orbD1[w] = 2;                           ++w; ++w;
        //cycles center mass XY
        orbD1[w] = xsum*whv         + xg3;      ++w;
        orbD1[w] = ysum*whv         + yg3;      ++w;
        orbD1[w] = 3;                           ++w; ++w;
        //cycles absolute angle
        //orbD1[w] = Math.sin(xng*PI)*ymx*2   + xg3;  ++w;
        //orbD1[w] = Math.cos(xng*PI)*ymx*2   + yg3;  ++w;
        //orbD1[w] = 3;                           ++w; ++w;

        let mode = (buL[13].value|0) != 0;

        let jt = buL[10].value*1;
        let jt1 = 1/jt;
        let jt2 = dv1*jt1*dv2*PI*2;
        for(let j = 0; j < jt; ++j)//Discrete Fourirer Transform
        {
            let xsu = 0;
            let ysu = 0;
            let j2 = j*jt2;
            for(let i = 0; i < dv; ++i)
            {
                let y = orbD1b[i*2+0];
                let x = orbD1b[i*2+1] - i*j2;
                xsu += Math.cos(x)*y;
                ysu += Math.sin(x)*y;
            }
            xsu *= whv;
            ysu *= whv;
            let amp = Math.sqrt(xsu*xsu + ysu*ysu);
            let pha = Math.atan2(ysu,xsu)*2;//*2 just to enghance view

            if(mode){xsu = amp; ysu = pha;}

            let xer = j*xmx*jt1;
            orbD1[w] = xer      + xg4;      ++w;
            orbD1[w] = xsu      + yg4;      ++w;
            orbD1[w] = 0;                   ++w; ++w;

            orbD1[w] = xer      + xg5;      ++w;
            orbD1[w] = ysu      + yg5;      ++w;
            orbD1[w] = 0;                   ++w; ++w;
        }
        if(mode){
            //amplitude center mass position in DFT
            orbD1[w] = xng/dv2*xmx      + xg4;      ++w;
            orbD1[w] = Math.sqrt(Math.pow(xsum*whv,2) + 
                                 Math.pow(ysum*whv,2) )         + yg4;      ++w;
            orbD1[w] = 3;                           ++w; ++w;
        }
        else{
            //X center mass position in DFT
            orbD1[w] = xng/dv2*xmx      + xg4;      ++w;
            orbD1[w] = xsum*whv         + yg4;      ++w;
            orbD1[w] = 1;                           ++w; ++w;
            //Y center mass position in DFT
            orbD1[w] = xng/dv2*xmx      + xg5;      ++w;
            orbD1[w] = ysum*whv         + yg5;      ++w;
            orbD1[w] = 2;                           ++w; ++w;
        }

        orbN = w>>2;
        render1Gl();

        let nu = 0;
        nu = 0;    buL2[nu].innerHTML = datA[nu*8+7] + " = " + (buL[nu].value*1).toFixed(2);
        nu = 1;    buL2[nu].innerHTML = datA[nu*8+7] + " = 2*&#120587;*" + (buL[nu].value*1).toFixed(2);
        nu = 2;    buL2[nu].innerHTML = datA[nu*8+7] + " = " + (buL[nu].value*.1).toFixed(2);

        nu = 4;    buL2[nu].innerHTML = datA[nu*8+7] + " = " + (buL[nu].value*1).toFixed(2);
        nu = 5;    buL2[nu].innerHTML = datA[nu*8+7] + " = 2*&#120587;*" + (buL[nu].value*1).toFixed(2);
        nu = 6;    buL2[nu].innerHTML = datA[nu*8+7] + " = " + (buL[nu].value*.1).toFixed(2);

        nu = 9;    buL2[nu].innerHTML = datA[nu*8+7] + " = " + buL[nu].value;
        nu = 10;    buL2[nu].innerHTML = datA[nu*8+7] + " = " + buL[nu].value;
        nu = 11;    buL2[nu].innerHTML = datA[nu*8+7] + " = " + (buL[nu].value*1).toFixed(2);

        //pro variables
        nu = 16;
        buL2[nu].innerHTML = datA[nu*8+7] + " = " + buL[nu].value;    ++nu;
        buL2[nu].innerHTML = datA[nu*8+7] + " = " + buL[nu].value;    ++nu;
        buL2[nu].innerHTML = datA[nu*8+7] + " = " + buL[nu].value;    ++nu;
        buL2[nu].innerHTML = datA[nu*8+7] + " = " + buL[nu].value;    ++nu;
        buL2[nu].innerHTML = datA[nu*8+7] + " = " + buL[nu].value;    ++nu;
        buL2[nu].innerHTML = datA[nu*8+7] + " = " + buL[nu].value;    ++nu;
        buL2[nu].innerHTML = datA[nu*8+7] + " = " + buL[nu].value;    ++nu;
        buL2[nu].innerHTML = datA[nu*8+7] + " = " + buL[nu].value;    ++nu;
    }
    function changPRO()
    {
        let vh1 = "hidden";
        let vh2 = "visible";
        if((buL[14].value|0) == 0)
        {
            vh1 = "visible";
            vh2 = "hidden";
        }

        for(let i = 0; i < 9; ++i)
        {
            if(buL[i]!=null){
            buL[i].style.visibility = vh1;}
            buL2[i].style.visibility = vh1;
        }
        for(let i = 15; i < 24; ++i)
        {
            if(buL[i]!=null){
            buL[i].style.visibility = vh2;}
            buL2[i].style.visibility = vh2;
        }
        buL3[0].style.visibility = vh2;
        buL3[1].style.visibility = vh2;
        render1Html();
    }
    function runEqu()
    {
        let y1 = null;
        let y2 = null;
        try
        {
            y1 = new Function('x', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', buL3[0].value);
            y2 = new Function('x', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', buL3[1].value);
            let a = y1(0, 0,0,0,0, 0,0,0,0);
            let b = y2(0, 0,0,0,0, 0,0,0,0);
        }
        catch(error){return;}

        wavfun1 = y1;
        wavfun2 = y2;
        render1Html();
    }

    var orbN2 = 0;
    var orbNPW2 = 128;
    var orbNMAX2 = orbNPW2*orbNPW2;
    var camOrb2 = new Float32Array([0,0,50,1]);//XY position, Z zoom, W/H screen ratio
    var orbD2 = new Float32Array(orbNMAX2*4);//2D positions list
    var orbD2c = null;//copy of orbD2 used for operations
    var grab2 = -1; //=-1 grab nothing
                    //>=0 grab orb
    var grabMv2 = 0;//total position change,  from grab to ungrab
    var cnvs2 = null;   var cnvs2b = null;
    var cntx2 = null;   var cntx2b = null;
    var input2 = new Object();
    var boL = new Array(16);
    var ran2 = new Int8Array(32);
    var reu2 = new Float32Array(32*2);

    let lez2 = 2200;//font size calculator
    let lex2 = 30;//max font size
    

    var colTblPos = [   -2.0, .45, .5,
                        -.05, .45, .5,
                        -2.0,-.65, .5,
                        -.05,-.65, .5,
                         1.8,-.10, .7];
    var colTblLbl = [   1,-3, 24, "colored f(x) = cos(&#120587;*2*x)",
                        36,-3, 24, "colored f(x) = sin(&#120587;*2*x)"];
    function interface2()
    {
        let fnz = "24px";
        let buI = null;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = "70px";
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "THE MATH";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "900px";
        buI.type = "range";
        buI.min     = 2;
        buI.max     = 32;
        buI.value   = 5;
        buI.step    = 1;
        buI.oninput = gridDFT;
        document.body.appendChild(buI);
        boL[0] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "time domain samples = 5";
        document.body.appendChild(buI);
        boL[9] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        document.body.appendChild(buI);
        boL[1] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "transform time domain samples into frequency domain samples using";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "400px";
        buI.type = "range";
        buI.min     = -1;
        buI.max     = 5;
        buI.value   = -1;
        buI.step    = 1;
        buI.oninput = cnstru3;
        document.body.appendChild(buI);
        boL[12] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        document.body.appendChild(buI);
        boL[2] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "resulting frequency domain samples";
        document.body.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        document.body.appendChild(buI);
        boL[3] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px 0px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "next, a table of only what's in e<sup>i*&#120587;*2*...</sup> from the previous transform equations";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "900px";
        buI.type = "range";
        buI.min     = -1;
        buI.max     = (5*2+3+1)-2;//-2 because min is -1
        buI.value   = -1;
        buI.step    = 1;
        buI.oninput = cnstru1;
        document.body.appendChild(buI);
        boL[8] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        document.body.appendChild(buI);
        boL[4] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px 0px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "then pass every number from previous table through f(x) = e<sup>i*&#120587;*2*x</sup>\n"+
                        "but because e<sup>i*&#120587;*2*x</sup> = cos(&#120587;*2*x) + sin(&#120587;*2*x)*i\n"+
                        "pass every number from previous table through f(x) = cos(&#120587;*2*x)\n"+
                        "pass every number from previous table through f(x) = sin(&#120587;*2*x)";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "800px";
        buI.type = "range";
        buI.min     = -1;
        buI.max     = 22;
        buI.value   = -1;
        buI.step    = 1;
        buI.oninput = cnstru2;
        document.body.appendChild(buI);
        boL[11] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "table for f(x) = cos(&#120587;*2*x)";
        document.body.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        document.body.appendChild(buI);
        boL[5] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "table for f(x) = sin(&#120587;*2*x)";
        document.body.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        document.body.appendChild(buI);
        boL[6] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "lets visualize these tables in a different way\n"+
                        "\n"+
                        "f(x) = cos(&#120587;*2*x)        f(x) = sin(&#120587;*2*x)";
        document.body.appendChild(buI);

        let dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "600px";
        dv1.style.height = "500px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs2b = document.createElement("canvas");
        cnvs2b.style.position = "absolute";
        cnvs2b.style.border = "0px";
        cnvs2b.style.margin = "0px";
        cnvs2b.style.width = "600px";
        cnvs2b.style.height = "500px";
        dv1.appendChild(cnvs2b);
        cntx2b = cnvs2b.getContext("2d");

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px 0px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "time domain samples = 5";
        document.body.appendChild(buI);
        boL[10] = buI;

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "900px";
        buI.type = "range";
        buI.min     = 2;
        buI.max     = 32;
        buI.value   = 5;
        buI.step    = 1;
        buI.oninput = gridDFT;
        document.body.appendChild(buI);
        boL[7] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "lets tranform each number on those f(x) tables to a color                          \n"+
                        "the top    colored tables ignore the sign of each number                           \n"+
                        "the bottom colored tables only care if each number is positive, negative, zero     \n"+
                        "you can grab and move each column or row, try to pack together the repeated numbers";
        document.body.appendChild(buI);

        //color tables
        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "1200px";
        dv1.style.height = "512px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs2 = document.createElement("canvas");
        cnvs2.style.position = "absolute";
        cnvs2.style.border = "0px";
        cnvs2.style.margin = "0px";
        cnvs2.style.width = "1200px";
        cnvs2.style.height = "512px";
        dv1.appendChild(cnvs2);
        cntx2 = cnvs2.getContext("2d");

        for(let i = 0; i < colTblLbl.length/4; ++i)
        {
            let io = i*4;
            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = colTblLbl[io+0]+"%";
            buI.style.top       = colTblLbl[io+1]+"%";
            buI.style.fontSize  = colTblLbl[io+2]+"px";
            buI.style.display = "block";
            buI.style.textAlign = "center";
            //buI.style.color = "white";
            buI.innerHTML = colTblLbl[io+3];
            dv1.appendChild(buI);
        }

        input2.inputO = 0;  //1=tapIn  2=fastTapOut 3=tapOut
        input2.inputT = 0;
        input2.inputX  = 0;  input2.inputY  = 0;    input2.inputZ = 0;
        input2.inputXd = 0;  input2.inputYd = 0;
        input2.touchID = -1;
        input2.inputDo = function(x, y, type)
        {
            if(type == 0)
            {
                //if(performance.now()-input2.inputT < 200)
                //{
                //    input2.inputO = 2;
                //}
                //else{input2.inputO = 3;}
                input2.inputO = 3;
            }
            if(type == 1)
            {
                input2.inputT = performance.now();
                input2.inputO = 1;
                input2.inputXd = 0;
                input2.inputYd = 0;
            }
            if(type == 2)
            {
                input2.inputXd += x-input2.inputX;
                input2.inputYd += y-input2.inputY;
            }
            input2.inputX = x;
            input2.inputY = y;
            colTblUp2();
        }
        input2.touchStart = function(e)
        {
            if(input2.touchID != -1){return;}
            let rect = e.target.getBoundingClientRect();
            input2.touchID = e.changedTouches[0].identifier;
            input2.inputDo( e.changedTouches[0].clientX - rect.left, 
                            e.changedTouches[0].clientY - rect.top,
                            1);
        };
        input2.touchEnd = function(e)
        {
            let list = e.changedTouches;
            for (let i = 0; i < list.length; ++i)
            {
                if(input2.touchID == list[i].identifier)
                {
                    let rect = e.target.getBoundingClientRect();
                    input2.touchID = -1;
                    input2.inputDo( list[i].clientX - rect.left, 
                                    list[i].clientY - rect.top,
                                    0);
                    break;
                }
            }
        };
        input2.touchMove = function(e)
        {
            let list = e.changedTouches;
            for (let i = 0; i < list.length; ++i)
            {
                if(input2.touchID == list[i].identifier)
                {
                    let rect = e.target.getBoundingClientRect();
                    input2.inputDo( list[i].clientX - rect.left, 
                                    list[i].clientY - rect.top,
                                    2);
                }
            }
        };
        input2.mouseDown = function(e)
        {
            let rect = e.target.getBoundingClientRect();
            input2.inputDo( e.clientX - rect.left, 
                            e.clientY - rect.top,
                            1);
        };
        input2.mouseUp = function(e)
        {
            let rect = e.target.getBoundingClientRect();
            input2.inputDo( e.clientX - rect.left, 
                            e.clientY - rect.top,
                            0);
        };
        input2.mouseMove = function(e)
        {
            let rect = e.target.getBoundingClientRect();
            input2.inputDo( e.clientX - rect.left, 
                            e.clientY - rect.top,
                            2);
        };
        cnvs2.addEventListener("touchstart",  input2.touchStart,  true);
        cnvs2.addEventListener("touchend",    input2.touchEnd,    true);
        cnvs2.addEventListener("touchcancel", input2.touchEnd,    true);
        cnvs2.addEventListener("touchmove",   input2.touchMove,   true);
        cnvs2.addEventListener("mousedown",   input2.mouseDown,   true);
        cnvs2.addEventListener("mouseup",     input2.mouseUp,     true);
        cnvs2.addEventListener("mouseout",    input2.mouseUp,     true);
        cnvs2.addEventListener("mouseleave",  input2.mouseUp,     true);
        cnvs2.addEventListener("mousemove",   input2.mouseMove,   true);

        let rect = cnvs2.getBoundingClientRect();
        camOrb2[3] = rect.width/rect.height;

        orbD2c = new Float32Array(boL[0].max*boL[0].max);


        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "those images have a lot of mirrored parts, one way to pack the same numbers together\n"+
                        "is by moving the last columnORrow to the first similar columnORrow                  \n"+
                        "like closing a book with mirrored images and then interlacing the columnsORrows     \n"+
                        "another way is by deinterlacing columnsORrows as shown next";
        document.body.appendChild(buI);

        gridDFT(null);
    }
    function render2Gl()
    {
        let pxrt = 1;//window.devicePixelRatio*2;
        let rect = cnvs2.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs2.width = xrz;
        cnvs2.height = yrz;
        
        //update input data
        shdMtx[0] = xrz;
        shdMtx[1] = yrz;
        //shdMtx[2] = inputX2;
        //shdMtx[3] = yrz-inputY2;
        //update camera data
        shdMtx[4] =   camOrb2[0];
        shdMtx[5] =   camOrb2[1];
        shdMtx[6] = 1/camOrb2[2];
        shdMtx[7] = 1/camOrb2[3];
        shdMtx[8] = orbNPW2;
        shdMtx[9] = boL[0].value*1;

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        if(textMode != 1)
        {  textMode  = 1;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex1);
        }
        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, orbNPW2, orbNPW2, gl.RGBA, gl.FLOAT, orbD2);

        gl.enable(gl.BLEND);

        //draw orbs
        gl.useProgram(shaderP1);
        gl.uniform1i(shdTex1, 0);
        gl.uniformMatrix4fv(shdMtx1, false, shdMtx);
        gl.vertexAttribPointer(shdVtx1, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx1);
        gl.drawArrays(gl.TRIANGLES, 0, orbN2*3);

        gl.disable(gl.BLEND);

        cntx2.drawImage(cnvs0, 0, 0);
    }
    function render2bGl()
    {
        let pxrt = 1;//window.devicePixelRatio;
        let rect = cnvs2b.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs2b.width = xrz;
        cnvs2b.height = yrz;
        
        //update input data
        shdMtx[0] = boL[0].value*1;

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        gl.useProgram(shaderP2b);
        gl.uniformMatrix4fv(shdMtx2b, false, shdMtx);
        gl.vertexAttribPointer(shdVtx2b, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx2b);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        cntx2b.drawImage(cnvs0, 0, 0);
    }
    function gridDFT(elemt)
    {
        let l = 0;
        if(elemt != null)
        {
            l = elemt.target.value*1;
            boL[0].value = l;
            boL[7].value = l;
            boL[ 9].innerHTML = "time domain samples = "+l;
            boL[10].innerHTML = "time domain samples = "+l;
            boL[12].value = -1;
            boL[12].max = l;
        }
        else
        {
            l = boL[0].value*1;
        }

        let a = "";
        a = "[";
        for(let i = 0; i < l; ++i)//time domain samples
        {
            let b = Math.floor(Math.random()*19-9);
            ran2[i] = b;
            if(b >= 0) a += " ";
            a += b;
            if(i+1 < l) a += ",";
        }
        a += "]";
        boL[1].style.fontSize = Math.min(lex2,Math.floor(lez2/a.length))+"px";
        boL[1].innerHTML = a;

        a = "";
        let lng = 0;
        for(let i = 0; i < l; ++i)//tranform time to frequency
        {
            let c = "";

            let imag = 0;
            let real = 0;
            for(let j = 0; j < l; ++j)
            {
                if(ran2[j] >= 0) c += " ";
                c += ran2[j];
                
                c += "*e<sup>i*&#120587;*2*";

                c += j+"*";
                if(l > 10 && i<10) c += " ";
                c += i;
                c += "/"+l;

                c += "</sup>";
                
                if(j+1 < l) c += " + ";

                let d = PI*2*i*j/l;
                real += Math.cos(d)*ran2[j];
                imag += Math.sin(d)*ran2[j];
            }
            if(real             >= 0) a += " ";
            if(Math.abs(real)   < 10) a += " ";
            a += real.toFixed(2);
            if(Math.abs(imag)   < 10) a += " ";
            if(imag             >= 0) a += "+";
            a += imag.toFixed(2)+"*i"+" = "+c;
            a += "\n";

            reu2[i*2+0] = real;
            reu2[i*2+1] = imag;

            if(i == 0) lng = a.length;
        }
        boL[2].style.fontSize = Math.min(lex2,Math.floor(lez2*2.1/lng))+"px";
        boL[2].innerHTML = a;

        a = "[";
        for(let i = 0; i < l; ++i)//frequency domain samples
        {
            if(reu2[i*2+0] >= 0) a += " ";
            a += reu2[i*2+0].toFixed(2);
            if(reu2[i*2+1] >= 0) a += "+";
            a += reu2[i*2+1].toFixed(2) + "*i";
            if(i+1 < l) a += ",";
        }
        a += "]";
        boL[3].style.fontSize = Math.min(lex2,Math.floor(lez2/a.length))+"px";
        boL[3].innerHTML = a;

        a = "";
        for(let i = 0; i < l; ++i)//inside e^x table
        {
            for(let j = 0; j < l; ++j)
            {
                if(j != 0)          a += "   ";
                                    a += j+"*";
                if(l>10 && i<10)    a += " ";
                                    a += i;
                                    a += "/"+l;
            }
            a += "\n";
            if(i == 0) lng = a.length;
        }
        boL[4].style.fontSize = Math.min(lex2,Math.floor(lez2/lng))+"px";
        boL[4].innerHTML = a;

        boL[8].max = l*2+2;//create table animation steps
        boL[8].value = -1;
        boL[11].value = -1;

        a = "";
        for(let i = 0; i < l; ++i)//cos() table
        {
            for(let j = 0; j < l; ++j)
            {
                let e = j*i/l;
                e = Math.cos(PI*2*e);
                if(j != 0) a += "  ";
                if(j != 0 && e >= 0) a += " ";
                a += e.toFixed(3);
            }
            a += "\n";
            if(i == 0) lng = a.length;
        }
        boL[5].style.fontSize = Math.min(lex2,Math.floor(lez2/lng))+"px";
        boL[5].innerHTML = a;

        a = "";
        for(let i = 0; i < l; ++i)//sin() table
        {
            for(let j = 0; j < l; ++j)
            {
                let e = j*i/l;
                e = Math.sin(PI*2*e);
                if(j != 0) a += "  ";
                if(j != 0 && e >= 0) a += " ";
                a += e.toFixed(3);
            }
            a += "\n";
            if(i == 0) lng = a.length;
        }
        boL[6].style.fontSize = Math.min(lex2,Math.floor(lez2/lng))+"px";
        boL[6].innerHTML = a;

        let w = 0;
        let sqr = 0;
        let mcx = 0;
        let mcy = 0;
        let dvl = 1/l;
        for(let i = 0; i < 5; ++i)//colored tables
        {
            sqr = colTblPos[i*3+2]*2*l;
            mcx = colTblPos[i*3+0]*l - colTblPos[i*3+2]*(l-1);
            mcy = colTblPos[i*3+1]*l + colTblPos[i*3+2]*(l-1);
            for(let j = 0; j < l; ++j)
            {
                for(let k = 0; k < l; ++k)
                {
                    orbD2[w] = k*dvl*sqr + mcx;     ++w;
                    orbD2[w] =-j*dvl*sqr + mcy;     ++w;
                    orbD2[w] = 0;                   ++w;
                    orbD2[w] = (w-3)>>2;            ++w;
                }
            }
        }
        sqr = colTblPos[4*3+2]*2*l;
        mcx = colTblPos[4*3+0]*l - colTblPos[4*3+2]*(l-1);
        mcy = colTblPos[4*3+1]*l + colTblPos[4*3+2]*(l-1);
        for(let i = 0; i < l; ++i)//row ball graber
        {
            orbD2[w] = i*dvl*sqr + mcx;     ++w;
            orbD2[w] = 1*dvl*sqr + mcy;     ++w;
            orbD2[w] = 0;                   ++w;
            orbD2[w] = (w-3)>>2;            ++w;
        }
        for(let i = 0; i < l; ++i)//column ball graber
        {
            orbD2[w] =-1*dvl*sqr + mcx;     ++w;
            orbD2[w] =-i*dvl*sqr + mcy;     ++w;
            orbD2[w] = 0;                   ++w;
            orbD2[w] = (w-3)>>2;            ++w;
        }
        orbN2 = w>>2;

        camOrb2[2] = l*1.2;

        render2Gl();
        render2bGl();
    }
    function colTblUp2()
    {
        let l = boL[0].value*1;

        if(input2.inputO == 1)//which ball grab
        {
            let x = input2.inputX;
            let y = input2.inputY;
            let rect = cnvs2.getBoundingClientRect();
            x = 2*x/rect.width -1;   x *= camOrb2[2]*camOrb2[3];     x += camOrb2[0];
            y =-2*y/rect.height+1;   y *= camOrb2[2];                y += camOrb2[1];

            //find orb
            let a = -1;
            let min = 1;
            for(let i = l*l*5; i < l*l*5+l*2; ++i)
            {
                let l1 = orbD2[i*4+0] - x;
                let l2 = orbD2[i*4+1] - y;
                let l0 = l1*l1 + l2*l2;
                if(l0 < min){a = i; min = l0;}
            }
            
            input2.inputO = 0;
            grab2 = a;

            //mark grabed row-column
            let id = grab2-l*l*5;
            orbD2[grab2*4+2] =  1;

            let jmp = l*4;  if(id >= l){jmp = 4;}
            let mod = id*4; if(id >= l){mod = (id-l)*l*4;}

            for(let i = 0; i < 5; ++i)
            {
                let w = i*l*l*4+mod;
                for(let j = 0; j < l; ++j)
                {
                    orbD2[w+2] =  1;
                    w += jmp;
                }
            }
        }
        if(input2.inputO == 3)//drop ball grab
        {
            if(grab2 >= 0)
            {
                let rm = Math.round(grabMv2/(.7*2));
                let id = grab2 - l*l*5;
                let il = id - (id >= l)*l;

                //return moved row-column
                let dx = -grabMv2*(id <  l);
                let dy = -grabMv2*(id >= l);
                orbD2[grab2*4+0] += dx;
                orbD2[grab2*4+1] += dy;
                orbD2[grab2*4+2]  = 0;

                let jmp = l*4;  if(id >= l){jmp = 4;}
                let mod = id*4; if(id >= l){mod = (id-l)*l*4;}
                for(let i = 0; i < 5; ++i)
                {
                    let w = i*l*l*4+mod;
                    let ani = .5/.7;    if(i==4){ani = 1;}
                    for(let j = 0; j < l; ++j)
                    {
                        orbD2[w+0] += dx*ani;
                        orbD2[w+1] += dy*ani;
                        orbD2[w+2]  = 0;
                        w += jmp;
                    }
                }

                //move colors
                let l0 = rm;        if(id >= l){l0 = -l0;}
                                    if(il+l0 >= l){l0 = (l-1)-il;}
                               else if(il+l0 <  0){l0 =     0-il;}
                let l1 = il;        if(l0<0){l1 = il+l0;}
                let l2 = il+l0;     if(l0<0){l2 = il;}      ++l2;
                let lx1 = 0;        if(id <  l){lx1 = l1;}
                let lx2 = l;        if(id <  l){lx2 = l2;}
                let ly1 = 0;        if(id >= l){ly1 = l1;}
                let ly2 = l;        if(id >= l){ly2 = l2;}
                
                jmp = Math.sign(l0);    if(id >= l){jmp  *= l;}
                let jmp2 =-l0;          if(id >= l){jmp2 *= l;}
                let grb1 = -1;          if(id <  l){grb1 = il+l0;}
                let grb2 = -1;          if(id >= l){grb2 = il+l0;}
                for(let i = 0; i < 5; ++i)
                {
                    //copy moving colors
                    for(let j = ly1; j < ly2; ++j)
                    {
                        for(let k = lx1; k < lx2; ++k)
                        {
                            let w1 = j*l+k;
                            let w2 = i*l*l+w1;
                            orbD2c[w1] = orbD2[w2*4+3];
                        }
                    }
                    //move colors
                    for(let j = ly1; j < ly2; ++j)
                    {
                        for(let k = lx1; k < lx2; ++k)
                        {
                            let w1 = j*l+k;
                            let w2 = i*l*l+w1;
                            let jmp3 = jmp;
                            if(k == grb1){jmp3 = jmp2;}
                            if(j == grb2){jmp3 = jmp2;}
                            orbD2[w2*4+3] = orbD2c[w1+jmp3];
                        }
                    }
                }
                grab2 = -1;
                grabMv2 = 0;
            }
            input2.inputO = 0;
        }
        if(input2.inputXd != 0 || input2.inputYd != 0)//ball move
        {
            if(grab2 >= 0)
            {
                let id = grab2-l*l*5;
                let xmv = 0;   if(id <  l){xmv = 1;}
                let ymv = 0;   if(id >= l){ymv = 1;}
                let dx = input2.inputXd;
                let dy = input2.inputYd;
                let rect = cnvs2.getBoundingClientRect();
                dx = 2*dx/rect.width;    dx *= camOrb2[2]*camOrb2[3];
                dy =-2*dy/rect.height;   dy *= camOrb2[2];
                dx *= xmv;
                dy *= ymv;
                grabMv2 += dx+dy;
                orbD2[grab2*4+0]+= dx;
                orbD2[grab2*4+1]+= dy;
                //orbD2[grab2*4+2] =  1;

                let jmp = l*4;  if(id >= l){jmp = 4;}
                let mod = id*4; if(id >= l){mod = (id-l)*l*4;}

                for(let i = 0; i < 5; ++i)//colored tables
                {
                    let w = i*l*l*4+mod;
                    let ani = .5/.7;    if(i==4){ani = 1;}
                    for(let j = 0; j < l; ++j)
                    {
                        orbD2[w+0]+= dx*ani;
                        orbD2[w+1]+= dy*ani;
                        //orbD2[w+2] =  1;
                        w += jmp;
                    }
                }
            }
            input2.inputXd = 0;
            input2.inputYd = 0;
        }

        render2Gl();
    }
    function cnstru1()
    {
        let l = boL[0].value*1;
        let stp = boL[8].value*1;

        let a = "";
        let lng = 0;
        for(let i = 0; i < l; ++i)//inside e^x table
        {
            for(let j = 0; j < l; ++j)
            {
                if(j != 0)          a += "   ";
                if(j <= stp)        a += j;                             else{ if(j< 10) a += " "; else a += "  "; }
                if(stp >= l*2+0)    a += "*";                           else a += " ";
                if(i <= stp-l){ if(l>10 && i<10) a += " "; a += i; }    else{ if(l<=10) a += " "; else a += "  "; }
                if(stp >= l*2+1)    a += "/";                           else a += " ";
                if(stp >= l*2+2)    a += l;                             else{ if(l< 10) a += " "; else a += "  "; }
            }
            a += "\n";
            if(i == 0) lng = a.length;
        }
        boL[4].style.fontSize = Math.min(lex2,Math.floor(lez2/lng))+"px";
        boL[4].innerHTML = a;
    }
    function cnstru2()
    {
        let l = boL[0].value*1;
        let stp = boL[11].value*1;

        let a = "";
        let lng = 0;

        for(let i = 0; i < l; ++i)//cos() table
        {
            for(let j = 0; j < l; ++j)
            {
                if(stp < 10){
                    if(j != 0)              a += "  ";
                    for(let k = 0; k < Math.min(9,stp); ++k){a += " ";} //a += "         ";
                                            a += j+"*";
                    if(l>10 && i<10)        a += " ";
                                            a += i;
                                            a += "/"+l+" ";}
                if(stp == 10){
                    if(j != 0)              a += "  ";
                                            a += "cos(PI*2*";
                                            a += j+"*";
                    if(l>10 && i<10)        a += " ";
                                            a += i;
                                            a += "/"+l+")";}
                if(stp > 10){
                    let e = Math.cos(PI*2*  j*i/l  );
                    for(let k = 0; k < 21-stp; ++k){a += " ";} //a += "         ";
                    if(j != 0)              a += "  ";
                    if(j != 0 && e >= 0)    a += " ";
                                            a += e.toFixed(3); }
            }
            a += "\n";
            if(i == 0) lng = a.length;
        }
        boL[5].style.fontSize = Math.min(lex2,Math.floor(lez2/lng))+"px";
        boL[5].innerHTML = a;

        a = "";
        for(let i = 0; i < l; ++i)//sin() table
        {
            for(let j = 0; j < l; ++j)
            {
                if(stp < 11){
                    if(j != 0)              a += "  ";
                    for(let k = 0; k < Math.min(10,stp); ++k){a += " ";} //a += "         ";
                                            a += j+"*";
                    if(l>10 && i<10)        a += " ";
                                            a += i;
                                            a += "/"+l+" ";}
                if(stp == 11){
                    if(j != 0)              a += "  ";
                                            a += " sin(PI*2*";
                                            a += j+"*";
                    if(l>10 && i<10)        a += " ";
                                            a += i;
                                            a += "/"+l+")";}
                if(stp > 11){
                    let e = Math.sin(PI*2*  j*i/l  );
                    for(let k = 0; k < 22-stp; ++k){a += " ";} //a += "         ";
                    if(j != 0)              a += "  ";
                    if(j != 0 && e >= 0)    a += " ";
                                            a += e.toFixed(3); }
            }
            a += "\n";
            //if(i == 0) lng = a.length;
        }
        boL[6].style.fontSize = Math.min(lex2,Math.floor(lez2/lng))+"px";
        boL[6].innerHTML = a;
    }
    function cnstru3()
    {
        let l = boL[0].value*1;
        let stp = boL[12].value*1;

        let a = "";
        a = "[";
        for(let i = 0; i < l; ++i)//time domain samples
        {
            if(i < Math.min(stp,l)){
                if(ran2[i] >= 0)    a += " ";
                                    a += ran2[i];
            }else{
                                    a += "  ";
            }
            if(i+1 < l)             a += ",";
        }
        a += "]";
        boL[1].style.fontSize = Math.min(lex2,Math.floor(lez2/a.length))+"px";
        boL[1].innerHTML = a;

        a = "";
        let lng = 0;
        for(let i = 0; i < l; ++i)//tranform time to frequency
        {
            let c = "";
            let real = reu2[i*2+0];
            let imag = reu2[i*2+1];
            for(let j = 0; j < l; ++j)
            {
                if(j < Math.min(stp,l)){
                    if(ran2[j] >= 0)    c += " ";
                                        c += ran2[j];
                }else{                  c += "  ";}
                                        c += "*e<sup>i*&#120587;*2*";
                                        c += j+"*";
                if(l > 10 && i<10)      c += " ";
                                        c += i;
                                        c += "/"+l;
                                        c += "</sup>";
                if(j+1 < l)             c += " + ";
            }
            if(real             >= 0) a += " ";
            if(Math.abs(real)   < 10) a += " ";
            a += real.toFixed(2);
            if(Math.abs(imag)   < 10) a += " ";
            if(imag             >= 0) a += "+";
            a += imag.toFixed(2)+"*i"+" = "+c;
            a += "\n";

            if(i == 0) lng = a.length;
        }
        boL[2].style.fontSize = Math.min(lex2,Math.floor(lez2*2.1/lng))+"px";
        boL[2].innerHTML = a;
    }

    var orbN3 = 0;
    var orbNPW3 = 512;// > sqrt(256*256*4)
    var orbNMAX3 = orbNPW3*orbNPW3;
    var orbD3 = new Float32Array(orbNMAX3*4);//2D positions list
    var orbD3c= new Float32Array(256*256);//2D positions list
    var camOrb3 = new Float32Array([0,0,40,1]);//XY position, Z zoom, W/H screen ratio
    var upTblc = -1;//apply calclation only when changing interlacing level
    var cnvs3 = null;   var cnvs3B = null;
    var cntx3 = null;   var cntx3B = null;
    var boL3 = new Array(4);
    var colTblPos3 = [  -1, .45, .5,
                         1, .45, .5,
                        -1,-.65, .5,
                         1,-.65, .5];
    var colTblLbl3 = [  18,-3, 24, "colored f(x) = cos(&#120587;*2*x)",
                        55,-3, 24, "colored f(x) = sin(&#120587;*2*x)"];
    function interface3()
    {
        let fnz = "24px";
        let buI = null;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "time domain samples = 2<sup>5</sup> = 32";
        document.body.appendChild(buI);
        boL3[0] = buI;

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "400px";
        buI.type = "range";
        buI.min     = 2;
        buI.max     = 8;
        buI.value   = 4;
        buI.step    = 1;
        buI.oninput = upPowTbl;
        document.body.appendChild(buI);
        boL3[1] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "control deinterlacing animation";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "1200px";
        buI.type = "range";
        buI.min     = 0;
        buI.max     = 1;
        buI.value   = 0;
        buI.step    = .0001;
        buI.oninput = colTblUp3;
        document.body.appendChild(buI);
        boL3[2] = buI;

        //color tables
        let dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "1200px";
        dv1.style.height = "512px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs3 = document.createElement("canvas");
        cnvs3.style.position = "absolute";
        cnvs3.style.border = "0px";
        cnvs3.style.margin = "0px";
        cnvs3.style.width = "1200px";
        cnvs3.style.height = "512px";
        dv1.appendChild(cnvs3);
        cntx3 = cnvs3.getContext("2d");

        for(let i = 0; i < colTblLbl3.length/4; ++i)
        {
            let io = i*4;
            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = colTblLbl3[io+0]+"%";
            buI.style.top       = colTblLbl3[io+1]+"%";
            buI.style.fontSize  = colTblLbl3[io+2]+"px";
            buI.style.display = "block";
            buI.style.textAlign = "center";
            //buI.style.color = "white";
            buI.innerHTML = colTblLbl3[io+3];
            dv1.appendChild(buI);
        }

        let rect = cnvs3.getBoundingClientRect();
        camOrb3[3] = rect.width/rect.height;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "now multiply these four previous colored tables with the time domain samples\n"+
                        "the top    row has all four previous tables after deinterlacing\n"+
                        "the bottom row has the time domain samples colored             \n"+
                        "you can control the multiplication as a transition";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "600px";
        buI.type = "range";
        buI.min     = 0;
        buI.max     = 1;
        buI.value   = 0;
        buI.step    = .0001;
        buI.oninput = render3bGl;
        document.body.appendChild(buI);
        boL3[3] = buI;

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "1030px";
        dv1.style.height = "512px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs3B = document.createElement("canvas");
        cnvs3B.style.position = "absolute";
        cnvs3B.style.border = "0px";
        cnvs3B.style.margin = "0px";
        cnvs3B.style.width = "1030px";
        cnvs3B.style.height = "512px";
        dv1.appendChild(cnvs3B);
        cntx3B = cnvs3B.getContext("2d");

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "the colored time domain samples have an       unknow number in each row   \n"+
                        "the colored time domain samples have the same unknow number in each column\n"+
                        "that example is using randomly generated numbers instead of unknow numbers";
        document.body.appendChild(buI);

        upPowTbl();
    }
    function upPowTbl()
    {
        let l = boL3[1].value*1;
        boL3[0].innerHTML = "time domain samples = 2<sup>"+ l +"</sup> = "+ Math.pow(2,l);
        l = Math.pow(2,l);

        boL3[2].value = 0;
        camOrb3[2] = l*1.16;
        upTblc -= 1000;

        colTblUp3();
        render3bGl();
        //render3Gl();
    }
    function render3Gl()
    {
        let pxrt = 1;//window.devicePixelRatio;
        let rect = cnvs3.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs3.width = xrz;
        cnvs3.height = yrz;
        
        //update input data
        shdMtx[0] = xrz;
        shdMtx[1] = yrz;
        //shdMtx[2] = inputX2;
        //shdMtx[3] = yrz-inputY2;
        //update camera data
        shdMtx[4] =   camOrb3[0];
        shdMtx[5] =   camOrb3[1];
        shdMtx[6] = 1/camOrb3[2];
        shdMtx[7] = 1/camOrb3[3];
        shdMtx[8] = orbNPW3;
        shdMtx[9] = Math.pow(2,boL3[1].value*1);

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        if(textMode != 2)
        {  textMode  = 2;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex2);
        }
        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, orbNPW3, orbNPW3, gl.RGBA, gl.FLOAT, orbD3);

        //draw orbs
        gl.useProgram(shaderP2);
        gl.uniform1i(shdTex2, 0);
        gl.uniformMatrix4fv(shdMtx2, false, shdMtx);
        gl.vertexAttribPointer(shdVtx2, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx2);
        gl.drawArrays(gl.TRIANGLES, 0, orbN3*3);

        cntx3.drawImage(cnvs0, 0, 0);
    }
    function render3bGl()
    {
        let pxrt = 1;//window.devicePixelRatio;
        let rect = cnvs3B.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs3B.width = xrz;
        cnvs3B.height = yrz;
        
        //update input data
        shdMtx[0] = xrz/yrz;
        shdMtx[1] = boL3[3].value*1;
        shdMtx[2] = boL3[1].value*1;

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        //draw orbs
        gl.useProgram(shaderP3);
        gl.uniformMatrix4fv(shdMtx3, false, shdMtx);
        gl.vertexAttribPointer(shdVtx3, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx3);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        cntx3B.drawImage(cnvs0, 0, 0);
    }
    function colTblUp3()
    {
        let valu = boL3[1].value*1;
        let l = Math.pow(2,valu);
        let aniT = valu-1;
        let ani = boL3[2].value*aniT*2;
        let aniF = Math.floor(ani); 
        let aniX = Math.min(ani     , aniT);
        let aniY = Math.max(ani-aniT,    0);

        let aibo = upTblc != aniF;
        if (aibo){upTblc = aniF;}

        orbN3 = l*l*4;

        //interlace X
        let aniD = Math.floor(aniX);
        let aniM = aniX - aniD;
        let a0 = Math.max(Math.max(aniM*1.5-.5,1-aniM*1.5),.4);
        let a1 = Math.min(Math.max((1-aniM)*3-1,0),1)*.5+.5;
        if(aibo)
        {
            for(let i = 0; i < orbN3; ++i){ orbD3[i*4+3] = i; }//color1
            for(let h = 0; h < aniD; ++h)//color2
            {
                let l0 = l/Math.pow(2,h+0);
                let l1 = l/Math.pow(2,h+1);
                for(let i = 0; i < 4; ++i)
                {
                    let i0 = i*l*l;
                    for(let j = 0; j < l*l; ++j)//make copy
                    {
                        orbD3c[j] = orbD3[(i0 + j)*4+3];
                    }
                    for(let j = 0; j < l; ++j)//move from copy
                    {
                        let j0 = j*l;
                        for(let k = 0; k < l; ++k)
                        {
                            let duv = Math.floor(k/l0);
                            let mud = k - duv*l0;
                            let r = 0;
                            if(mud <  l1) r = mud*2;
                            if(mud >= l1) r = (mud-l1)*2+1;
                            orbD3[(i0+j0+k)*4+3] = orbD3c[j0+r+l0*duv];
                        }
                    }
                }
            }
        }
        //sort X
        let dil = l/Math.pow(2,aniD);
        for(let i = 0; i < 4; ++i)
        {
            let i0 = i*l*l;
            let sqr = colTblPos3[i*3+2]*2;
            for(let j = 0; j < l; ++j)
            {
                let j0 = j*l;
                for(let k = 0; k < l; ++k)
                {
                    let duv = Math.floor(k/dil);
                    let mud = k - duv*dil;
                    let a = 0;
                    let b = 0;
                    if((k&1) == 0)  {a = j*a0;              b = mud*a1;}
                    else            {a = l-1-(l-1-j)*a0;    b = dil-1-(dil-1-mud)*a1;}
                    orbD3[(i0+j0+k)*4+0] = (dil*duv+b)*sqr;
                    orbD3[(i0+j0+k)*4+1] =-a*sqr;
                }
            }
        }
        //interlace Y
        aniD = Math.floor(aniY);
        aniM = aniY - aniD;
        a0 = Math.max(Math.max(aniM*1.5-.5,1-aniM*1.5),.4);
        a1 = Math.min(Math.max((1-aniM)*3-1,0),1)*.5+.5;
        if(aibo)
        {
            for(let h = 0; h < aniD; ++h)//color2
            {
                let l0 = l/Math.pow(2,h+0);
                let l1 = l/Math.pow(2,h+1);
                for(let i = 0; i < 4; ++i)
                {
                    let i0 = i*l*l;
                    for(let j = 0; j < l*l; ++j)//make copy
                    {
                        orbD3c[j] = orbD3[(i0 + j)*4+3];
                    }
                    for(let j = 0; j < l; ++j)//move from copy
                    {
                        let j0 = j*l;
                        for(let k = 0; k < l; ++k)
                        {
                            let duv = Math.floor(j/l0);
                            let mud = j - duv*l0;
                            let r = 0;
                            if(mud <  l1) r = mud*2;
                            if(mud >= l1) r = (mud-l1)*2+1;
                            orbD3[(i0+j0+k)*4+3] = orbD3c[(r+l0*duv)*l+k];
                        }
                    }
                }
            }
        }
        //sort Y
        if(aniY != 0)
        {
            let dil = l/Math.pow(2,aniD);
            for(let i = 0; i < 4; ++i)
            {
                let i0 = i*l*l;
                let sqr = colTblPos3[i*3+2]*2;
                for(let j = 0; j < l; ++j)
                {
                    let j0 = j*l;
                    for(let k = 0; k < l; ++k)
                    {
                        let duv = Math.floor(j/dil);
                        let mud = j - duv*dil;
                        let a = 0;
                        let b = 0;
                        if((j&1) == 0)  {a = k*a0;              b = mud*a1;}
                        else            {a = l-1-(l-1-k)*a0;    b = dil-1-(dil-1-mud)*a1;}
                        orbD3[(i0+j0+k)*4+0] = a*sqr;
                        orbD3[(i0+j0+k)*4+1] =-(dil*duv+b)*sqr;
                    }
                }
            }
        }
        //adjust
        var w = 0;
        for(let i = 0; i < 4; ++i)
        {
            let mcx = colTblPos3[i*3+0]*l - colTblPos3[i*3+2]*(l-1);
            let mcy = colTblPos3[i*3+1]*l + colTblPos3[i*3+2]*(l-1);
            for(let j = 0; j < l; ++j)
            {
                for(let k = 0; k < l; ++k)
                {
                    orbD3[w] += mcx;     ++w;
                    orbD3[w] += mcy;     ++w;
                    w += 2;
                }
            }
        }
        render3Gl();
    }

    var cnvs4 = null;
    var cntx4 = null;
    var boL4 = new Array(4);
    var colTblLbl4 = [  13,17*0-3, 24, "time domain samples = 2",
                        62,17*1-3, 24, "time domain samples = 4",
                        13,17*2-3, 24, "time domain samples = 8",
                        62,17*3-2, 24, "time domain samples = 16",
                        13,17*4-2, 24, "time domain samples = 32",];
    function interface4()
    {
        let fnz = "24px";
        let buI = null;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "previously there was a separate colored table that indicated the sign\n"+
                        "now the sign and value are in one table\n"+
                        "negative values have a  black square in the center\n"+
                        "positive values have no black square in the center";
        document.body.appendChild(buI);

        //color tables
        let dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "1200px";
        dv1.style.height = "1000px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs4 = document.createElement("canvas");
        cnvs4.style.position = "absolute";
        cnvs4.style.border = "0px";
        cnvs4.style.margin = "0px";
        cnvs4.style.width = "1200px";
        cnvs4.style.height = "1000px";
        dv1.appendChild(cnvs4);
        cntx4 = cnvs4.getContext("2d");

        for(let i = 0; i < colTblLbl4.length/4; ++i)
        {
            let io = i*4;
            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = colTblLbl4[io+0]+"%";
            buI.style.top       = colTblLbl4[io+1]+"%";
            buI.style.fontSize  = colTblLbl4[io+2]+"px";
            buI.style.display = "block";
            buI.style.textAlign = "center";
            //buI.style.color = "white";
            buI.innerHTML = colTblLbl4[io+3];
            dv1.appendChild(buI);
        }

        render4Gl();
    }
    function render4Gl()
    {
        let pxrt = 1;//window.devicePixelRatio;
        let rect = cnvs4.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs4.width = xrz;
        cnvs4.height = yrz;
        
        //update input data
        shdMtx[0] = xrz/yrz;

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        //draw orbs
        gl.useProgram(shaderP4);
        gl.uniformMatrix4fv(shdMtx4, false, shdMtx);
        gl.vertexAttribPointer(shdVtx4, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx4);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        cntx4.drawImage(cnvs0, 0, 0);
    }

    var orbN5b = 0;
    var orbN5c = 0;
    var orbNPW5 = 512;// > sqrt(256*256*4)
    var orbNMAX5 = orbNPW5*orbNPW5;
    var orbD5b = new Float32Array(orbNMAX5*4);//2D positions list
    var orbD5c = new Float32Array(orbNMAX5*4);//2D positions list
    var orbD5g = new Float32Array(256*256);
    var camOrb5b = new Float32Array([0,0,40,1]);//XY position, Z zoom, W/H screen ratio
    var camOrb5c = new Float32Array([0,0,40,1]);//XY position, Z zoom, W/H screen ratio
    var upTblc5b = -1;
    //var upTblc5c = -1;
    var cnvs5 = null;   var cnvs5b = null;  var cnvs5c = null;
    var cntx5 = null;   var cntx5b = null;  var cntx5c = null;
    var boL5 = new Array(16);
    var colTblPos5b = [ -1,-.55, .5,
                         1,-.55, .5,
                        -1, .55, .5,
                         1, .55, .5];
    function interface5()
    {
        let fnz = "24px";
        let buI = null;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "things are still too complex to easily see how to optimize          \n"+
                        "in general there are 2 things: [1] time domain samples colored table\n"+
                        "                               [2]    sin() , cos()   colored tables\n"+
                        "lets make one of them simpler and try to solve the problem again  \n"+
                        "lets replace sin(),cos() tables with square waves tables named -sinK(),cosK() ";
        document.body.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "control transition from sinusoidal wave to square wave";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "400px";
        buI.type = "range";
        buI.min     = 0;
        buI.max     = 1;
        buI.value   = 0;
        buI.step    = .001;
        buI.oninput = render5aGl;
        document.body.appendChild(buI);
        boL5[0] = buI;

        let dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "1000px";
        dv1.style.height = "200px";
        dv1.style.marginTop = "20px";
        dv1.style.marginBottom = "20px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs5 = document.createElement("canvas");
        cnvs5.style.position = "absolute";
        cnvs5.style.border = "0px";
        cnvs5.style.margin = "0px";
        cnvs5.style.width = "1000px";
        cnvs5.style.height = "200px";
        dv1.appendChild(cnvs5);
        cntx5 = cnvs5.getContext("2d");

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "lets generate the tables for these new functions";
        document.body.appendChild(buI);

        let ti2 = "time domain samples = 2<sup>3</sup> = 8";

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = ti2;
        document.body.appendChild(buI);
        boL5[1] = buI;

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "400px";
        buI.type = "range";
        buI.min     = 1;
        buI.max     = 4;
        buI.value   = 3;
        buI.step    = 1;
        buI.oninput = updt5;
        document.body.appendChild(buI);
        boL5[2] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "table for f(x) = cosK(x)";
        document.body.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        //buI.innerHTML = "... = a + b + c + d";
        document.body.appendChild(buI);
        boL5[3] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "table for f(x) =-sinK(x)";
        document.body.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        //buI.innerHTML = "... = a + b + c + d";
        document.body.appendChild(buI);
        boL5[4] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "lets transform these tables to color         \n"+
                        "then multiply them with the time domain table\n"+
                        "then interlace the columns                   \n"+
                        "multiplication is represented by one square moving above another square";
        document.body.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = ti2;
        document.body.appendChild(buI);
        boL5[7] = buI;

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "400px";
        buI.type = "range";
        buI.min     = 1;
        buI.max     = 4;
        buI.value   = 3;
        buI.step    = 1;
        buI.oninput = updt5;
        document.body.appendChild(buI);
        boL5[8] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "control animation";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "800px";
        buI.type = "range";
        buI.min     = 0;
        buI.max     = 1;
        buI.value   = 0;
        buI.step    = .0001;
        buI.oninput = updt5b;
        document.body.appendChild(buI);
        boL5[5] = buI;

        //cnvs
        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "1200px";
        dv1.style.height = "512px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs5b = document.createElement("canvas");
        cnvs5b.style.position = "absolute";
        cnvs5b.style.border = "0px";
        cnvs5b.style.margin = "0px";
        cnvs5b.style.width = "1200px";
        cnvs5b.style.height = "512px";
        dv1.appendChild(cnvs5b);
        cntx5b = cnvs5b.getContext("2d");

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "now lets optimize the calculations\n"+
                        "there are different methods in which arrays of numbers can be added, two of them are\n"+
                        "1 + 1 + 1 + 1 + 1 + 1 + 1 + 1                    1 + 1 + 1 + 1 + 1 + 1 + 1 + 1\n"+
                        "  2   + 1 + 1 + 1 + 1 + 1 + 1                      2   +   2   +   2   +   2  \n"+
                        "      3   + 1 + 1 + 1 + 1 + 1                          4       +       4      \n"+
                        "          4   + 1 + 1 + 1 + 1                                  8              \n"+
                        "              5   + 1 + 1 + 1                                                 \n"+
                        "                  6   + 1 + 1                                                 \n"+
                        "                      7   + 1                                                 \n"+
                        "                             8            this right side method is going to be used\n"+
                        "\n"+
                        "lets list all combinations of sum and substract of [ a , b ] \n"+
                        "\n"+
                        "+ a + b = X        if this pattern appears on the calculations\n"+
                        "+ a - b = Y        then only X and Y need to be calculated    \n"+
                        "- a + b =-Y        instead of calculating the 4 rows          \n"+
                        "- a - b =-X                                                   \n"+
                        "\n"+
                        "the next animation starts with the time domain samples after deinterlacing\n"+
                        "then squares get duplicated and moved representing variables getting duplicated and moved\n"+
                        "then squares get together only touching representing the sum between those squares       \n"+
                        "then squares get above others representing the multiplication between those squares      \n";
        document.body.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = ti2;
        document.body.appendChild(buI);
        boL5[9] = buI;

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "400px";
        buI.type = "range";
        buI.min     = 1;
        buI.max     = 4;
        buI.value   = 3;
        buI.step    = 1;
        buI.oninput = updt5;
        document.body.appendChild(buI);
        boL5[10] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "control animation";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "1200px";
        buI.type = "range";
        buI.min     = 0;
        buI.max     = 1;
        buI.value   = 0;
        buI.step    = .00001;
        buI.oninput = updt5c;
        document.body.appendChild(buI);
        boL5[6] = buI;

        //cnvs
        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "1200px";
        dv1.style.height = "512px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs5c = document.createElement("canvas");
        cnvs5c.style.position = "absolute";
        cnvs5c.style.border = "0px";
        cnvs5c.style.margin = "0px";
        cnvs5c.style.width = "1200px";
        cnvs5c.style.height = "512px";
        dv1.appendChild(cnvs5c);
        cntx5c = cnvs5c.getContext("2d");

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "in the previous animation                                                                       \n"+
                        "1 square  touching nothing  represents a single variable with a single value                    \n"+
                        "2 squares touching together represents a single variable with a single value                    \n"+
                        "                                       and the value is equal to the sum of the touching squares\n"+
                        "4 squares touching together represents a single variable with a single value                    \n"+
                        "                                       and the value is equal to the sum of the touching squares\n"+
                        "8 squares tou...                                                                                ";
        document.body.appendChild(buI);

        render5aGl();
        updt5(null);
    }
    function upOptiAni()
    {
        
    }
    function updt5(elemt)
    {
        let lez = 300;//font size calculator
        let lex = 300;//max font size

        let valu = 0;
        if(elemt == null)   valu = boL5[2].value*1;
        else                valu = elemt.target.value*1;
        let l = Math.pow(2,valu);
        if(elemt != null)
        {
            boL5[2].value = elemt.target.value;
            boL5[8].value = elemt.target.value;
            boL5[10].value = elemt.target.value;
            let lete = "time domain samples = 2<sup>"+ valu +"</sup> = "+ l + "\n";
            boL5[1].innerHTML = lete;
            boL5[7].innerHTML = lete;
            boL5[9].innerHTML = lete;
        }

        let mod = l*2-1;
        let hlf = l>>1;

        let a = "";
        for(let i = 0; i < l; ++i)//cos()
        {
            for(let j = 0; j < l; ++j)
            {
                //let b = (i*j*2) & mod;
                //if(b < hlf || b >= hlf*3)   a += "+";
                //else                        a += "-";

                let b = Math.cos(j*(PI*2*i/l) +.001);   //+.001 to make sign properly
                if(b < 0)   a += "-";
                else        a += "+";
                a += "1 ";
            }
            a += "\n";
        }
        boL5[3].innerHTML = a;
        boL5[3].style.fontSize = Math.min(lex,Math.floor(lez/l))+"px";

        mod = l-1;

        a = "";
        for(let i = 0; i < l; ++i)//sin()
        {
            for(let j = 0; j < l; ++j)
            {
                //let b = (i*j) & mod;
                //if(b < hlf) a += "-";
                //else        a += "+";

                let b = Math.sin(j*(PI*2*i/l) +.001);   //+.001 to make sign properly
                if(b < 0)   a += "-";
                else        a += "+";
                a += "1 ";
            }
            a += "\n";
        }
        boL5[4].innerHTML = a;
        boL5[4].style.fontSize = Math.min(lex,Math.floor(lez/l))+"px";

        updt5b();
        updt5c();
    }
    function updt5b()
    {
        let valu = boL5[2].value*1;
        let l = Math.pow(2,valu);
        let aniT = valu-1;
        let ani = boL5[5].value*aniT*1;
        let ao = .1;
        let aniX = Math.max(0,ani*(boL5[5].value-ao)/(1-ao));
        let aniY = Math.max(0,1-boL5[5].value/.1);

        let aniF = Math.floor(aniX);

        let aibo = upTblc5b != aniF;
        if (aibo){upTblc5b = aniF;}

        orbN5b = l*l*4;

        //interlace X
        let aniD = Math.floor(aniX);
        let aniM = aniX - aniD;
        let a0 = Math.max(Math.max(aniM*1.5-.5,1-aniM*1.5),.4);
        let a1 = Math.min(Math.max((1-aniM)*3-1,0),1)*.5+.5;
        if(aibo)
        {
            for(let i = 0; i < orbN5b; ++i){ orbD5b[i*4+3] = i; }//color1
            for(let h = 0; h < aniD; ++h)//color2
            {
                let l0 = l/Math.pow(2,h+0);
                let l1 = l/Math.pow(2,h+1);
                for(let i = 0; i < 4; ++i)
                {
                    let i0 = i*l*l;
                    for(let j = 0; j < l*l; ++j)//make copy
                    {
                        orbD5g[j] = orbD5b[(i0 + j)*4+3];
                    }
                    for(let j = 0; j < l; ++j)//move from copy
                    {
                        let j0 = j*l;
                        for(let k = 0; k < l; ++k)
                        {
                            let duv = Math.floor(k/l0);
                            let mud = k - duv*l0;
                            let r = 0;
                            if(mud <  l1) r = mud*2;
                            if(mud >= l1) r = (mud-l1)*2+1;
                            orbD5b[(i0+j0+k)*4+3] = orbD5g[j0+r+l0*duv];
                        }
                    }
                }
            }
        }
        //sort X
        let dil = l/Math.pow(2,aniD);
        for(let i = 0; i < 4; ++i)
        {
            let i0 = i*l*l;
            let sqr = colTblPos5b[i*3+2]*2;
            for(let j = 0; j < l; ++j)
            {
                let j0 = j*l;
                for(let k = 0; k < l; ++k)
                {
                    let duv = Math.floor(k/dil);
                    let mud = k - duv*dil;
                    let a = 0;
                    let b = 0;
                    if((k&1) == 0)  {a = j*a0;              b = mud*a1;}
                    else            {a = l-1-(l-1-j)*a0;    b = dil-1-(dil-1-mud)*a1;}
                    orbD5b[(i0+j0+k)*4+0] = (dil*duv+b)*sqr;
                    orbD5b[(i0+j0+k)*4+1] = -a*sqr;
                }
            }
        }
        //adjust
        var w = 0;
        for(let i = 0; i < 4; ++i)
        {
            let mcx = colTblPos5b[i*3+0]*l      - colTblPos5b[i*3+2]*(l-1);
            let mcy = colTblPos5b[i*3+1]*l*aniY + colTblPos5b[i*3+2]*(l-1);
            for(let j = 0; j < l; ++j)
            {
                for(let k = 0; k < l; ++k)
                {
                    orbD5b[w] += mcx;     ++w;
                    orbD5b[w] += mcy;     ++w;
                    w += 2;
                }
            }
        }
        
        camOrb5b[2] = l*(.8+aniY*.3);

        render5bGl();
    }
    function updt5c()
    {
        let valu = boL5[2].value*1;
        let l = Math.pow(2,valu);
        let ani = boL5[6].value*1*(valu+0)*l;
        

        //let aibo = upTblc5c != aniF;
        //if (aibo){upTblc5c = aniF;}

        //if(aibo)
        //{
            let mx = 1.5+valu;//time domain array distance
            let mx2 = (l-1)*mx*.5;

            let my = 1+(valu-1)*.11;
            let mi = 1.1;
            let v = valu;
            let my2 = ((((1<<v)-1)/(2-1)+v)*my + ((1<<valu)-1)*mi)*.5;

            let w = 0;
            let vt = valu+1;
            for(let i = 0; i < vt; ++i)//pow2 combination levels
            {
                let g = 1<<i;
                let sg = 1;//sum distance
                let sg2 = (g-1)*sg*.5;
                let iy = ((g-1)/(2-1)+i)*my;//moves more down each level

                let iB = Math.max(i-1,0);
                let gB = 1<<iB;

                for(let j = 0; j < l; ++j)//level
                {
                    let jx = j*mx-mx2;

                    let aAn = Math.min( Math.max(ani+l-i*l  -((j<<1) & (g-1))
                                                            -((j>>iB)&1)
                                                            -((j>>i)<<i)        , 0) , 1);
                    if(aAn == 0 && i != 0) continue;
                    let bAn = 1-aAn;

                    let aAnY = Math.min(aAn*1.5,1);
                    let bAnY = 1-aAnY;

                    for(let k = 0; k < g; ++k)//sum array
                    {
                        let kB = k & (gB-1);
                        let j1 =  k>>iB;
                        let j2 = (j>>iB)&1;
                             if(j2 != 0 && j1 != 0){ j1 = 0; }
                        else if(j2 != 0 && j1 == 0){ j1 = 1; }
                        let jB = j + j1*gB*(j2*-2+1);

                        let xB = kB*sg-(gB-1)*sg*.5  +  jB*mx-mx2;
                        let yB = my2 - ((gB-1)/(2-1)+iB)*my - mi*(j & (gB-1));

                        let xA = k*sg-sg2  +  jx;
                        let yA = my2 -iy - mi*(j & (g-1));

                        if(i == 0){ xB = xA; yB = yA; }

                        let eu = ((j>>i)<<i)+k;
                        if(i == 0) eu = j;

                        orbD5c[w] = xA*aAn  + xB*bAn;   ++w;
                        orbD5c[w] = yA*aAnY + yB*bAnY;  ++w;
                        orbD5c[w] = 0;                  ++w;
                        orbD5c[w] = eu+1;               ++w;

                        let rd = (gB-1)*l + (g>>1)*j + (k&((g>>1)-1));
                        let md = (g*g)>>2;
                        if(j2 == 0 && k >= (g>>1)) rd += md;
                        if(j2 != 0 && k <  (g>>1)) rd -= md;
                        if(i == 0) rd = (w>>2) -1;//read itself
                        rd = (rd<<2)+3;

                        let ml = Math.sin(j*PI*2/(1<<i) +.001);//+.001 to make sign properly
                        if(ml < 0) ml =-1;
                        else       ml = 1;
                        if(i== 0 || k < (g>>1) || aAnY != 1) ml = 1;

                        orbD5c[w-1] = orbD5c[rd]*ml;
                    }
                }
            }
        //}

        orbN5c = w/4;
        camOrb5c[2] = l*1.35;
        render5cGl();
    }
    function render5aGl()
    {
        let pxrt = 1;//window.devicePixelRatio;
        let rect = cnvs5.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs5.width = xrz;
        cnvs5.height = yrz;

        //update input data
        shdMtx[0] = xrz/yrz;
        shdMtx[1] = boL5[0].value;

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        //draw orbs
        gl.useProgram(shaderP5a);
        gl.uniformMatrix4fv(shdMtx5a, false, shdMtx);
        gl.vertexAttribPointer(shdVtx5a, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx5a);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        cntx5.drawImage(cnvs0, 0, 0);
    }
    function render5bGl()
    {
        let pxrt = 1;//window.devicePixelRatio;
        let rect = cnvs5b.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs5b.width = xrz;
        cnvs5b.height = yrz;

        camOrb5b[3] = xrz/yrz;
        
        //update input data
        shdMtx[0] = xrz;
        shdMtx[1] = yrz;
        //shdMtx[2] = inputX2;
        //shdMtx[3] = yrz-inputY2;
        //update camera data
        shdMtx[4] =   camOrb5b[0];
        shdMtx[5] =   camOrb5b[1];
        shdMtx[6] = 1/camOrb5b[2];
        shdMtx[7] = 1/camOrb5b[3];
        shdMtx[8] = orbNPW5;
        shdMtx[9] = Math.pow(2,boL5[2].value*1);

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        if(textMode != 2)
        {  textMode  = 2;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex2);
        }
        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, orbNPW5, orbNPW5, gl.RGBA, gl.FLOAT, orbD5b);

        gl.enable(gl.BLEND);

        //draw orbs
        gl.useProgram(shaderP5b);
        gl.uniform1i(shdTex5b, 0);
        gl.uniformMatrix4fv(shdMtx5b, false, shdMtx);
        gl.vertexAttribPointer(shdVtx5b, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx5b);
        gl.drawArrays(gl.TRIANGLES, 0, orbN5b*3);

        gl.disable(gl.BLEND);

        cntx5b.drawImage(cnvs0, 0, 0);
    }
    function render5cGl()
    {
        let pxrt = 1;//window.devicePixelRatio;
        let rect = cnvs5c.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs5c.width = xrz;
        cnvs5c.height = yrz;

        camOrb5c[3] = xrz/yrz;
        
        //update input data
        shdMtx[0] = xrz;
        shdMtx[1] = yrz;
        //shdMtx[2] = inputX2;
        //shdMtx[3] = yrz-inputY2;
        //update camera data
        shdMtx[4] =   camOrb5c[0];
        shdMtx[5] =   camOrb5c[1];
        shdMtx[6] = 1/camOrb5c[2];
        shdMtx[7] = 1/camOrb5c[3];
        shdMtx[8] = orbNPW5;
        shdMtx[9] = Math.pow(2,boL5[2].value*1);

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        if(textMode != 2)
        {  textMode  = 2;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex2);
        }
        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, orbNPW5, orbNPW5, gl.RGBA, gl.FLOAT, orbD5c);

        //draw orbs
        gl.useProgram(shaderP5c);
        gl.uniform1i(shdTex5c, 0);
        gl.uniformMatrix4fv(shdMtx5c, false, shdMtx);
        gl.vertexAttribPointer(shdVtx5c, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx5c);
        gl.drawArrays(gl.TRIANGLES, 0, orbN5c*3);

        cntx5c.drawImage(cnvs0, 0, 0);
    }

    var orbN6 = 0;
    var orbNPW6 = 512;// > sqrt(256*256*4)
    var orbNMAX6 = orbNPW6*orbNPW6;
    var orbD6 = new Float32Array(orbNMAX6*4);//2D positions list
    var orbD6c= new Float32Array(256*256*2);//2D positions list
    var camOrb6e = new Float32Array([0,0,40,1]);//XY position, Z zoom, W/H screen ratio
    var camOrb6f = new Float32Array([0,0,40,1]);//XY position, Z zoom, W/H screen ratio
    var upTblc6 = -1;//apply calclation only when changing interlacing level

    var buL6 = null;
    var boL6 = new Array(16);
    var cnvs6a = null; var cnvs6b = null; var cnvs6c = null; var cnvs6d = null; var cnvs6e = null; var cnvs6f = null;  var cnvs6g = null;
    var cntx6a = null; var cntx6b = null; var cntx6c = null; var cntx6d = null; var cntx6e = null; var cntx6f = null;  var cntx6g = null;
    var inp6a = new Float32Array([.2,.0]);
    var inp6b = new Float32Array([.3,.4,.0]);
    var inp6c = new Float32Array([.1,.7]);
    var inpTch = -1;
    var inpMou = -1;
    var boL6fv0 = true; //last changed
    var boL6fv1 = 0;    //detect if boL6[] or boL6[] value changed
    var boL6fv2 = 0;    //detect if boL6[] or boL6[] value changed
    var chng6g;
    function interface6()
    {
        let rti = [
            200, 4/3,
            300, 7/4, 
            350, 6/6, 
            400, 3/9, 
        ];
        let rtr = 0;

        let fnz = "24px";
        let buI = null;
        let dv1 = null;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "there is another way to visualize e<sup>i*&#120587;*2*x</sup>\n"+
                        "x can be any real number                     \n"+
                        "x in these visualizations has a limited range\n"+
                        "x is tranformed from line to angle           \n"+
                        "click on the shapes to interact";
        document.body.appendChild(buI);

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = Math.floor(rti[rtr+0]*rti[rtr+1])+"px";    
        dv1.style.height = rti[rtr+0]+"px";
        //dv1.style.marginTop = "20px";
        //dv1.style.marginBottom = "20px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs6a = document.createElement("canvas");
        cnvs6a.style.position = "absolute";
        cnvs6a.style.border = "0px";
        cnvs6a.style.margin = "0px";
        cnvs6a.style.width = Math.floor(rti[rtr+0]*rti[rtr+1])+"px";  
        cnvs6a.style.height = rti[rtr+0]+"px";              rtr += 2;
        dv1.appendChild(cnvs6a);
        cntx6a = cnvs6a.getContext("2d");

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "16%";
            buI.style.top       = "-3%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "x =";
            dv1.appendChild(buI);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "-15%";
            buI.style.top       = "43%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "e<sup>i*&#120587;*2*x</sup> =";
            dv1.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "multiplication sums the angles";
        document.body.appendChild(buI);

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = Math.floor(rti[rtr+0]*rti[rtr+1])+"px"; 
        dv1.style.height = rti[rtr+0]+"px";
        //dv1.style.marginTop = "20px";
        //dv1.style.marginBottom = "20px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs6b = document.createElement("canvas");
        cnvs6b.style.position = "absolute";
        cnvs6b.style.border = "0px";
        cnvs6b.style.margin = "0px";
        cnvs6b.style.width = Math.floor(rti[rtr+0]*rti[rtr+1])+"px"; 
        cnvs6b.style.height = rti[rtr+0]+"px";              rtr += 2;
        dv1.appendChild(cnvs6b);
        cntx6b = cnvs6b.getContext("2d");

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "32%";
            buI.style.top       = "-1%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "x =";
            dv1.appendChild(buI);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "54%";
            buI.style.top       = "-1%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "y =";
            dv1.appendChild(buI);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "30%";
            buI.style.top       = "24%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "x + y =";
            dv1.appendChild(buI);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "-4%";
            buI.style.top       = "59%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "e<sup>i*&#120587;*2*x</sup> * e<sup>i*&#120587;*2*y</sup> =";
            dv1.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "summation is not intuitive so this visualization is not going to be used";
        document.body.appendChild(buI);

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = Math.floor(rti[rtr+0]*rti[rtr+1])+"px"; 
        dv1.style.height = rti[rtr+0]+"px";
        //dv1.style.marginTop = "20px";
        //dv1.style.marginBottom = "20px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs6c = document.createElement("canvas");
        cnvs6c.style.position = "absolute";
        cnvs6c.style.border = "0px";
        cnvs6c.style.margin = "0px";
        cnvs6c.style.width = Math.floor(rti[rtr+0]*rti[rtr+1])+"px"; 
        cnvs6c.style.height = rti[rtr+0]+"px";              rtr += 2;
        dv1.appendChild(cnvs6c);
        cntx6c = cnvs6c.getContext("2d");

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "10%";
            buI.style.top       = "-3%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "x =";
            dv1.appendChild(buI);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "79%";
            buI.style.top       = "-3%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "= y";
            dv1.appendChild(buI);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "-15%";
            buI.style.top       = "20%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "e<sup>i*&#120587;*2*x</sup> =";
            dv1.appendChild(buI);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "79%";
            buI.style.top       = "20%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "= e<sup>i*&#120587;*2*y</sup>";
            dv1.appendChild(buI);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "-45%";
            buI.style.top       = "53%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "e<sup>i*&#120587;*2*x</sup> + e<sup>i*&#120587;*2*y</sup> =";
            dv1.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "  e<sup>i*&#120587;*2*x</sup>    will be visualized as a circle\n"+
                        "a realNumber will be visualized as a square";
        document.body.appendChild(buI);

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = Math.floor(rti[rtr+0]*rti[rtr+1])+"px"; 
        dv1.style.height = rti[rtr+0]+"px";
        //dv1.style.marginTop = "20px";
        //dv1.style.marginBottom = "20px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs6d = document.createElement("canvas");
        cnvs6d.style.position = "absolute";
        cnvs6d.style.border = "0px";
        cnvs6d.style.margin = "0px";
        cnvs6d.style.width = Math.floor(rti[rtr+0]*rti[rtr+1])+"px"; 
        cnvs6d.style.height = rti[rtr+0]+"px";              rtr += 2;
        dv1.appendChild(cnvs6d);
        cntx6d = cnvs6d.getContext("2d");

        var colTblLbl6 = [  0,1,0,.001, -74,5,24,   "realNumberA * e<sup>i*&#120587;*2*x</sup>",
                            0,1,0,.001, -180,38,24, "realNumberA * e<sup>i*&#120587;*2*x</sup> + realNumberB * e<sup>i*&#120587;*2*y</sup>",
                            0,1,0,.001, -180,72,24, "realNumberA * e<sup>i*&#120587;*2*x</sup> * e<sup>i*&#120587;*2*y</sup>"];
        
        buL6 = new Array(colTblLbl6.length/8);
        for(let i = 0; i < buL6.length; ++i)
        {
            let io = i*8;
            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = colTblLbl6[io+4]+"%";
            buI.style.top       = colTblLbl6[io+5]+"%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            //buI.style.color = "white";
            buI.innerHTML = colTblLbl6[io+7];
            dv1.appendChild(buI);

            buI = document.createElement("input");
            buI.style.position = "absolute";
            buI.style.left  = "125%";
            buI.style.top   = colTblLbl6[io+5]+20+"%";
            buI.style.width = "100%";
            buI.type = "range";
            buI.min =   colTblLbl6[io+0];
            buI.max =   colTblLbl6[io+1];
            buI.value = colTblLbl6[io+2];
            buI.step =  colTblLbl6[io+3];
            buI.oninput = render6dGl;
            dv1.appendChild(buI);
            buL6[i] = buI;
        }

        let inp6Toch1 = function(e)
        {
            inpTch = 0;
            inp6(e.changedTouches[0]);
        }
        let inp6Toch2 = function(e)
        {
            if(inpTch < 0) return;
            inp6(e.changedTouches[0]);
        }
        let inp6Toch3 = function(e)
        {
            inpTch = -1;
        }
        let inp6Mous1 = function(e)
        {
            inpMou = 0;
            inp6(e);
        }
        let inp6Mous2 = function(e)
        {
            if(inpMou < 0) return;
            inp6(e);
        }
        let inp6Mous3 = function(e)
        {
            inpMou = -1;
        }
        let iniInp = function(e, i)
        {
            e.idi = i;
            e.addEventListener("touchstart",  inp6Toch1,    true);
            e.addEventListener("touchmove",   inp6Toch2,    true);
            e.addEventListener("touchend",    inp6Toch3,    true);
            e.addEventListener("touchcancel", inp6Toch3,    true);
            e.addEventListener("mousedown",   inp6Mous1,    true);
            e.addEventListener("mousemove",   inp6Mous2,    true);
            e.addEventListener("mouseup",     inp6Mous3,    true);
            e.addEventListener("mouseout",    inp6Mous3,    true);
            e.addEventListener("mouseleave",  inp6Mous3,    true);
        }
        iniInp(cnvs6a, 0);
        iniInp(cnvs6b, 1);
        iniInp(cnvs6c, 2);
        iniInp(cnvs6d, 3);
        render6aGl();
        render6bGl();
        render6cGl();
        render6dGl();


        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "\n"+
                        "for y*e<sup>i*&#120587;*2*x</sup>\n"+
                        "  y    is called the AMPLITUDE\n"+
                        "&#120587;*2*x  is called the PHASE    \n"+
                        "\n"+
                        "y*e<sup>i*&#120587;*2*x</sup> = y*cos(&#120587;*2*x) + y*sin(&#120587;*2*x)*i\n"+
                        "y*cos(&#120587;*2*x)  is called the REAL      part\n"+
                        "y*sin(&#120587;*2*x)  is called the IMAGINARY part\n"+
                        "\n"+
                        "one fast way of adding an array of numbers is";
        document.body.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        //buI.innerHTML = "2<sup>2</sup> = 4 numbers";
        document.body.appendChild(buI);
        boL6[7] = buI;

        chng6g = function()
        {
            var a = boL6[8].value|0;
            boL6[7].innerHTML = "2<sup>"+a+"</sup> = "+(1<<a)+" samples";
            render6gGl();
        }

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "200px";
        buI.type = "range";
        buI.min     = 1;
        buI.max     = 4;
        buI.value   = 2;
        buI.step    = 1;
        buI.oninput = chng6g;
        document.body.appendChild(buI);
        boL6[8] = buI;

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "500px";
        buI.type = "range";
        buI.min     = 0;
        buI.max     = 1;
        buI.value   = 0;
        buI.step    = 1/512;
        buI.oninput = render6gGl;
        document.body.appendChild(buI);
        boL6[9] = buI;

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "900px"; 
        dv1.style.height = "300px";
        //dv1.style.marginTop = "20px";
        //dv1.style.marginBottom = "20px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs6g = document.createElement("canvas");
        cnvs6g.style.position = "absolute";
        cnvs6g.style.border = "0px";
        cnvs6g.style.margin = "0px";
        cnvs6g.style.width = "100%"; 
        cnvs6g.style.height = "100%";
        dv1.appendChild(cnvs6g);
        cntx6g = cnvs6g.getContext("2d");

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "lets transform time domain samples into frequency domain samples";
        document.body.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        document.body.appendChild(buI);
        boL6[0] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "time domain samples = 2<sup>2</sup> = 4";
        document.body.appendChild(buI);
        boL6[1] = buI;

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "200px";
        buI.type = "range";
        buI.min     = 1;
        buI.max     = 4;
        buI.value   = 2;
        buI.step    = 1;
        buI.oninput = cirTbl;
        document.body.appendChild(buI);
        boL6[2] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        document.body.appendChild(buI);
        boL6[3] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px 0px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "lets transform these equations into circles and squares";
        document.body.appendChild(buI);

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "300px"; 
        dv1.style.height = "300px";
        //dv1.style.marginTop = "20px";
        //dv1.style.marginBottom = "20px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs6e = document.createElement("canvas");
        cnvs6e.style.position = "absolute";
        cnvs6e.style.border = "0px";
        cnvs6e.style.margin = "0px";
        cnvs6e.style.width = "300px"; 
        cnvs6e.style.height = "300px";
        dv1.appendChild(cnvs6e);
        cntx6e = cnvs6e.getContext("2d");

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "110%";
            buI.style.top       = "25%";
            buI.style.fontSize  = "20px";
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "squares arranged in a color gradient\n"+
                            "does not mean\n"+
                            "squares arranged in a value gradient\n"+
                            "the color gradient helps the next\n"+
                            "animation to look more organized ";
            dv1.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "now deinterlace it only horizontally";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "1200px";
        buI.type = "range";
        buI.min     = 0;
        buI.max     = 1;
        buI.value   = 0;
        buI.step    = .00001;
        buI.oninput = cirTbl2;
        document.body.appendChild(buI);
        boL6[4] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "one optimal way to generate this table is";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "1200px";
        buI.type = "range";
        buI.min     = 0;
        buI.max     = 1;
        buI.value   = 0;
        buI.step    = .0001;
        buI.oninput = cirTbl3;
        document.body.appendChild(buI);
        boL6[5] = buI;

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "1200px";
        buI.type = "range";
        buI.min     = 0;
        buI.max     = 1;
        buI.value   = 0;
        buI.step    = .0001;
        buI.oninput = cirTbl3;
        document.body.appendChild(buI);
        boL6[6] = buI;

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "1200px"; 
        dv1.style.height = "550px";
        //dv1.style.marginTop = "20px";
        //dv1.style.marginBottom = "20px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs6f = document.createElement("canvas");
        cnvs6f.style.position = "absolute";
        cnvs6f.style.border = "0px";
        cnvs6f.style.margin = "0px";
        cnvs6f.style.width = "1200px"; 
        cnvs6f.style.height = "550px";
        dv1.appendChild(cnvs6f);
        cntx6f = cnvs6f.getContext("2d");

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "each row of this last generated stair is equal to       \n"+
                        "each row of the previous horizontally deinterlaced table";
        document.body.appendChild(buI);

        cirTbl();
        chng6g();
    }
    function cirTbl()
    {
        let lez = 2200;//font size calculator
        let lex = 40;//max font size

        let valu = boL6[2].value;
        let l = Math.pow(2,valu);
        boL6[1].innerHTML = "time domain samples = 2<sup>"+ valu +"</sup> = " + l;

        let a = "";

        let arr = new Array(l);
        a = "[";
        for(let i = 0; i < l; ++i)//time domain samples
        {
            let b = Math.floor(Math.random()*19-9);
            arr[i] = b;
            if(b >= 0) a += " ";
            a += b;
            if(i+1 < l) a += ",";
        }
        a += "]";
        boL6[0].style.fontSize = Math.min(lex,Math.floor(lez/a.length))+"px";
        boL6[0].innerHTML = a;

        let arr2 = new Array(2*l);
        a = "";
        let lng = 0;
        for(let i = 0; i < l; ++i)//tranform time to frequency
        {
            let c = "";

            let imag = 0;
            let real = 0;
            for(let j = 0; j < l; ++j)
            {
                if(arr[j] >= 0) c += " ";
                c += arr[j];

                c += "*e<sup>i*&#120587;*2*";

                c += j+"*";
                if(l > 10 && i<10) c += " ";
                c += i;
                c += "/"+l;

                c += "</sup>";
                
                if(j+1 < l) c += " + ";

                let d = PI*2*i*j/l;
                real += Math.cos(d)*arr[j];
                imag += Math.sin(d)*arr[j];
            }
            if(real             >= 0) a += " ";
            if(Math.abs(real)   < 10) a += " ";
            a += real.toFixed(2);
            if(Math.abs(imag)   < 10) a += " ";
            if(imag             >= 0) a += "+";
            a += imag.toFixed(2)+"*i"+" = "+c;
            a += "\n";

            arr2[i*2+0] = real;
            arr2[i*2+1] = imag;

            if(i == 0) lng = a.length;
        }
        boL6[3].style.fontSize = Math.min(lex,Math.floor(lez*2.1/lng))+"px";
        boL6[3].innerHTML = a;

        upTblc6 = -1;
        cirTbl2();
        cirTbl3();
    }
    function cirTbl2()
    {
        let valu = boL6[2].value*1;
        let l = Math.pow(2,valu);
        let aniT = valu-1;
        let ani = boL6[4].value*aniT;
        let aniF = Math.floor(ani);
        let aniX = ani;

        let aibo = upTblc6 != aniF;
        if (aibo){upTblc6 = aniF;}

        orbN6 = l*l;
        camOrb6e[2] = l*.5;

        //interlace X
        let aniD = Math.floor(aniX);
        let aniM = aniX - aniD;
        let a0 = Math.max(Math.max(aniM*1.5-.5,1-aniM*1.5),.4);
        let a1 = Math.min(Math.max((1-aniM)*3-1,0),1)*.5+.5;
        if(aibo)
        {
            for(let i = 0; i < orbN6; ++i)//color1
            {
                let b = i&(l-1);
                    b = ((b * 0x0802 & 0x22110) | (b * 0x8020 & 0x88440)) * 0x10101 >> (16+8-valu);
                orbD6[i*4+2] = b&(l-1); //square color
                orbD6[i*4+3] = i;       //circle angle
            }
            for(let h = 0; h < aniD; ++h)//color2
            {
                let l0 = l/Math.pow(2,h+0);
                let l1 = l/Math.pow(2,h+1);
                for(let i = 0; i < 1; ++i)
                {
                    let i0 = i*l*l;
                    for(let j = 0; j < l*l; ++j)//make copy
                    {
                        orbD6c[j*2+0] = orbD6[(i0 + j)*4+2];
                        orbD6c[j*2+1] = orbD6[(i0 + j)*4+3];
                    }
                    for(let j = 0; j < l; ++j)//move from copy
                    {
                        let j0 = j*l;
                        for(let k = 0; k < l; ++k)
                        {
                            let duv = Math.floor(k/l0);
                            let mud = k - duv*l0;
                            let r = 0;
                            if(mud <  l1) r = mud*2;
                            if(mud >= l1) r = (mud-l1)*2+1;
                            orbD6[(i0+j0+k)*4+2] = orbD6c[(j0+r+l0*duv)*2+0];
                            orbD6[(i0+j0+k)*4+3] = orbD6c[(j0+r+l0*duv)*2+1];
                        }
                    }
                }
            }
        }
        //sort X
        let dil = l/Math.pow(2,aniD);
        let sqr = .5*2;
        for(let j = 0; j < l; ++j)
        {
            let j0 = j*l;
            for(let k = 0; k < l; ++k)
            {
                let duv = Math.floor(k/dil);
                let mud = k - duv*dil;
                let a = 0;
                let b = 0;
                if((k&1) == 0)  {a = j*a0;              b = mud*a1;}
                else            {a = l-1-(l-1-j)*a0;    b = dil-1-(dil-1-mud)*a1;}
                orbD6[(j0+k)*4+0] = (dil*duv+b)*sqr;
                orbD6[(j0+k)*4+1] =-a*sqr;
            }
        }
        //adjust
        var w = 0;
        for(let i = 0; i < 1; ++i)
        {
            let ys = 1;//.2;
            let mcx = - .5*(l-1);
            let mcy = + .5*(l-1)*ys;
            
            for(let j = 0; j < l; ++j)
            {
                for(let k = 0; k < l; ++k)
                {
                    orbD6[w] = orbD6[w]    + mcx;     ++w;
                    orbD6[w] = orbD6[w]*ys + mcy;     ++w;
                    w += 2;
                }
            }
        }

        render6eGl();
    }
    function cirTbl3()
    {
        let valu = boL6[2].value*1;
        let l = Math.pow(2,valu);
        let ani = boL6[6].value*(valu+0)*l;
        let anu = boL6[5].value*1;
        let anu1 = anu/.8;      if(anu1<0) anu1 = 0;
                                if(anu1>1) anu1 = 1;
        let anu2 = (anu-.8)/.2; if(anu2<0) anu2 = 0;
                                if(anu2>1) anu2 = 1;

        if(boL6fv1 != anu) {boL6fv0 =  true; boL6fv1 = anu;}
        if(boL6fv2 != ani) {boL6fv0 = false; boL6fv2 = ani;}
        
        //let aibo = upTblc5c != aniF;
        //if (aibo){upTblc5c = aniF;}

        //if(aibo)
        //{
            let mx = 1.5+valu;//time domain array distance
            let mx2 = (l-1)*mx*.5;

            let my = 1+(valu-1)*.11;
            let mi = 1.1;
            let v = valu;
            let my2 = l*1.415-.5;//((((1<<v)-1)/(2-1)+v)*my + ((1<<valu)-1)*mi)*.5;

            let w = 0;
            
            // let a = 1.25;//circles separation 
            // for(let j = 0; j < l; ++j)//multiplyer array
            // {
            //     orbD6[w] = j*a-(l-1)*a*.5;  ++w;
            //     orbD6[w] = -my2;            ++w;
            //     orbD6[w] = j/l;             ++w;  //circle angle
            //     orbD6[w] = -1;              ++w;  //square color removed
            // }
            //     orbD6[w] = -1.5*a-(l-1)*a*.5;   ++w;
            //     orbD6[w] = -my2+.5;             ++w;
            //     orbD6[w] = 0;                   ++w;  //circle angle
            //     orbD6[w] = -1;                  ++w;  //square color removed
            if(!boL6fv0){anu1 = 1; anu2 = 1; anu = 1;}

            let vt = valu+1;
            for(let i = 2; i < vt; ++i)//pow2 combination levels
            {
                let g = 1<<i;
                let g1 = g-1;
                let ghlf = g>>1;
                let sg = 1;//sum distance
                let sg2 = g1*sg*.5;
                let iy = (g1/(2-1)+i)*my;//moves more down each level

                let hh = Math.max(i-2,0);
                    hh = (1<<hh)-.5; if(i==1) hh=0;

                for(let j = 0; j < l; ++j)//level
                {
                    let xA = j*mx-mx2+(-sg2 +hh)*anu2;
                    let yA = my2 -iy - mi*(j & g1)*anu2;

                    let ang = j/g;
                        ang = ang - Math.floor(ang);

                    if(j > anu1*l) continue;
                    for(let k = 0; k < 2; ++k)
                    {
                        if(k==0 && anu!=1) continue;
                        orbD6[w] = xA + (k*ghlf)*sg*anu2;   ++w;
                        orbD6[w] = yA;                      ++w;
                        orbD6[w] = ang*(k!=0);              ++w;  //circle angle
                        orbD6[w] = -1;                      ++w;  //square color
                    }
                }
                if(anu1!=0 && anu1!=1)
                {
                    let ang2 = anu1*l/g;
                        ang2 = ang2 - Math.floor(ang2);
                    orbD6[w] = anu1*l*mx-mx2;           ++w;
                    orbD6[w] = my2 -iy;                 ++w;
                    orbD6[w] = ang2;                    ++w;  //circle angle
                    orbD6[w] = -1;                      ++w;  //square color
                }
            }

            let wm = w>>2;//w offset
            for(let i = 0; i < vt && !(i!=0 && boL6fv0); ++i)//pow2 combination levels
            {
                let g = 1<<i;
                let g1 = g-1;
                let ghlf = g>>1;
                let sg = 1;//sum distance
                let sg2 = g1*sg*.5;
                let iy = (g1/(2-1)+i)*my;//moves more down each level
                let gu = 1/g;
                let md = (g*g)>>2;

                let iB = Math.max(i-1,0);
                let gB = 1<<iB;
                let gB1 = gB-1;

                let xkhlf = gB1*sg*.5;

                for(let j = 0; j < l; ++j)//level
                {
                    let jx = j*mx-mx2;
                    let ml = gu*(j & g1);
                    let jg = ((l>>i)*(j & g1)) << 2;

                    let aAn = Math.min( Math.max(ani+l-i*l  -((j<<1) & g1)
                                                            -((j>>iB)&1)
                                                            -((j>>i)<<i)        , 0) , 1);
                    if(aAn == 0 && i != 0) continue;
                    let bAn = 1-aAn;

                    //let aAnX = Math.max(Math.min(aAn*3-2,1),0); let bAnX = 1-aAnX;
                    //let aAnY = Math.max(Math.min(aAn*3-1,1),0); let bAnY = 1-aAnY;
                    //let aAnG = Math.min(aAn*3,1);               let bAnG = 1-aAnG;

                    for(let k = 0; k < g; ++k)//sum array
                    {
                        //calculate position
                        let kB = k & gB1;
                        let j1 =  k>>iB;
                        let j2 = (j>>iB)&1;
                             if(j2 != 0 && j1 != 0){ j1 = 0; }
                        else if(j2 != 0 && j1 == 0){ j1 = 1; }
                        let jB = j + j1*gB*(j2*-2+1);

                        let xB = kB*sg-xkhlf  +  jB*mx-mx2;
                        let yB = my2 - (gB1/(2-1)+iB)*my - mi*(j & gB1);

                        let xA = k*sg-sg2  +  jx;
                        let yA = my2 -iy - mi*(j & g1);

                        if(i == 0){ xB = xA; yB = yA; }

                        //calculate circle
                        let rd = gB1*l + ghlf*j + (k&(ghlf-1));
                        if(j2 == 0 && k >= ghlf) rd += md;
                        if(j2 != 0 && k <  ghlf) rd -= md;
                        if(i == 0) rd = w>>2-wm; //read itself
                        rd = ((rd+wm)<<2)+2;

                        let ml2 = ml;

                        let vrd = orbD6[rd];
                        if((i > 1 && aAn >= .5) || aAn == 1)
                        {
                            if(k < ghlf) ml2 = 0;
                            vrd+= ml2*(aAn*2-1);
                            vrd = vrd - Math.floor(vrd);
                        }
                        if(i == 0)  vrd = -1; //show no circle
                        //if(k == 0)  ml2 = 0;

                        //calculate square
                        let eu = ((j>>i)<<i)+k;
                        if(i == 0) eu = j;

                        //let bolo = (k == 0 || k == ghlf) && aAn == 0;
                        //let xG = 0; let yG = 0;
                        //if(bolo)
                        //{
                        //    let jtm = jg;
                        //    if(k == 0) jtm = l<<2;
                        //    xG = (xB+xkhlf)*aAnG  +  orbD6[jtm+0]*bAnG;
                        //    yG = yA        *aAnG  +  orbD6[jtm+1]*bAnG;
                        //}

                        //e^x multiplier
                        // if(i > 1 && bolo)
                        // {
                        //     orbD6[w] = xG;              ++w;
                        //     orbD6[w] = yG;              ++w;
                        //     orbD6[w] = ml2;             ++w;  //circle angle
                        //     orbD6[w] = -1;              ++w;  //square color removed
                        // }

                        //normal
                        orbD6[w] = xA*aAn + xB*bAn;     ++w;
                        orbD6[w] = yA*aAn + yB*bAn;     ++w;
                        orbD6[w] = vrd;                 ++w;  //circle angle
                        orbD6[w] = eu;                  ++w;  //square color

                        //e^x multiplier
                        //if(i == 1 && bolo)
                        //{
                        //    orbD6[w] = xG;              ++w;
                        //    orbD6[w] = yG;              ++w;
                        //    orbD6[w] = ml2;             ++w;  //circle angle
                        //    orbD6[w] = -1;              ++w;  //square color removed
                        //}
                    }
                }
            }
        //}

        for(let i = 1; i < 2; ++i)//pow2 combination levels
            {
                let g = 1<<i;
                let g1 = g-1;
                let ghlf = g>>1;
                let sg = 1;//sum distance
                let sg2 = g1*sg*.5;
                let iy = (g1/(2-1)+i)*my;//moves more down each level

                let hh = Math.max(i-2,0);
                    hh = (1<<hh)-.5; if(i==1) hh=0;

                for(let j = 0; j < l; ++j)//level
                {
                    let xA = j*mx-mx2+(-sg2 +hh)*anu2;
                    let yA = my2 -iy - mi*(j & g1)*anu2;

                    let ang = j/g;
                        ang = ang - Math.floor(ang);

                    if(j > anu1*l) continue;
                    for(let k = 0; k < 2; ++k)
                    {
                        if(k==0 && anu!=1) continue;
                        orbD6[w] = xA + (k*ghlf)*sg*anu2;   ++w;
                        orbD6[w] = yA;                      ++w;
                        orbD6[w] = ang*(k!=0);              ++w;  //circle angle
                        orbD6[w] = -1;                      ++w;  //square color
                    }
                }
                if(anu1!=0 && anu1!=1)
                {
                    let ang2 = anu1*l/g;
                        ang2 = ang2 - Math.floor(ang2);
                    orbD6[w] = anu1*l*mx-mx2;           ++w;
                    orbD6[w] = my2 -iy;                 ++w;
                    orbD6[w] = ang2;                    ++w;  //circle angle
                    orbD6[w] = -1;                      ++w;  //square color
                }
            }

        upTblc6 = -2; //do aibo from cirTbl2

        orbN6 = w>>2;
        camOrb6f[2] = l*1.415;
        render6fGl();
    }
    function render6aGl()
    {
        let pxrt = window.devicePixelRatio*2;
        let rect = cnvs6a.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs6a.width = xrz;
        cnvs6a.height = yrz;

        //update input data
        shdMtx[0] = xrz/yrz;
        shdMtx[1] = inp6a[0];
        shdMtx[2] = inp6a[1];

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        //draw orbs
        gl.useProgram(shaderP6a);
        gl.uniformMatrix4fv(shdMtx6a, false, shdMtx);
        gl.vertexAttribPointer(shdVtx6a, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx6a);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        cntx6a.drawImage(cnvs0, 0, 0);
    }
    function render6bGl()
    {
        let pxrt = window.devicePixelRatio*2;
        let rect = cnvs6b.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs6b.width = xrz;
        cnvs6b.height = yrz;

        //update input data
        shdMtx[0] = xrz/yrz;
        shdMtx[1] = inp6b[0];
        shdMtx[2] = inp6b[1];
        shdMtx[3] = inp6b[2];

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        //draw orbs
        gl.useProgram(shaderP6b);
        gl.uniformMatrix4fv(shdMtx6b, false, shdMtx);
        gl.vertexAttribPointer(shdVtx6b, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx6b);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        cntx6b.drawImage(cnvs0, 0, 0);
    }
    function render6cGl()
    {
        let pxrt = window.devicePixelRatio*2;
        let rect = cnvs6c.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs6c.width = xrz;
        cnvs6c.height = yrz;

        //update input data
        shdMtx[0] = xrz/yrz;
        shdMtx[1] = inp6c[0];
        shdMtx[2] = inp6c[1];

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        //draw orbs
        gl.useProgram(shaderP6c);
        gl.uniformMatrix4fv(shdMtx6c, false, shdMtx);
        gl.vertexAttribPointer(shdVtx6c, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx6c);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        cntx6c.drawImage(cnvs0, 0, 0);
    }
    function render6dGl()
    {
        let pxrt = window.devicePixelRatio*2;
        let rect = cnvs6d.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs6d.width = xrz;
        cnvs6d.height = yrz;

        //update input data
        shdMtx[0] = xrz/yrz;
        shdMtx[1] = buL6[0].value;
        shdMtx[2] = buL6[1].value;
        shdMtx[3] = buL6[2].value;

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        //draw orbs
        gl.useProgram(shaderP6d);
        gl.uniformMatrix4fv(shdMtx6d, false, shdMtx);
        gl.vertexAttribPointer(shdVtx6d, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx6d);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        cntx6d.drawImage(cnvs0, 0, 0);
    }
    function render6eGl()
    {
        let pxrt = window.devicePixelRatio;
        let rect = cnvs6e.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs6e.width = xrz;
        cnvs6e.height = yrz;

        camOrb6e[3] = xrz/yrz;
        
        //update input data
        shdMtx[0] = xrz;
        shdMtx[1] = yrz;
        //shdMtx[2] = inputX2;
        //shdMtx[3] = yrz-inputY2;
        //update camera data
        shdMtx[4] =   camOrb6e[0];
        shdMtx[5] =   camOrb6e[1];
        shdMtx[6] = 1/camOrb6e[2];
        shdMtx[7] = 1/camOrb6e[3];
        shdMtx[8] = orbNPW6;
        shdMtx[9] = Math.pow(2, boL6[2].value*1);

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        if(textMode != 2)
        {  textMode  = 2;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex2);
        }
        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, orbNPW6, orbNPW6, gl.RGBA, gl.FLOAT, orbD6);

        //draw orbs
        gl.useProgram(shaderP6e);
        gl.uniform1i(shdTex6e, 0);
        gl.uniformMatrix4fv(shdMtx6e, false, shdMtx);
        gl.vertexAttribPointer(shdVtx6e, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx6e);
        gl.drawArrays(gl.TRIANGLES, 0, orbN6*3);

        cntx6e.drawImage(cnvs0, 0, 0);
    }
    function render6fGl()
    {
        let pxrt = window.devicePixelRatio;
        let rect = cnvs6f.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs6f.width = xrz;
        cnvs6f.height = yrz;

        camOrb6f[3] = xrz/yrz;
        
        //update input data
        shdMtx[0] = xrz;
        shdMtx[1] = yrz;
        //shdMtx[2] = inputX2;
        //shdMtx[3] = yrz-inputY2;
        //update camera data
        shdMtx[4] =   camOrb6f[0];
        shdMtx[5] =   camOrb6f[1];
        shdMtx[6] = 1/camOrb6f[2];
        shdMtx[7] = 1/camOrb6f[3];
        shdMtx[8] = orbNPW6;
        shdMtx[9] = Math.pow(2,boL6[2].value*1);

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        if(textMode != 2)
        {  textMode  = 2;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex2);
        }
        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, orbNPW6, orbNPW6, gl.RGBA, gl.FLOAT, orbD6);

        //draw orbs
        gl.useProgram(shaderP6f);
        gl.uniform1i(shdTex6f, 0);
        gl.uniformMatrix4fv(shdMtx6f, false, shdMtx);
        gl.vertexAttribPointer(shdVtx6f, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx6f);
        gl.drawArrays(gl.TRIANGLES, 0, orbN6*3);

        cntx6f.drawImage(cnvs0, 0, 0);
    }
    function render6gGl()
    {
        let pxrt = window.devicePixelRatio;
        let rect = cnvs6g.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs6g.width = xrz;
        cnvs6g.height = yrz;

        var n  = boL6[8].value|0;
        var n2 = 1<<n;
        shdMtx[0] = yrz/xrz;
        shdMtx[1] = 1;
        shdMtx[2] = n;
        shdMtx[3] = boL6[9].value*1;

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clear(gl.COLOR_BUFFER_BIT);

        gl.useProgram(shaderP6g);
        gl.uniformMatrix4fv(shdMtx6g, false, shdMtx);
        gl.vertexAttribPointer(shdVtx6g, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx6g);
        gl.drawArrays(gl.TRIANGLES, 0, (n2*(n+1))*3);

        cntx6g.drawImage(cnvs0, 0, 0);
    }
    function inp6(e)
    {
        let rect = e.target.getBoundingClientRect();
        let xrz = rect.width;
        let yrz = rect.height;

        let x = (e.clientX-rect.left)   /xrz;
        let y = (e.clientY-rect.top)    /yrz;   y = 1-y;

        let id = e.target.idi;
        if(id == 0)
        {
            inpnAct(x,y, 4,3, 1,2, 2,1, .25,.00, inp6a,0);
            inpnAct(x,y, 4,6, 3,1, 1,5, .00,.20, inp6a,1);
            inpnAct(x,y, 4,3, 1,0, 2,2, .50,.50, inp6a,0);
            render6aGl();
        }
        if(id == 1)
        {
            inpnAct(x,y,14,4, 5,3, 3,1, 1/3,.00, inp6b,0);
            inpnAct(x,y,14,4, 8,3, 3,1, 1/3,.00, inp6b,1);
            inpnAct(x,y, 7,8, 5,1, 1,5, .00,.20, inp6b,2);
            render6bGl();
        }
        if(id == 2)
        {
            inpnAct(x,y, 6,6, 1,5, 2,1, .25,.00, inp6c,0);
            inpnAct(x,y, 6,6, 3,5, 2,1, .25,.00, inp6c,1);
            inpnAct(x,y, 6,6, 1,3, 2,2, .50,.50, inp6c,0);
            inpnAct(x,y, 6,6, 3,3, 2,2, .50,.50, inp6c,1);
            render6cGl();
        }
    }
    function inpnAct(x,y, rx,ry, px,py, ax,ay, sx,sy, l,n)
    {
        x = (x*rx-px)/ax;
        y = (y*ry-py)/ay;

        if( x <  0 || y <  0 ||
            x >= 1 || y >= 1 ){return;}

        x -= sx;
        y -= sy;

        if(sx!=0 && sy!=0)//circle
        {
            l[n] = Math.atan2(x,y)*.5/PI + .5;
        }
        else if(sx!=0)//horiz bar
        {
            x /= 1-sx*2;
            if(x<0) x=0;
            if(x>1) x=1;
            l[n] = x;
        }
        else if(sy!=0)//verti bar
        {
            y /= 1-sy*2;
            if(y<0) y=0;
            if(y>1) y=1;
            l[n] = 1-y;
        }
    }

    var boL7 = new Array(8);
    var orbD7a = new Float32Array(8*4);
    var cnvs7a = null; var cnvs7b = null; var cnvs7c = null; var cnvs7d = null;
    var cntx7a = null; var cntx7b = null; var cntx7c = null; var cntx7d = null;
    var orbN7a = 1;
    var grab7 = -9; //==-9 grabbed nothing
                    //==-2 grabbed Jont
                    //==-1 grabbed background
                    //>= 0 grabbed orb
    var inputO7 = 0;  //1=tapIn  2=fastTapOut 3=tapOut
    var inputT7 = 0;
    var inputX7  = 0;  var inputY7  = 0;
    var inputXd7 = 0;  var inputYd7 = 0;
    var touchID7 = -1;
    var inputDo7 = null;
    var touchStart7 = null;
    var touchEnd7 = null;
    var touchMove7 = null;
    var mouseDown7 = null;
    var mouseUp7 = null;
    var mouseMove7 = null;
    var stepCh7 = null;

    var orbN7 = 0;
    var orbNPW7 = 512;// > sqrt(256*256*4)
    var orbNMAX7 = orbNPW7*orbNPW7;
    var orbD7 = new Float32Array(orbNMAX7*4);//2D positions list
    var orbD7c= new Float32Array(256*256*2);//2D positions list
    var camOrb7c = new Float32Array([0,0,40,1]);//XY position, Z zoom, W/H screen ratio
    var camOrb7d = new Float32Array([0,0,40,1]);//XY position, Z zoom, W/H screen ratio
    var upTblc7 = -1;
    var boL7dv0 = true; //last changed
    var boL7dv1 = 0;    //detect if boL7[7] or boL7[8] value changed
    var boL7dv2 = 0;    //detect if boL7[7] or boL7[8] value changed
    function interface7()
    {
        let fnz = "24px";
        let buI = null;
        let dv1 = null;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = "70px";
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "2D FOURIER TRANSFORM";
        document.body.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "2D wave = e<sup>i*&#120587;*2*(x+y)</sup>                         \n"+
                        "2D wave = cos(&#120587;*2*(x+y)) + sin(&#120587;*2*(x+y)) * i\n"+
                        "the \"x\" represents horizontal dimension\n"+
                        "the \"y\" represents vertical   dimension\n"+
                        "lets visualize a 2D wave that is transformed into discrete steps \n"+
                        "the top    row represents cos(&#120587;*2*(x+y))\n"+
                        "the bottom row represents sin(&#120587;*2*(x+y))";
        document.body.appendChild(buI);

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "1000px";    
        dv1.style.height = "500px";
        //dv1.style.marginTop = "20px";
        //dv1.style.marginBottom = "20px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs7a = document.createElement("canvas");
        cnvs7a.style.position = "absolute";
        cnvs7a.style.border = "0px";
        cnvs7a.style.margin = "0px";
        cnvs7a.style.width = "1000px"; 
        cnvs7a.style.height = "500px";
        dv1.appendChild(cnvs7a);
        cntx7a = cnvs7a.getContext("2d");

                orbD7a[0] = .22;
                orbD7a[1] = .22;
                inputDo7 = function(x, y, type, rect)
                {
                    x = x - rect.left;
                    y = y - rect.top;
                    x = (x/rect.width * 4 - .0)*1.1-.05;
                    y = (y/rect.height* 2 - .5)*1.1-.05;

                    if(type == 0)
                    {
                        if(performance.now()-inputT7 < 200)
                        {
                            inputO7 = 2;
                        }
                        else{inputO7 = 3;}
                    }
                    if(type == 1)
                    {
                        inputT7 = performance.now();
                        inputO7 = 1;
                        inputXd7 = 0;
                        inputYd7 = 0;
                    }
                    if(type == 2)
                    {
                        inputXd7 += x-inputX7;
                        inputYd7 += y-inputY7;
                    }
                    inputX7 = x;
                    inputY7 = y;

                    if(inputO7 != 0)
                    {
                        let a = -1;
                        for(let i = 0; i < orbN7a; ++i)//find orb
                        {
                            let l1 = orbD7a[i*4+0] - x;
                            let l2 = orbD7a[i*4+1] - y;
                            if(l1*l1 + l2*l2 < .05*.05){a = i;}
                        }

                        let b = inputO7; inputO7 = 0;
                        if(a >= 0)//ball
                        {
                            if(b == 1)
                            {
                                grab7 = a;
                            }
                            if(b == 2)//delete from orbs position
                            {
                                if(orbN7a > 1)
                                {
                                    --orbN7a;
                                    for(let i = a; i < orbN7a; ++i)
                                    {
                                        let a2 = i*4;
                                        let b2 = a2+4;
                                        orbD7a[a2+0] = orbD7a[b2+0];
                                        orbD7a[a2+1] = orbD7a[b2+1];
                                    }
                                }
                                grab7 = -9;
                            }
                        }
                        else//background
                        {
                            if(b == 1)
                            {
                                grab7 = -1;
                            }
                            if(b == 2)
                            {
                                if(orbN7a < 8 && x>0 && x<1 
                                             && y>0 && y<1)
                                {
                                    orbD7a[orbN7a*4+0] = x;
                                    orbD7a[orbN7a*4+1] = y;
                                    ++orbN7a;
                                }
                                grab7 = -9;
                            }
                        }
                        if(b == 3)
                        {
                            grab7 = -9;
                        }
                    }
                    if(inputXd7 != 0 || inputYd7 != 0)
                    {
                        if(grab7 >= 0)
                        {
                            orbD7a[grab7*4+0] += inputXd7;      if(orbD7a[grab7*4+0] < 0){orbD7a[grab7*4+0] = 0;}   if(orbD7a[grab7*4+0] > 1){orbD7a[grab7*4+0] = 1;}
                            orbD7a[grab7*4+1] += inputYd7;      if(orbD7a[grab7*4+1] < 0){orbD7a[grab7*4+1] = 0;}   if(orbD7a[grab7*4+1] > 1){orbD7a[grab7*4+1] = 1;}
                        }
                        inputXd7 = 0;
                        inputYd7 = 0;
                    }
                    requestAnimationFrame(render7aGl);
                }
                touchStart7 = function(e)
                {
                    if(touchID7 != -1){return;}
                    touchID7 = e.changedTouches[0].identifier;
                    inputDo7(   e.changedTouches[0].clientX, 
                                e.changedTouches[0].clientY,
                                1, e.target.getBoundingClientRect());
                };
                touchEnd7 = function(e)
                {
                    let rect = e.target.getBoundingClientRect();
                    let list = e.changedTouches;
                    for (let i = 0; i < list.length; ++i)
                    {
                        if(touchID7 == list[i].identifier)
                        {
                            touchID7 = -1;
                            inputDo7(   list[i].clientX, 
                                        list[i].clientY,
                                        0, e.target.getBoundingClientRect());
                            break;
                        }
                    }
                };
                touchMove7 = function(e)
                {
                    let rect = e.target.getBoundingClientRect();
                    let list = e.changedTouches;
                    for (let i = 0; i < list.length; ++i)
                    {
                        if(touchID7 == list[i].identifier)
                        {
                            inputDo7(   list[i].clientX, 
                                        list[i].clientY,
                                        2, e.target.getBoundingClientRect());
                        }
                    }
                };
                mouseDown7 = function(e)
                {
                    let rect = e.target.getBoundingClientRect();
                    inputDo7(   e.clientX, 
                                e.clientY,
                                1, e.target.getBoundingClientRect());
                };
                mouseUp7 = function(e)
                {
                    let rect = e.target.getBoundingClientRect();
                    inputDo7(   e.clientX, 
                                e.clientY,
                                0, e.target.getBoundingClientRect());
                };
                mouseMove7 = function(e)
                {
                    let rect = e.target.getBoundingClientRect();
                    inputDo7(   e.clientX, 
                                e.clientY,
                                2, e.target.getBoundingClientRect());
                };
                cnvs7a.addEventListener("touchstart",  touchStart7,  true);
                cnvs7a.addEventListener("touchend",    touchEnd7,    true);
                cnvs7a.addEventListener("touchcancel", touchEnd7,    true);
                cnvs7a.addEventListener("touchmove",   touchMove7,   true);
                cnvs7a.addEventListener("mousedown",   mouseDown7,   true);
                cnvs7a.addEventListener("mouseup",     mouseUp7,     true);
                cnvs7a.addEventListener("mouseout",    mouseUp7,     true);
                cnvs7a.addEventListener("mouseleave",  mouseUp7,     true);
                cnvs7a.addEventListener("mousemove",   mouseMove7,   true);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "-1%";
            buI.style.top       = "16%";
            buI.style.fontSize  = "12px";
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "you can |move|add|delete| a point\n"+
                            "each point adds a 2D wave to the image";
            dv1.appendChild(buI);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "6%";
            buI.style.top       = "70%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "steps = 6";
            dv1.appendChild(buI);
            boL7[0] = buI;

            stepCh7 = function(){
                boL7[0].innerHTML = "steps = "+boL7[1].value;
                render7aGl();
                //render7bGl();
            };

            buI = document.createElement("input");
            buI.style.position = "absolute";
            buI.style.left  = "0%";
            buI.style.top   = "80%";
            buI.style.width = "24%";
            buI.type = "range";
            buI.min =   2;
            buI.max =   32;
            buI.value = 6;
            buI.step =  1;
            buI.oninput = stepCh7;
            dv1.appendChild(buI);
            boL7[1] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px 0px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "the 2D waves with red border are shown below too                           \n"+
                        "the 2D waves with red border happen when flooring the white ball's position\n"+
                        "lets show all the 2D waves used in this fourier transform";
        document.body.appendChild(buI);

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "600px";    
        dv1.style.height = "600px";
        //dv1.style.marginTop = "20px";
        //dv1.style.marginBottom = "20px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs7b = document.createElement("canvas");
        cnvs7b.style.position = "absolute";
        cnvs7b.style.border = "0px";
        cnvs7b.style.margin = "0px";
        cnvs7b.style.width = "600px"; 
        cnvs7b.style.height = "600px";
        dv1.appendChild(cnvs7b);
        cntx7b = cnvs7b.getContext("2d");

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "-53%";
            buI.style.top       = "18%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "cos(&#120587;*2*(i*x+j*y)/steps)";
            dv1.appendChild(buI);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "100%";
            buI.style.top       = "18%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "sin(&#120587;*2*(i*x+j*y)/steps)";
            dv1.appendChild(buI);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "-41%";
            buI.style.top       = "68%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "e<sup>i*&#120587;*2*(i*x+j*y)/steps</sup>";
            dv1.appendChild(buI);

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "100%";
            buI.style.top       = "68%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "2D samples";
            dv1.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px 0px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "[i,j] is the position of each 2D wave in the array of waves\n"+
                        "each 2D wave will get multiplied with the 2D samples\n"+
                        "control the multiplication as a transition";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "1200px";
        buI.type = "range";
        buI.min =   0;
        buI.max =   1;
        buI.value = 0;
        buI.step =  .0001;
        buI.oninput = render7bGl;
        document.body.appendChild(buI);
        boL7[2] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px 0px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "lets visualize the special case of power of two\n"+
                        "steps = 2<sup>2</sup> = 4";
        document.body.appendChild(buI);
        boL7[3] = buI;

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "180px";
        buI.type = "range";
        buI.min =   1;
        buI.max =   4;
        buI.value = 2;
        buI.step =  1;
        buI.oninput = ft2D7;
        document.body.appendChild(buI);
        boL7[4] = buI;

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "600px";    
        dv1.style.height = "600px";
        //dv1.style.marginTop = "20px";
        //dv1.style.marginBottom = "20px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs7c = document.createElement("canvas");
        cnvs7c.style.position = "absolute";
        cnvs7c.style.border = "0px";
        cnvs7c.style.margin = "0px";
        cnvs7c.style.width = "600px";
        cnvs7c.style.height = "600px";
        dv1.appendChild(cnvs7c);
        cntx7c = cnvs7c.getContext("2d");

            buI = document.createElement("pre");
            buI.style.fontFamily = "inherit";
            buI.style.position = "absolute";
            buI.style.left      = "105%";
            buI.style.top       = "41%";
            buI.style.fontSize  = fnz;
            buI.style.display = "block";
            buI.style.textAlign = "center";
            buI.innerHTML = "hide squ|cir";
            dv1.appendChild(buI);

            buI = document.createElement("input");
            buI.style.position = "absolute";
            buI.style.display = "block";
            buI.style.left      = "110%";
            buI.style.top       = "51%";
            buI.style.width = "100px";
            buI.type = "range";
            buI.min =   0;
            buI.max =   2;
            buI.value = 1;
            buI.step =  1;
            buI.oninput = ft2D7c;
            dv1.appendChild(buI);
            boL7[5] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px 0px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "now deinterlace it";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "1200px";
        buI.type = "range";
        buI.min =   0;
        buI.max =   1;
        buI.value = 0;
        buI.step =  .0001;
        buI.oninput = ft2D7c;
        document.body.appendChild(buI);
        boL7[6] = buI;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px 0px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "one optimal way to generate it";
        document.body.appendChild(buI);

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "1200px";
        buI.type = "range";
        buI.min =   0;
        buI.max =   1;
        buI.value = 0;
        buI.step =  .0001;
        buI.oninput = ft2D7d;
        document.body.appendChild(buI);
        boL7[7] = buI;

        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "1200px";
        buI.type = "range";
        buI.min =   0;
        buI.max =   1;
        buI.value = 0;
        buI.step =  .0001;
        buI.oninput = ft2D7d;
        document.body.appendChild(buI);
        boL7[8] = buI;

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "1230px";    
        dv1.style.height = "700px";
        //dv1.style.marginTop = "20px";
        //dv1.style.marginBottom = "20px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);

        cnvs7d = document.createElement("canvas");
        cnvs7d.style.position = "absolute";
        cnvs7d.style.border = "0px";
        cnvs7d.style.margin = "0px";
        cnvs7d.style.width = "1230px";
        cnvs7d.style.height = "700px";
        dv1.appendChild(cnvs7d);
        cntx7d = cnvs7d.getContext("2d");

        //buI = document.createElement("pre");
        //buI.style.fontFamily = "inherit";
        //buI.style.fontSize = fnz;
        //buI.style.margin = "0px 0px 20px 0px";
        //buI.style.textAlign = "center";
        //buI.innerHTML = "the 1st slider shows how the circles are generated                \n"+
        //                "the 2nd slider shows how the 2D samples are mixed with the circles";
        //document.body.appendChild(buI);

        render7aGl();
        //render7bGl();
        ft2D7c();
        ft2D7d();
    }
    function render7aGl()
    {
        let pxrt = 1;//window.devicePixelRatio*2;
        let rect = cnvs7a.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs7a.width = xrz;
        cnvs7a.height = yrz;

        //update input data
        shdMtx[0] = boL7[1].value;    //steps
        shdMtx[1] = orbN7a;           //points
        shdMtx[2] = 1/orbNPW6;        //texture resolution 1/x 

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        if(textMode != 2)
        {  textMode  = 2;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex2);
        }
        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, orbD7a.length/4, 1, gl.RGBA, gl.FLOAT, orbD7a);

        //waves
        gl.useProgram(shaderP7a1);
        gl.uniform1i(shdTex7a1, 0);
        gl.uniformMatrix4fv(shdMtx7a1, false, shdMtx);
        gl.vertexAttribPointer(shdVtx7a1, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx7a1);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        //points
        gl.useProgram(shaderP7a2);
        gl.uniform1i(shdTex7a2, 0);
        gl.uniformMatrix4fv(shdMtx7a2, false, shdMtx);
        gl.vertexAttribPointer(shdVtx7a2, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx7a2);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        cntx7a.drawImage(cnvs0, 0, 0);

        render7bGl();
    }
    function render7bGl()
    {
        let pxrt = window.devicePixelRatio;//*2;
        let rect = cnvs7b.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs7b.width = xrz;
        cnvs7b.height = yrz;

        //update input data
        shdMtx[0] = boL7[1].value;    //steps
        shdMtx[1] = orbN7a;           //points
        shdMtx[2] = 1/orbNPW6;        //texture resolution 1/x 
        shdMtx[3] = boL7[2].value;
        shdMtx[4] = pxrt;

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        if(textMode != 2)
        {  textMode  = 2;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex2);
        }
        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, orbD7a.length/4, 1, gl.RGBA, gl.FLOAT, orbD7a);

        gl.useProgram(shaderP7b);
        gl.uniform1i(shdTex7b, 0);
        gl.uniformMatrix4fv(shdMtx7b, false, shdMtx);
        gl.vertexAttribPointer(shdVtx7b, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx7b);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        cntx7b.drawImage(cnvs0, 0, 0);
    }
    function render7cGl()
    {
        let pxrt = window.devicePixelRatio;
        let rect = cnvs7c.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs7c.width = xrz;
        cnvs7c.height = yrz;

        camOrb7c[3] = xrz/yrz;
        
        //update input data
        shdMtx[0] = xrz;
        shdMtx[1] = yrz;
        shdMtx[2] = pxrt;
        //shdMtx[3] = yrz-inputY2;
        //update camera data
        shdMtx[4] =   camOrb7c[0];
        shdMtx[5] =   camOrb7c[1];
        shdMtx[6] = 1/camOrb7c[2];
        shdMtx[7] = 1/camOrb7c[3];
        shdMtx[8] = orbNPW7;
        shdMtx[9] = Math.pow(2, boL7[4].value*1);
        shdMtx[10] = boL7[5].value;

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        if(textMode != 2)
        {  textMode  = 2;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex2);
        }
        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, orbNPW7, orbNPW7, gl.RGBA, gl.FLOAT, orbD7);

        //draw orbs
        gl.useProgram(shaderP7c);
        gl.uniform1i(shdTex7c, 0);
        gl.uniformMatrix4fv(shdMtx7c, false, shdMtx);
        gl.vertexAttribPointer(shdVtx7c, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx7c);
        gl.drawArrays(gl.TRIANGLES, 0, orbN7*3);

        cntx7c.drawImage(cnvs0, 0, 0);
    }
    function render7dGl()
    {
        let pxrt = window.devicePixelRatio;
        let rect = cnvs7d.getBoundingClientRect();
        let xrz = rect.width *pxrt;
        let yrz = rect.height*pxrt;
        cnvs0.width = xrz;
        cnvs0.height = yrz;
        cnvs7d.width = xrz;
        cnvs7d.height = yrz;

        camOrb7d[3] = xrz/yrz;
        
        //update input data
        shdMtx[0] = 1/orbN7;
        shdMtx[1] = yrz;
        shdMtx[2] = pxrt;
        //shdMtx[3] = yrz-inputY2;
        //update camera data
        shdMtx[4] =   camOrb7d[0];
        shdMtx[5] =   camOrb7d[1];
        shdMtx[6] = 1/camOrb7d[2];
        shdMtx[7] = 1/camOrb7d[3];
        shdMtx[8] = orbNPW7;
        shdMtx[9] = Math.pow(2,boL7[4].value*1);

        gl.viewport(0, 0, xrz, yrz);

        gl.clearColor(.9,.9,.9,1);
        gl.clearDepth(0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        if(textMode != 2)
        {  textMode  = 2;
            gl.activeTexture(gl.TEXTURE0);
            gl.bindTexture(gl.TEXTURE_2D, tex2);
        }
        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, orbNPW7, orbNPW7, gl.RGBA, gl.FLOAT, orbD7);

        gl.enable(gl.BLEND);

        //draw orbs
        gl.useProgram(shaderP7d);
        gl.uniform1i(shdTex7d, 0);
        gl.uniformMatrix4fv(shdMtx7d, false, shdMtx);
        gl.vertexAttribPointer(shdVtx7d, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx7d);
        gl.drawArrays(gl.TRIANGLES, 0, orbN7*3);

        gl.disable(gl.BLEND);

        cntx7d.drawImage(cnvs0, 0, 0);
    }
    function ft2D7()
    {
        let valu = boL7[4].value;
        let l = Math.pow(2,valu);
        boL7[3].innerHTML = "lets visualize the special case\n"+
                            "steps = 2<sup>"+ valu +"</sup> = " + l;
        upTblc7 = -1;
        ft2D7c();
        ft2D7d();
    }
    function ft2D7c()
    {
        let valu = boL7[4].value*1;
        let l = Math.pow(2,valu);
        let aniT = valu-1;
        let ani = boL7[6].value*aniT*2;
        let aniF = Math.floor(ani); 
        let aniX = Math.min(ani     , aniT);
        let aniY = Math.max(ani-aniT,    0);

        let aibo = upTblc7 != aniF;
        if (aibo){ upTblc7 = aniF; }

        let lm = l-1;
        let ll = l*l;
        orbN7 = ll*ll;
        camOrb7c[2] = .5*(ll+(l-1)*.5);

        //interlace X
        let aniD = Math.floor(aniX);
        let aniM = aniX - aniD;
        let a0 = Math.max(Math.max(aniM*1.5-.5,1-aniM*1.5),.4);
        let a1 = Math.min(Math.max((1-aniM)*3-1,0),1)*.5+.5;
        if(aibo)
        {
            for(let i = 0; i < orbN7; ++i)//color1
            {
                let ill = i >> (valu*2);
                let xl  = i   & lm;
                let xll = ill & lm;
                let yl  = (i   >> valu) & lm;
                let yll = (ill >> valu) & lm;
                let agn = (xll*xl  +  yll*yl) / l;
                let al = ((xl * 0x0802 & 0x22110) | (xl * 0x8020 & 0x88440)) * 0x10101 >> (16+8-valu);
                let bl = ((yl * 0x0802 & 0x22110) | (yl * 0x8020 & 0x88440)) * 0x10101 >> (16+8-valu);
                orbD7[i*4+2] = (al & lm) + (bl & lm) * l;   //square color
                orbD7[i*4+3] = agn - Math.floor(agn);       //circle angle
            }
            for(let h = 0; h < aniD; ++h)//color2
            {
                let l0 = l/Math.pow(2,h+0);
                let l1 = l/Math.pow(2,h+1);
                for(let i = 0; i < ll; ++i)
                {
                    let i0 = i*l*l;
                    for(let j = 0; j < l*l; ++j)//make copy
                    {
                        orbD7c[j*2+0] = orbD7[(i0 + j)*4+2];
                        orbD7c[j*2+1] = orbD7[(i0 + j)*4+3];
                    }
                    for(let j = 0; j < l; ++j)//move from copy
                    {
                        let j0 = j*l;
                        for(let k = 0; k < l; ++k)
                        {
                            let duv = Math.floor(k/l0);
                            let mud = k - duv*l0;
                            let r = 0;
                            if(mud <  l1) r = mud*2;
                            if(mud >= l1) r = (mud-l1)*2+1;
                            orbD7[(i0+j0+k)*4+2] = orbD7c[(j0+r+l0*duv)*2+0];
                            orbD7[(i0+j0+k)*4+3] = orbD7c[(j0+r+l0*duv)*2+1];
                        }
                    }
                }
            }
        }
        //sort X
        let dil = l/Math.pow(2,aniD);
        for(let i = 0; i < ll; ++i)
        {
            let i0 = i*l*l;
            let sqr = .5*2;
            for(let j = 0; j < l; ++j)
            {
                let j0 = j*l;
                for(let k = 0; k < l; ++k)
                {
                    let duv = Math.floor(k/dil);
                    let mud = k - duv*dil;
                    let a = 0;
                    let b = 0;
                    if((k&1) == 0)  {a = j*a0;              b = mud*a1;}
                    else            {a = l-1-(l-1-j)*a0;    b = dil-1-(dil-1-mud)*a1;}
                    orbD7[(i0+j0+k)*4+0] = (dil*duv+b)*sqr;
                    orbD7[(i0+j0+k)*4+1] = -a*sqr;
                }
            }
        }
        //interlace Y
        aniD = Math.floor(aniY);
        aniM = aniY - aniD;
        a0 = Math.max(Math.max(aniM*1.5-.5,1-aniM*1.5),.4);
        a1 = Math.min(Math.max((1-aniM)*3-1,0),1)*.5+.5;
        if(aibo)
        {
            for(let h = 0; h < aniD; ++h)//color2
            {
                let l0 = l/Math.pow(2,h+0);
                let l1 = l/Math.pow(2,h+1);
                for(let i = 0; i < ll; ++i)
                {
                    let i0 = i*l*l;
                    for(let j = 0; j < l*l; ++j)//make copy
                    {
                        orbD7c[j*2+0] = orbD7[(i0 + j)*4+2];
                        orbD7c[j*2+1] = orbD7[(i0 + j)*4+3];
                    }
                    for(let j = 0; j < l; ++j)//move from copy
                    {
                        let j0 = j*l;
                        for(let k = 0; k < l; ++k)
                        {
                            let duv = Math.floor(j/l0);
                            let mud = j - duv*l0;
                            let r = 0;
                            if(mud <  l1) r = mud*2;
                            if(mud >= l1) r = (mud-l1)*2+1;
                            orbD7[(i0+j0+k)*4+2] = orbD7c[((r+l0*duv)*l+k)*2+0];
                            orbD7[(i0+j0+k)*4+3] = orbD7c[((r+l0*duv)*l+k)*2+1];
                        }
                    }
                }
            }
        }
        //sort Y
        if(aniY != 0)
        {
            let dil = l/Math.pow(2,aniD);
            for(let i = 0; i < ll; ++i)
            {
                let i0 = i*l*l;
                let sqr = .5*2;
                for(let j = 0; j < l; ++j)
                {
                    let j0 = j*l;
                    for(let k = 0; k < l; ++k)
                    {
                        let duv = Math.floor(j/dil);
                        let mud = j - duv*dil;
                        let a = 0;
                        let b = 0;
                        if((j&1) == 0)  {a = k*a0;              b = mud*a1;}
                        else            {a = l-1-(l-1-k)*a0;    b = dil-1-(dil-1-mud)*a1;}
                        orbD7[(i0+j0+k)*4+0] = a*sqr;
                        orbD7[(i0+j0+k)*4+1] = -(dil*duv+b)*sqr;
                    }
                }
            }
        }
        //adjust
        var w = 0;
        let lmdl = .5*(l*l+(l-1)*.5);
        for(let i = 0; i < ll; ++i)
        {
            let mcx = +.5+(i &    lm)*(l+.5) -lmdl;
            let mcy = -.5-(i >> valu)*(l+.5) +lmdl;
            for(let j = 0; j < l; ++j)
            {
                for(let k = 0; k < l; ++k)
                {
                    orbD7[w] += mcx;     ++w;
                    orbD7[w] += mcy;     ++w; ++w; ++w;
                }
            }
        }
        render7cGl();
    }
    function ft2D7d()
    {
        let valu = boL7[4].value*1;
        let l = 1 << valu;
        let ani = boL7[8].value*1; let fa = ani == 0 || ani == 1;
            ani*= valu*l*l;

        let anu = boL7[7].value*1; let nn = anu != 1;
            anu = anu*3*valu;       //circle generation

        if(boL7dv1 != ani) boL7dv0 =  true; boL7dv1 = ani;
        if(boL7dv2 != anu) boL7dv0 = false; boL7dv2 = anu;
        
        let lmx = l + (l-1)*.5 + 1;
        let lmy = 0;
        for(let i = 0; i < valu; ++i)//calculate total drawing width
        {
            let l2 = 2<<i;
            lmx += l*l2 + (l-1)*.5;
        }
        lmx+= valu-1;
        lmx = lmx*.5;

        let mx = .5;
        lmy = (l+(l-1)*.5)*.5 - .5;
        let w = 0;
        for(let y1 = 0; y1 < l; ++y1)//time domain
        {
            for(let x1 = 0; x1 < l; ++x1)
            {
                let ax = x1 & 1;
                let ay = y1 & 1;
                let aa = ((x1>>1)<<(1<<1))  +  (y1>>1)*(l<<1)    +     //  (ax&1)  +  ((ay&1)<<1)    +
                                                                     ((ax>>1)<<2)  +  ((ay>>1)<<(1+1))  ;
                    aa = ani-aa;
                    aa = (aa>0 && aa<4)*.5+.5; if(fa) aa = 1;

                orbD7[w] = +x1*1.5 + mx - lmx;          ++w;
                orbD7[w] = -y1*1.5 + lmy;               ++w;
                orbD7[w] = x1 + y1 * l;                 ++w; //square color
                orbD7[w] = -1;                          ++w; //circle angle
                orbD7[w] = aa;                          ++w; //transparency
                orbD7[w] = 0;                           ++w; //depth
                orbD7[w] = 0;                           ++w;
                orbD7[w] = 0;                           ++w;
            }
        }
        let mx2 = mx;
        mx += l+(l-1)*.5 + 1;

        for(let i = 0; i < valu && boL7dv0; ++i)//tables
        {
            let i1 = i+1;   let li = 2<<i1; let li1 = li-1; let i2 = i+2;
            let l2 = 2<<i;  let lu = 1<<i1; let lu1 = lu-1;
            let l21 = l2-1; 
            let l22 = 1<<i; let l22o = ~l22;
            let l221 = l22-1;
            let lmy2 = lmy;
            let ill = i*l*l;
            lmy = .5*(l*l2+(l-1)*.5) - .5;
            for(let y1 = 0; y1 < l; ++y1)
            {
                for(let x1 = 0; x1 < l; ++x1)
                {
                    let ax = x1 & l21;  ax = (ax>>i) + ((ax&l221)<<1);
                    let ay = y1 & l21;  ay = (ay>>i) + ((ay&l221)<<1);
                    let aa = ((x1>>i1)<<(i1<<1))  +  (y1>>i1)*(l<<i1)    +     //  (ax&1)  +  ((ay&1)<<1)    +
                                                                             ((ax>>1)<<2)  +  ((ay>>1)<<(i1+1))  ;
                    let a1 = ani-aa-ill;

                    let ani1 = Math.min(a1 -  ((ax&1)  +  ((ay&1)<<1)),1);
                    let ani2 = 1-ani1;

                        ax = x1 & li1;  ax = (ax>>i1) + ((ax&lu1)<<1);
                        ay = y1 & li1;  ay = (ay>>i1) + ((ay&lu1)<<1);
                        aa = ((x1>>i2)<<(i2<<1))  +  (y1>>i2)*(l<<i2)    +   ((ax>>1)<<2)  +  ((ay>>1)<<(i2+1))  ;
                    let a2 = ani-aa-ill-l*l;

                    let tt = ((a1>0 && a1<4) ||         //enhance write places
                              (a2>0 && a2<4))*.5+.5;    //enhance read places
                    if(fa) tt = 1;

                    let w2 = w+l2*l2*8; //used to fix depth squr behind crcl
                    let w3 = w2;    

                    for(let y2 = 0; y2 < l2; ++y2)
                    {
                        for(let x2 = 0; x2 < l2; ++x2)
                        {
                            let ang2 = (x2>>i)*((x1&l21)/l2) +
                                       (y2>>i)*((y1&l21)/l2);
                            let xl = ((x2 * 0x0802 & 0x22110) | (x2 * 0x8020 & 0x88440)) * 0x10101 >> (16+8-(i+1));
                            let yl = ((y2 * 0x0802 & 0x22110) | (y2 * 0x8020 & 0x88440)) * 0x10101 >> (16+8-(i+1));
                            let ang = ((x1 & l21)*xl  +  (y1 & l21)*yl) / l2;
                                ang -= ang2*ani2;
                                ang = ang - Math.floor(ang);
                            
                            let x3 = +x2 + x1*(l2+.5) + mx - lmx;
                            let y3 = -y2 - y1*(l2+.5) + lmy;

                            let x4 = +(x2 & l221) + ((x1&l22o)+((x2>=l22)<<i))*(l22+.5) + mx2 - lmx;
                            let y4 = -(y2 & l221) - ((y1&l22o)+((y2>=l22)<<i))*(l22+.5) + lmy2;

                            if(ani1>=0)
                            {
                                if(i==0 && ani1!=1) ang = -1;   //hide circle in first wave
                                orbD7[w] = x3*ani1 + x4*ani2;           ++w;
                                orbD7[w] = y3*ani1 + y4*ani2;           ++w;
                                orbD7[w] = (x2 + (x1&(~l21))) + 
                                           (y2 + (y1&(~l21))) * l;      ++w; //square
                                orbD7[w] = ang;                         ++w; //circle
                                orbD7[w] = tt;                          ++w; //transparency
                                orbD7[w] = ani2*.9+.1;                  ++w; //depth
                                orbD7[w] = 0;                           ++w;
                                orbD7[w] = 0;                           ++w;
                            }

                            //if(ani1 != 0 && 
                            //   ani1 != 1 && (x2==0 || x2==l22) && 
                            //                (y2==0 || y2==l22) )
                            if( ani1 != 1 && (x2==0 || x2==l22) && 
                                             (y2==0 || y2==l22) )
                            {
                                let m = Math.max(i-1,0);
                                    m = (1<<m)-.5;  if(i==0) m = 0;
                                orbD7[w2] = x3+m;                       ++w2;
                                orbD7[w2] = y3-m;                       ++w2;
                                orbD7[w2] = -1;                         ++w2; //square
                                orbD7[w2] = ang2 - Math.floor(ang2);    ++w2; //circle
                                orbD7[w2] = 1;                          ++w2; //transparency
                                orbD7[w2] = (i==0 && ani1 != 0 && 
                                                     ani1 != 1)*1;      ++w2; //depth
                                orbD7[w2] = 0;                          ++w2;
                                orbD7[w2] = 0;                          ++w2;
                            }
                        }
                    }
                    while(w3 < w2)//circles are ahead in memory, copy them back
                    {
                        orbD7[w] = orbD7[w3]; ++w; ++w3;
                    }
                }
            }
            mx2 = mx;
            mx += l*l2 + (l-1)*.5 + 1;
        }

        let dol = 1/(valu*l*l*5+l*2*2);
        for(let i = 0; i < valu && !boL7dv0; ++i)//only draw circles
        {
            let l2 = 2<<i;
            let l21 = l2-1; 
            let l22 = 1<<i;
            lmy = .5*(l*l2+(l-1)*.5) - .5;

            let fs1 = anu-i*3-2;    if(fs1<0) fs1 = 0;
                                    if(fs1>1) fs1 = 1;
            let fs2 = .75*(1-fs1);
            let aigX = anu-i*3-0;   if(aigX<0) aigX = 0;
                                    if(aigX>1) aigX = 1;
            let aigY = anu-i*3-1;   if(aigY<0) aigY = 0;
                                    if(aigY>1) aigY = 1;

            let m = Math.max(i-1,0);
                m = (1<<m)-.5;  if(i==0) m = 0;

            for(let y1 = 0; y1 < l; ++y1)
            {
                for(let x1 = 0; x1 < l; ++x1)
                {               
                    for(let x2 = 0; x2 < 2; ++x2)
                    {
                        let ang2 = (l22>>i)*((y1&l21)/l2);
                            ang2-= Math.floor(ang2);

                        let x3 = +m +(x2*l22) + x1*(l2+.5) + mx - lmx;
                        let y3 = -m -(1 *l22) - y1*(l2+.5) + lmy -fs2;

                        if(aigY*l<=y1) continue;

                        orbD7[w] = x3;              ++w;
                        orbD7[w] = y3;              ++w;
                        orbD7[w] = -1;              ++w; //square
                        orbD7[w] = ang2;            ++w; //circle
                        orbD7[w] = 1;               ++w; //transparency
                        orbD7[w] = (w>>3)*dol;      ++w; //depth
                        orbD7[w] = 0;               ++w;
                        orbD7[w] = 0;               ++w;

                        if(y1 == 0 && aigY!=1)
                        {
                            let ang = aigY*l/l2;
                                ang-= Math.floor(ang);
                            orbD7[w] = x3;                  ++w;
                            orbD7[w] = y3-l*(l2+.5)*aigY;   ++w;
                            orbD7[w] = -1;                  ++w; //square
                            orbD7[w] = ang;                 ++w; //circle
                            orbD7[w] = 1;                   ++w; //transparency
                            orbD7[w] = (w>>3)*dol;          ++w; //depth
                            orbD7[w] = 0;                   ++w;
                            orbD7[w] = 0;                   ++w;
                        }
                    }
                    for(let y2 = 0; y2 < 2; ++y2)
                    {
                        let ang2 =  ((1 *l22)>>i)*((x1&l21)/l2) +
                                    ((y2*l22)>>i)*((y1&l21)/l2)*fs1;
                            ang2-= Math.floor(ang2);

                        let x3 = +m +(1 *l22) + x1*(l2+.5) + mx - lmx +fs2;
                        let y3 = -m -(y2*l22) - y1*(l2+.5) + lmy;

                        if(aigX*l<=x1) continue;

                        orbD7[w] = x3;              ++w;
                        orbD7[w] = y3;              ++w;
                        orbD7[w] = -1;              ++w; //square
                        orbD7[w] = ang2;            ++w; //circle
                        orbD7[w] = 1;               ++w; //transparency
                        orbD7[w] = (w>>3)*dol;      ++w; //depth
                        orbD7[w] = 0;               ++w;
                        orbD7[w] = 0;               ++w;

                        if(x1 == 0 && aigX!=1)
                        {
                            let ang = aigX*l/l2;
                                ang-= Math.floor(ang);
                            orbD7[w] = x3+l*(l2+.5)*aigX;    ++w;
                            orbD7[w] = y3;                  ++w;
                            orbD7[w] = -1;                  ++w; //square
                            orbD7[w] = ang;                 ++w; //circle
                            orbD7[w] = 1;                   ++w; //transparency
                            orbD7[w] = (w>>3)*dol;          ++w; //depth
                            orbD7[w] = 0;                   ++w;
                            orbD7[w] = 0;                   ++w;
                        }
                    }
                
                    if(nn) continue;
                    
                    let x3 = +m + x1*(l2+.5) + mx - lmx;
                    let y3 = -m - y1*(l2+.5) + lmy -fs2;

                    orbD7[w] = x3;              ++w;
                    orbD7[w] = y3;              ++w;
                    orbD7[w] = -1;              ++w; //square
                    orbD7[w] = 0;               ++w; //circle
                    orbD7[w] = 1;               ++w; //transparency
                    orbD7[w] = (w>>3)*dol;      ++w; //depth
                    orbD7[w] = 0;               ++w;
                    orbD7[w] = 0;               ++w;
                }
            }
            mx2 = mx;
            mx += l*l2 + (l-1)*.5 + 1;
        }

        upTblc7 = -2;

        orbN7 = w>>3;
        //camOrb7d[2] = lmx;
        camOrb7d[2] = .65*(l*l+(l-1)*.5);
        render7dGl();
    }

    var sQx = null;
    var gainNd = null;
    var scriNd = null;
    var micNd = null;
    var audNd = null;
    var micStrm = null;
    var smplRt = 48000;//sample rate because reading sQx.sampleRate is too slow

    var boL8 = new Array(32);
    var boL8v = new Float32Array(boL8.length);//has boL8.value because reading boL8.value is too slow
    var cnvs8a = null;
    var cnvs8aX = 32;
    var cnvs8aY = 32;
    var cntx8a = null;
    var x1D = 10|0; //2^xfft1D
    var y1D = 10|0;
    var x1DMAX = 18|0;
    var xF8 = 0;//1D FFT in 2D Texture with resolution [xF8,yF8]
    var yF8 = 0;
    var swp8 = null;
    var fB8 = new Array(8);
    var tX8 = new Array(8);
    var pin8 = 0|0;//ping pong text render
    var micRec8 = false;//right now recording microphone
    var frSh8iV = false;//shader  editor visible or hidden
    var frSh8iV2= false;//shader2 editor visible or hidden
    var ry8 = 0|0;//render to which row in final texture

    var snd8    = null; //sound data in GPU format
    var snd8z   = 0;    //size of snd8
    var snd8t   = 0;    //offset to read sound file
    var snd8i   = 0;    //general time at wich sound file starts
    var snd8p   = 0;    //save time where sound was paused
    var snd8m   = 0;    //copy of timMv8.value because reading timMv8.value is too slow 
    var snd8Stp = 1<<9;
    var snd8Bff = null;
    var snd8tx = 0;

    var sndMic = null;//sample data of microphone
    var micStp = 1<<12;
    var micBuf = null;

    var null;//createBufferSource() of file or mic 

    var sondLVL = new Array(64);

    var rndAB8 = false; //if requestAnimationFrame is already activated
    var rndA8  = false; //if do FFT

    var iniAudio;
    var audioStop;
    var micStop;
    var audioPlay;
    var audioPlayStop;

    var iniMic;
    var micSuccess;
    
    var audioFile;
    var getSoundD;
    var chngX21D ;

    var chngX1D;
    var chngX2stp;
    var spwnCode8;
    var chngAB8;
    var dropSound;
    var dropSound2;

    var timMv8;
    var xmlhr;

    var sndGZ     = 1024;//side of 2D texture 1024^2/48000 = 21 seconds of sound
    var sndGZ2    = sndGZ*sndGZ;
    var rndrStps8 = function(){};//function defining rendering steps after clicking
    var vxSh8d    = null;
    var frSh8d    = null;
    var stx8d     = new Float32Array(sndGZ2<<2);//data of texture to convert to sound
    var rndr8d    = false;
    var shs8d     = null;
    var inpX8     = 0;
    var inpY8     = 0;

    function interface8()
    {
        let fnz = "24px";
        let buI = null;
        let dv1 = null;

        textMode = 3;

        iniAudio = function()
        {
            if(sQx != null) return;
            sQx = new AudioContext();

            smplRt = sQx.sampleRate;

            gainNd = sQx.createGain();
            gainNd.gain.value = .5;
            gainNd.connect(sQx.destination);
        }
        audioStop = function()
        {
            if(audNd  != null){audNd.onended = null;  audNd.stop();  audNd.disconnect();  audNd = null;}
          //if(gainNd != null){gainNd.disconnect();    gainNd = null;}
        }
        micStop = function()
        {
            if(!micRec8){return;}
                micRec8 = false;

            boL8[2].innerHTML = "microphone";
            if(micNd   != null){  micNd.disconnect();     micNd = null;}
            if(scriNd  != null){ scriNd.disconnect();    scriNd = null;}
            if(micStrm != null){ micStrm.getTracks().forEach(track => track.stop()); micStrm = null; }
            
            audSN8 = sQx.createBuffer(2, snd8z, smplRt);
            for(var i = 0; i < 2; ++i)
            {
                var d = audSN8.getChannelData(i);
                for (var j = 0; j < snd8z; ++j)
                {
                    d[j] = snd8[(j<<2)+(i<<1)];
                }
            }
        }
        audioPlay = function()
        {
          //x  location in screen where want sound to start
          //   range 0 to 1

          //gainNd = sQx.createGain();
          //gainNd.gain.value = .5;
          //gainNd.connect(sQx.destination);

            audNd = sQx.createBufferSource();
            audNd.buffer  = audSN8;
            audNd.onended = audioStop;
            audNd.connect(gainNd);
            audNd.start(0,(snd8m+(sQx.currentTime*smplRt-snd8i))/smplRt);

            rndRqst8();
        }
        audioPlayStop = function()
        {
            if(audSN8==null){return;}
            if(audNd==null){snd8i = sQx.currentTime*smplRt - (snd8p - snd8m);
                            audioPlay();}
            else           {audioStop();  snd8p = snd8m+(sQx.currentTime*smplRt-snd8i);}
        }
        
        iniMic = function()
        {
            iniAudio();
            if(micRec8){micStop();}
            else       {navigator.mediaDevices.getUserMedia({audio: true, video: false}).then(micSuccess);}
        }
        micSuccess = function(stream)
        {
            boL8[2].innerHTML = "stop mic";

            snd8z = Math.floor(60*smplRt/micStp)*micStp;//close to 1 minutes of mic sound
            if(micBuf==null){micBuf = new Float32Array(snd8z<<2);}
            snd8 = micBuf;
            //snd8tx = 0; continue record where left off

            snd8m = snd8tx;
            timMv8.value = snd8m;
            timMv8.max   = snd8z;
            snd8t = snd8m;
            rndA8 = true;
            rndRqst8();

            micRec8 = true;
            scriNd = sQx.createScriptProcessor(micStp, 2, 2) || sQx.createJavaScriptNode(micStp, 2, 2);
            scriNd.onaudioprocess = function(e)
                                    {
                                        var d0 = e.inputBuffer.getChannelData(0);
                                        var d1 = e.inputBuffer.getChannelData(1);
                                        var w = snd8tx<<2;
                                        for(var j = 0; j < micStp; ++j)
                                        {
                                            snd8[w] = d0[j];  ++w;
                                            snd8[w] = 0;      ++w;
                                            snd8[w] = d1[j];  ++w;
                                            snd8[w] = 0;      ++w;
                                        }
                                        snd8tx += micStp;  if(snd8tx >= snd8z){snd8tx = 0;}//rewind
                                        
                                        //var ch = Math.min(e.inputBuffer.numberOfChannels, 2);
                                        //for(var i = 0; i < ch; ++i)
                                        //{
                                        //    var d1 = e.inputBuffer.getChannelData(i);
                                        //    var w = ((snd8tx<<2) + (i<<1))|0;
                                        //    for(var j = 0|0; j < micStp; j=(j+1)|0)
                                        //    {
                                        //        snd8[w] = d1[j];  w = (w+1)|0;
                                        //        snd8[w] = 0;      w = (w+3)|0;
                                        //    }
                                        //}
                                        //snd8tx += micStp;
                                        //if(snd8tx >= snd8z-micStp)//resize buffer
                                        //{
                                        //    var z = snd8z<<2;
                                        //            snd8z += 1<<Math.ceil(Math.log2(60*smplRt));
                                        //    var b = new Float32Array(snd8z<<2);
                                        //    for(var i = 0; i < z; ++i)
                                        //    {
                                        //        b[i] = snd8[i];
                                        //    }
                                        //    snd8   = b;
                                        //    micBuf = b;
                                        //    timMv8.max = snd8z;
                                        //}
                                    };
            scriNd.connect(sQx.destination);
            
            micStrm = stream;
            micNd = sQx.createMediaStreamSource(stream);
            micNd.connect(scriNd);
        }
        
        audioFile = function(e)
        {
            iniAudio();
            e.target.files[0].arrayBuffer()
            .then(arrBff    => sQx.decodeAudioData(arrBff))
            .then(audioBff  => getSoundD(audioBff));
        }
        getSoundD = function(audioBff)
        {
            micStop();
            audioStop();

            snd8z  = audioBff.length|0;
            var dR = audioBff.getChannelData(0);
            var dL = null;
            if(audioBff.numberOfChannels >= 2){dL = audioBff.getChannelData(1);}
            else                              {dL = new Float32Array(snd8z);}
            snd8  = new Float32Array(snd8z<<2);
            var w = 0;
            for(var i = 0|0; i < snd8z; i=(i+1)|0)
            {
                snd8[w] = dR[i];   ++w;
                snd8[w] = 0;       ++w;
                snd8[w] = dL[i];   ++w;
                snd8[w] = 0;       ++w;
            }
            audSN8 = sQx.createBuffer(2, snd8z, smplRt);
            var cd0 = audSN8.getChannelData(0);  for(var i = 0; i < snd8z; i++){cd0[i] = dR[i];}
            var cd1 = audSN8.getChannelData(1);  for(var i = 0; i < snd8z; i++){cd1[i] = dL[i];}
            
            snd8m = 0;
            timMv8.value = snd8m;
            timMv8.max   = snd8z;
            snd8t = snd8m;  ry8 = 0;
            rndA8 = true;
            rndRqst8();

            snd8i = sQx.currentTime*smplRt;
            audioPlay();
        }

        tX8[0] = null;
        chngX21D = function()
        {
            x1D = boL8[5].value|0;
            chngX2stp();
            var xl = 1<<x1D;
          //var yl = 1<<y1D;

            var my = 0;
            if(x1D>14){
                xF8 = 1<<14;
                yF8 = 1<<(x1D-14);      my = 14;
                if(x1D==18){y1D = 9|0;}
                else       {y1D =10|0;}
            }else{
                xF8 = xl;
                yF8 = 1;                my = x1D;
            }
            var mx = (xF8-1)|0;

            boL8[6].innerHTML = "z = "+ xl;

            var einvei = (xl<<y1D)<<2;

            swp8 = new Float32Array(xl<<2);
 
            var w = 0|0;
            for(let i = 0|0; i < xl; i=(i+1)|0)
            {
                let j = i|0;
                let a = 0|0;
                let b = x1D;
                while(j != 0)//reverse bits in "i"
                {
                    b = (b-1)|0;
                    a = a | ((j&1)<<b); 
                    j = j>>1;
                }
                swp8[w] = ((a& mx)+.5)/xF8;      ++w;
                swp8[w] = ((a>>my)+.5)/yF8;      ++w;
                swp8[w] = i;                     ++w;
                swp8[w] = a;                     ++w;
            }
            if(tX8[0] != null)
            {
                gl.deleteTexture(tX8[0]);
                gl.deleteTexture(tX8[1]);
                gl.deleteTexture(tX8[2]);
                gl.deleteTexture(tX8[3]);
                gl.deleteFramebuffer(fB8[0]);
                gl.deleteFramebuffer(fB8[1]);
              //gl.deleteFramebuffer(fB8[2]);
                gl.deleteFramebuffer(fB8[3]);
            }
            tX8[0] = texCreator(gl.RGBA, xF8, yF8     , gl.FLOAT, gl.NEAREST, null, gl.TEXTURE0);
            tX8[1] = texCreator(gl.RGBA, xF8, yF8     , gl.FLOAT, gl.NEAREST, null, gl.TEXTURE1);
            tX8[2] = texCreator(gl.RGBA, xF8, yF8     , gl.FLOAT, gl.NEAREST, swp8, gl.TEXTURE2);
            tX8[3] = texCreator(gl.RGBA, xF8, yF8<<y1D, gl.FLOAT, gl.NEAREST, null, gl.TEXTURE3);   gl.activeTexture(gl.TEXTURE0+0);
            fB8[0] = frameBuffCreator(tX8[0]);
            fB8[1] = frameBuffCreator(tX8[1]);
          //fB8[2] = frameBuffCreator(tX8[2]);
            fB8[3] = frameBuffCreator(tX8[3]);

            gl.bindFramebuffer(gl.FRAMEBUFFER, null);

            if(snd8==null||micRec8){return;}
            snd8t = snd8m; ry8 = 0;
            rndA8 = true;
            rndRqst8();
        }
        
        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px 0px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "that optimal way to generate the table is named the FAST FOURIER TRANSFORM\n"+
                        "it is perfect for the GPU\n"+
                        "lets transform sound samples into the frequency domain using the GPU";
        document.body.appendChild(buI);

        buI = document.createElement("table");
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        document.body.appendChild(buI);

            let tr = document.createElement("tr");
            buI.appendChild(tr);

            let th = null;

            th = document.createElement("th");
            tr.appendChild(th);
            //buI = document.createElement("button");
            ////buI.style.display = "block";
            //buI.style.fontFamily = "inherit";
          ////buI.style.margin = "0px 5px";
          ////buI.style.width = "50px";
            //buI.onclick = audioPlayStop;
            //buI.innerHTML = "&#9199;&#65039;";
            //th.appendChild(buI);
            //boL8[0] = buI;

            th = document.createElement("th");
            th.style.width = "200px";
            tr.appendChild(th);
            buI = document.createElement("input");
            //buI.style.display = "block";
            buI.style.fontFamily = "inherit";
            buI.style.margin = "0px 5px";
            buI.style.width = "200px";
            buI.type = "file";
            buI.onchange = audioFile;
            //buI.innerHTML = "sound file";
            th.appendChild(buI);
            boL8[1] = buI;

            //th = document.createElement("th");
            //tr.appendChild(th);
            buI = document.createElement("button");
            //buI.style.display = "block";
            buI.style.fontFamily = "inherit";
            buI.style.margin = "0px 5px";
            buI.style.width = "200px";
            buI.onclick = iniMic;
            buI.innerHTML = "microphone";
            th.appendChild(buI);
            boL8[2] = buI;

            chngX1D = function()
            {
                let a = boL8[3].value*1;
                boL8[10].style.height = a+"px";
                cnvs8a.style.height = a+"px";
                //boL8[4].innerHTML = a.toString();

                var pxrt = window.devicePixelRatio;
                var rect = cnvs8a.getBoundingClientRect();
                cnvs8aX = rect.width *pxrt;
                cnvs8aY = rect.height*pxrt;
                cnvs0.width   = cnvs8aX;
                cnvs0.height  = cnvs8aY;
                cnvs8a.width  = cnvs8aX;
                cnvs8a.height = cnvs8aY;
                rndRqst8();
            }

            th = document.createElement("th");
            th.style.width = "150px";
            tr.appendChild(th);
            buI = document.createElement("input");
            //buI.style.display = "block";
            buI.style.margin = "0px 5px";
            buI.style.width = "150px";
            buI.type = "range";
            buI.min =   256;
            buI.max =   1024;
            buI.value = 512;
            buI.step =  1;
            buI.oninput = chngX1D;
            th.appendChild(buI);
            boL8[3] = buI;

            //th = document.createElement("th");
            //th.style.width = "150px";
            //tr.appendChild(th);
            buI = document.createElement("input");
            buI.style.margin = "0px 5px";
            buI.style.width = "150px";
            buI.type = "range";
            buI.min =   0;
            buI.max =   10;
            buI.value = 6;
            buI.step =  1/512;
            buI.oninput = function(){boL8v[7] = boL8[7].value; rndRqst8();};
            th.appendChild(buI);
            boL8[7] = buI;           boL8v[7] = boL8[7].value;

            chngX2stp = function()
            {
                boL8[13].max = x1D;
                if(boL8[13].value > x1D){boL8[13].value = x1D;}
                boL8[12].innerHTML = "stp = 2<sup>"+boL8[13].value+"</sup>";
                snd8Stp = 1<<boL8[13].value;

                if(snd8==null||micRec8){return;}
                snd8t = snd8m; ry8 = 0;
                rndA8 = true;
                rndRqst8();
            }

            th = document.createElement("th");
            th.style.width = "150px";
            tr.appendChild(th);
            buI = document.createElement("pre");
            buI.style.margin = "0px";
            buI.style.fontFamily = "inherit";
            buI.style.fontWeight = "normal";
            buI.style.fontSize = "20px";
            //buI.innerHTML = "z = "+ (1<<x1D);
            th.appendChild(buI);
            boL8[6] = buI;

            //th = document.createElement("th");
            //tr.appendChild(th);
            buI = document.createElement("input");
            //buI.style.display = "block";
            buI.style.margin = "0px";
            buI.style.width = "150px";
            buI.type = "range";
            buI.min =   1;
            buI.max =   x1DMAX;
            buI.value = x1D;
            buI.step =  1;
            buI.oninput = chngX21D;
            th.appendChild(buI);
            boL8[5] = buI;

            th = document.createElement("th");
            th.style.width = "150px";
            tr.appendChild(th);
            buI = document.createElement("pre");
            buI.style.margin = "0px";
            buI.style.fontFamily = "inherit";
            buI.style.fontWeight = "normal";
            buI.style.fontSize = "20px";
            buI.innerHTML = "stp = 2<sup>"+x1D+"</sup>";
            th.appendChild(buI);
            boL8[12] = buI;

            //th = document.createElement("th");
            //tr.appendChild(th);
            buI = document.createElement("input");
            //buI.style.display = "block";
            buI.style.margin = "0px";
            buI.style.width = "150px";
            buI.type = "range";
            buI.min =   1;
            buI.max =   x1D;
            buI.value = x1D;
            buI.step =  1;
            buI.oninput = chngX2stp;
            th.appendChild(buI);
            boL8[13] = buI;

            th = document.createElement("th");
            th.style.width = "150px";
            tr.appendChild(th);
            buI = document.createElement("input");
            buI.style.margin = "0px 5px";
            buI.style.width = "150px";
            buI.type = "range";
            buI.min =   0;
            buI.max =   2;
            buI.value = 1;
            buI.step =  1/1024;
            buI.oninput = function(){boL8v[9] = boL8[9].value; rndRqst8();};
            th.appendChild(buI);
            boL8[9] = buI;           boL8v[9] = boL8[9].value;

            buI = document.createElement("input");
            buI.style.margin = "0px 5px";
            buI.style.width = "50px";
            buI.type = "range";
            buI.min =   0;
            buI.max =   1;
            buI.value = 0;
            buI.step =  1;
            buI.oninput = function(){boL8v[16] = boL8[16].value; rndRqst8();};
            th.appendChild(buI);
            boL8[16] = buI;          boL8v[16] = boL8[16].value;

            buI = document.createElement("input");
            buI.style.margin = "0px 5px";
            buI.style.width = "100px";
            buI.type = "range";
            buI.min =   1;
            buI.max =   4;
            buI.value = 1;
            buI.step =  1;
            buI.oninput = function(){boL8v[15] = boL8[15].value; rndRqst8();};
            th.appendChild(buI);
            boL8[15] = buI;          boL8v[15] = boL8[15].value;

            th = document.createElement("th");
            th.style.width = "150px";
            tr.appendChild(th);

            //[a = ] slider with text
            buI = document.createElement("pre");
            buI.style.margin = "0px";
            buI.style.fontFamily = "inherit";
            buI.style.fontWeight = "normal";
            buI.style.fontSize = "20px";
            th.appendChild(buI);
            boL8[11] = buI;

            chngAB8 = function()
            {
                boL8[11].innerHTML = "a = "+(boL8[14].value*1).toFixed(3);

                rndr8d = true;

                if(snd8==null||micRec8){return;}
                snd8t = snd8m; ry8 = 0;
                rndA8 = true;
                rndRqst8();
            }

            buI = document.createElement("input");
            //buI.style.display = "block";
            buI.style.margin = "0px";
            buI.style.width = "150px";
            buI.type = "range";
            buI.min =   0;
            buI.max =   1;
            buI.value = 0;
            buI.step = 1/512;
            buI.oninput = function(){boL8v[14] = boL8[14].value; chngAB8();};
            th.appendChild(buI);
            boL8[14] = buI;          boL8v[14] = boL8[14].value;

            chngAB8();

            th = document.createElement("th");
            th.style.width = "150px";
            tr.appendChild(th);

            //[visuals] button
            {
                spwnCode8 = function()
                {
                    frSh8iV = !frSh8iV;

                             var vh = "visible";  var vs = "hidden";
                    if(!frSh8iV){vh = "hidden";       vs = "visible";}
                    
                    boL8[17].style.visibility = vh;
                    boL8[18].style.visibility = vh;
                    document.body.style.overflow = vs;

                    if(!frSh8iV) //compile shader
                    {
                        var s0 = frSh8a.replace("FUN",boL8[17].value);
                        var s1 = frSh8c.replace("FUN",boL8[17].value);

                        //only test for errors and show them shaders
                        var shader0 = gl.createShader(gl.FRAGMENT_SHADER);
                        var shader1 = gl.createShader(gl.FRAGMENT_SHADER);
                        gl.shaderSource(shader0, s0);
                        gl.shaderSource(shader1, s1);
                        gl.compileShader(shader0);
                        gl.compileShader(shader1);
                        var com0 = gl.getShaderParameter(shader0, gl.COMPILE_STATUS);
                        var com1 = gl.getShaderParameter(shader1, gl.COMPILE_STATUS);
                        if(!com0){alert(gl.getShaderInfoLog(shader0));}
                        if(!com1){alert(gl.getShaderInfoLog(shader1));}
                        gl.deleteShader(shader0);
                        gl.deleteShader(shader1);
                        if(!com0 || !com1){return;}

                        gl.useProgram(null);

                        gl.deleteProgram(shaderP8a);
                        shaderP8a = shaderCreator(vxSh8a, s0);
                        shdVtx8a  = gl.getAttribLocation( shaderP8a, "vtx");
                        shdMtx8a  = gl.getUniformLocation(shaderP8a, "mtx");
                        shdTex8a0 = gl.getUniformLocation(shaderP8a, "tex0");
                        shdTex8a1 = gl.getUniformLocation(shaderP8a, "tex1");

                        gl.deleteProgram(shaderP8c);
                        shaderP8c = shaderCreator(vxSh8a, s1);
                        shdVtx8c  = gl.getAttribLocation( shaderP8c, "vtx");
                        shdMtx8c  = gl.getUniformLocation(shaderP8c, "mtx");
                        shdTex8c  = gl.getUniformLocation(shaderP8c, "tex");

                        if(snd8==null||micRec8){return;}
                        snd8t = snd8m; ry8 = 0;
                        rndA8 = true;
                        rndRqst8();
                    }
                };

                buI = document.createElement("div");
                buI.style.position = "fixed";
                buI.style.left  = "0px";
                buI.style.top   = "0px";
                buI.style.width = "100%";
                buI.style.height = "100%";
                buI.style.background = "rgba(100,100,100,0.5)";
                buI.style.zIndex = "1";
                buI.style.visibility = "hidden";
                buI.onclick = spwnCode8;
                document.body.appendChild(buI);
                boL8[18] = buI;

                buI = document.createElement("textarea");
                buI.style.whiteSpace = "pre";
                buI.style.wordWrap = "normal";
                buI.style.fontFamily = "inherit";
                buI.style.fontSize = "20px";
                buI.style.position = "fixed";
                buI.style.left  = "10%";
                buI.style.top   = "10%";
                buI.style.width = "80%";
                buI.style.height = "80%";
                buI.style.resize = "none";
                buI.style.background = "rgb(229,229,229)";
                buI.style.color = "rgb(0,0,0)";
                buI.style.zIndex = "2";
                buI.style.visibility = "hidden";
                buI.style.lineHeight = "100%";
                buI.spellcheck = false;
                //buI.oninput = runEqu;
                buI.value = frSh8fun;
                document.body.appendChild(buI);
                boL8[17] = buI;

                buI = document.createElement("button");
                //buI.style.display = "block";
                buI.style.fontFamily = "inherit";
                buI.style.margin = "0px 5px";
                buI.style.width = "100px";
                buI.onclick = spwnCode8;
                buI.innerHTML = "visuals";
                th.appendChild(buI);
                boL8[4] = buI;
            }
            //[soundGen] button
            {
                vxSh8d =
                `precision highp float;
                attribute float vtx;
                //uniform mat4 mtx;
                varying vec2 uv;
                void main()
                {
                    vec4 s = vec4(-1.,1.,1.,1.);
                  //if(vtx == .25){s   = 0.;}
                    if(vtx == .50){s.y =-3.;}
                    if(vtx == .75){s.x = 3.;}
                    uv = s.xy*.5+.5;
                    gl_Position = s*.5;
                }`;
                frSh8d =
                `precision highp float;
                uniform sampler2D tex0;
                uniform sampler2D tex1;
                uniform sampler2D tex2;
                uniform sampler2D tex3;
                uniform mat4 mtx;
                varying vec2 uv;
                FUN
                void main()
                {
                    gl_FragColor = paint();
                }`;
                var frSh8funb = 
`var shd1 = \`
//texture2D() can load tex0 tex1 tex2 tex3
//output      .xy = real|imaginary of left  sound channel
//            .zw = real|imaginary of right sound channel
//uv          texture pixel coordinate  range  0 to 1
//mtx[0].xy   position of last click    range  0 to 1
//mtx[0].z    resolution of textures
//mtx[0].w    value of [a = ] slider
//mtx[1].x    sound samples per second
vec4 paint()
{
    float i  = dot(floor(uv*mtx[0].z),vec2(1,mtx[0].z));    //sound sample position
    float hz = 1000.;                                       //sound hertz
    return vec4(1,0,1,0)*cos(i/mtx[1].x*hz*6.2831);
}
\`;

var shadas = [shd1];

//renderSteps() can generate sound using the GPU then hear and visualize it
//key [space] runs renderSteps()
//the next functions can be used inside renderSteps()
//paintS(t,s)           render to texture "t" using shader "s"
//                      reading and writing to same texture does not work
//soundToTexture(t,o)   put sound file data starting at offset "o" into texture "t"
//textureToSound(o,t)   put texture "t" data into sound file starting at offset "o"
//                      "s" is an integer position of a shader in "shadas" array
//                      "o" is an integer position of the sample in the sound
//                      "t" is an integer from 0 to 3
var renderSteps = function()    
{
    //soundToTexture(1,0);
    paintS(0,0);
    textureToSound(0,0);
};

`;

                //iniSoundGen8
                {
                    tX8[4] = texCreator(gl.RGBA, sndGZ, sndGZ, gl.FLOAT, gl.NEAREST, null, gl.TEXTURE4);
                    tX8[5] = texCreator(gl.RGBA, sndGZ, sndGZ, gl.FLOAT, gl.NEAREST, null, gl.TEXTURE5);
                    tX8[6] = texCreator(gl.RGBA, sndGZ, sndGZ, gl.FLOAT, gl.NEAREST, null, gl.TEXTURE6);
                    tX8[7] = texCreator(gl.RGBA, sndGZ, sndGZ, gl.FLOAT, gl.NEAREST, null, gl.TEXTURE7);
                    fB8[4] = frameBuffCreator(tX8[4]);
                    fB8[5] = frameBuffCreator(tX8[5]);
                    fB8[6] = frameBuffCreator(tX8[6]);
                    fB8[7] = frameBuffCreator(tX8[7]);
                }
                iniShdr8d = function(shdfun)
                {
                    var o = null;
                    var f = frSh8d.replace("FUN",shdfun);
                    var s = shaderCreator(vxSh8d, f);
                    if( s == null){return o;}
                    
                    o = new Object();
                    o.shaderP8d  = s;
                    o.shdVtx8d   = gl.getAttribLocation( s,"vtx");
                    o.shdMtx8d   = gl.getUniformLocation(s,"mtx");
                    o.shdTex8d0  = gl.getUniformLocation(s,"tex0");
                    o.shdTex8d1  = gl.getUniformLocation(s,"tex1");
                    o.shdTex8d2  = gl.getUniformLocation(s,"tex2");
                    o.shdTex8d3  = gl.getUniformLocation(s,"tex3");
                    return o;
                }
                iniRndrStps8d = function(s)
                {
                    var f = new Function(   s +
                                            `
                                            var shsh8 = new Array(shadas.length);
                                            for(var i = 0; i < shadas.length; ++i)
                                            {
                                                   shsh8[i] = iniShdr8d(shadas[i]);
                                                if(shsh8[i] == null){return;}
                                            }
                                            
                                            gl.useProgram(null);
                                            for(var i = 0; shs8d != null && i < shs8d.length; ++i)
                                            {
                                                gl.deleteProgram(shs8d[i].shaderP8d);
                                            }
                                            shs8d     = shsh8;
                                            rndrStps8 = renderSteps;

                                            `
                                        );
                    f();
                }
                spwnCode8b = function()
                {
                    
                    frSh8iV2 = !frSh8iV2;

                              var vh = "visible";  var vs = "hidden";
                    if(!frSh8iV2){vh = "hidden";       vs = "visible";}
                    
                    boL8[19].style.visibility = vh;
                    boL8[20].style.visibility = vh;
                    document.body.style.overflow = vs;

                    if(!frSh8iV2) //compile shader
                    {
                        iniAudio();
                        if(textMode != 3)
                        {  textMode  = 3;
                            gl.activeTexture(gl.TEXTURE0+7); gl.bindTexture(gl.TEXTURE_2D, tX8[7]);
                            gl.activeTexture(gl.TEXTURE0+6); gl.bindTexture(gl.TEXTURE_2D, tX8[6]);
                            gl.activeTexture(gl.TEXTURE0+5); gl.bindTexture(gl.TEXTURE_2D, tX8[5]);
                            gl.activeTexture(gl.TEXTURE0+4); gl.bindTexture(gl.TEXTURE_2D, tX8[4]);
                            gl.activeTexture(gl.TEXTURE0+3); gl.bindTexture(gl.TEXTURE_2D, tX8[3]);
                            gl.activeTexture(gl.TEXTURE0+2); gl.bindTexture(gl.TEXTURE_2D, tX8[2]);
                            gl.activeTexture(gl.TEXTURE0+1); gl.bindTexture(gl.TEXTURE_2D, tX8[1]);
                            gl.activeTexture(gl.TEXTURE0+0); gl.bindTexture(gl.TEXTURE_2D, tX8[0]);
                            cnvs0.width  = cnvs8aX;
                            cnvs0.height = cnvs8aY;
                        }
                        iniRndrStps8d(boL8[20].value);

                        rndr8d = true;

                        snd8t = snd8m;  ry8 = 0;
                        rndA8 = true;
                        rndRqst8();
                    }
                };
                soundToTexture = function(dst,offst)
                {
                    var offst2 = offst<<2;
                    var min    = Math.min(snd8z,offst+sndGZ2)-offst;
                        min    = Math.max(0,min);
                        min    = min<<2;
                    var max    = sndGZ2<<2;
                    for(var i =   0; i < min; ++i){stx8d[i] = snd8[offst2+i];}
                    for(var i = min; i < max; ++i){stx8d[i] = 0;}
                    gl.activeTexture(gl.TEXTURE0+dst+4);
                    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0,0, sndGZ,sndGZ, gl.RGBA, gl.FLOAT, stx8d);
                    gl.activeTexture(gl.TEXTURE0);
                }
                textureToSound = function(offst,src)
                {
                    if(audSN8==null)
                    {
                        snd8z  = sndGZ2|0;
                        audSN8 = sQx.createBuffer(2, sndGZ2, smplRt);
                        snd8  = new Float32Array(snd8z<<2);
                        snd8m = 0;
                        timMv8.value = snd8m;
                        timMv8.max   = snd8z;
                    }

                    gl.bindFramebuffer(gl.FRAMEBUFFER, fB8[4+src]);  gl.readPixels(0, 0, sndGZ, sndGZ, gl.RGBA, gl.FLOAT, stx8d);
                    gl.bindFramebuffer(gl.FRAMEBUFFER, null);
                    
                    var offst2 = offst<<2;
                    var min    = Math.min(snd8z,offst+sndGZ2)-offst;
                        min    = Math.max(0,min);
                    var min2   = min<<2;
                    for(var i = 0; i < min2; ++i){snd8[offst2+i] = stx8d[i];}

                    var d0 = audSN8.getChannelData(0);  for(var i = 0; i < min; ++i){d0[offst+i] = stx8d[(i<<2)+0];}
                    var d1 = audSN8.getChannelData(1);  for(var i = 0; i < min; ++i){d1[offst+i] = stx8d[(i<<2)+2];}
                }
                
                buI = document.createElement("div");
                buI.style.position = "fixed";
                buI.style.left  = "0px";
                buI.style.top   = "0px";
                buI.style.width = "100%";
                buI.style.height = "100%";
                buI.style.background = "rgba(100,100,100,0.5)";
                buI.style.zIndex = "1";
                buI.style.visibility = "hidden";
                buI.onclick = spwnCode8b;
                document.body.appendChild(buI);
                boL8[19] = buI;

                buI = document.createElement("textarea");
                buI.style.whiteSpace = "pre";
                buI.style.wordWrap = "normal";
                buI.style.fontFamily = "inherit";
                buI.style.fontSize = "20px";
                buI.style.position = "fixed";
                buI.style.left  = "10%";
                buI.style.top   = "10%";
                buI.style.width = "80%";
                buI.style.height = "80%";
                buI.style.resize = "none";
                buI.style.background = "rgb(229,229,229)";
                buI.style.color = "rgb(0,0,0)";
                buI.style.zIndex = "2";
                buI.style.visibility = "hidden";
                buI.style.lineHeight = "100%";
                buI.spellcheck = false;
                //buI.oninput = runEqu;
                buI.value = frSh8funb;
                document.body.appendChild(buI);
                boL8[20] = buI;

                buI = document.createElement("button");
                //buI.style.display = "block";
                buI.style.fontFamily = "inherit";
                buI.style.margin = "0px 5px";
                buI.style.width = "100px";
                buI.onclick = spwnCode8b;
                buI.innerHTML = "soundGen";
                th.appendChild(buI);
                boL8[21] = buI;
            }

        //th = document.createElement("th");
        //tr.appendChild(th);
        buI = document.createElement("input");
        buI.style.display = "block";
        buI.style.margin = "0px";
        buI.style.marginLeft = "auto";
        buI.style.marginRight = "auto";
        buI.style.width = "95%";
        buI.type = "range";
        buI.min =   0;
        buI.max =   0;
        buI.value = 0;
        buI.step  = 1;
        buI.oninput = function()
                      {
                          snd8m = timMv8.value|0;
                          if(snd8==null||micRec8){return;}
                          snd8t = snd8m; ry8 = 0;
                          rndA8 = true;
                          rndRqst8();
                          if(audNd != null){snd8i = sQx.currentTime*smplRt;
                                            audioStop();
                                            audioPlay();}
                      };
        document.body.appendChild(buI);
        timMv8 = buI;
 
        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "100%";    
        dv1.style.height = "500px";
        dv1.style.marginLeft = "auto";
        dv1.style.marginRight = "auto";
        document.body.appendChild(dv1);
        boL8[10] = dv1;

        cnvs8a = document.createElement("canvas");
        cnvs8a.tabIndex = '1';
        cnvs8a.style.position = "absolute";
        cnvs8a.style.border = "0px";
        cnvs8a.style.margin = "0px";
        cnvs8a.style.width = "100%"; 
        cnvs8a.style.height = "500px";
        dv1.appendChild(cnvs8a);
        cntx8a = cnvs8a.getContext("2d");

        dropSound = function(e)
        {
            e.preventDefault();
            if(e.dataTransfer.files.length!=0)
            {
                iniAudio();
                e.dataTransfer.files[0].arrayBuffer()
                .then(arrBff    => sQx.decodeAudioData(arrBff))
                .then(audioBff  => getSoundD(audioBff));
            }
            else
            {
                xmlhr = new XMLHttpRequest();
                xmlhr.responseType = "arraybuffer";
                xmlhr.open("GET", e.dataTransfer.getData("URL"), true);
                xmlhr.onload = function() {
                    sQx.decodeAudioData(xmlhr.response)
                    .then(audioBff => getSoundD(audioBff));
                }
                xmlhr.send();
            }
        }
        dropSound2 = function(e)
        {
            e.preventDefault();
        }
        cnvs8a.ondrop = dropSound;
        cnvs8a.ondragover = dropSound2;

        touchStart8 = function(e)
        {
            if(e.touches.length==2){audioPlayStop();}
            if(e.touches.length!=1){return;}

            var rec = cnvs8a.getBoundingClientRect();
            inpX8 = (                      e.touches[0].clientX-rec.left)/rec.width ;
            inpY8 = (rec.top +rec.height-1-e.touches[0].clientY         )/rec.height;

            if(audSN8==null){return;}
            snd8i = sQx.currentTime*smplRt - Math.floor(snd8Stp*(1<<y1D)*inpX8);
            snd8p = snd8m                  + Math.floor(snd8Stp*(1<<y1D)*inpX8);  rndRqst8();
            if(audNd==null){return;}
            audioStop();
            audioPlay();
        };
        mouseDown8 = function(e)
        {
            if(e.button==1){audioPlayStop(); e.preventDefault();}
            if(e.button!=0){return;}

            var rec = cnvs8a.getBoundingClientRect();
            inpX8 = (                      e.clientX-rec.left)/rec.width ;
            inpY8 = (rec.top +rec.height-1-e.clientY         )/rec.height;

            if(audSN8==null){return;}
            snd8i = sQx.currentTime*smplRt - Math.floor(snd8Stp*(1<<y1D)*inpX8);
            snd8p = snd8m                  + Math.floor(snd8Stp*(1<<y1D)*inpX8);  rndRqst8();
            if(audNd==null){return;}
            audioStop();
            audioPlay();
        };
        keyDown8 = function(e)
        {
            e.preventDefault();
            switch(e.code)
            {
                case "Space":{  rndr8d = true;
                                if(snd8==null||micRec8){return;}
                                snd8t = snd8m; ry8 = 0;
                                rndA8 = true;
                                rndRqst8();
                             }  break;
            }
        };
        cnvs8a.addEventListener("touchstart",  touchStart8,  true);
        cnvs8a.addEventListener("mousedown",    mouseDown8,  true);
        cnvs8a.addEventListener("keydown",        keyDown8,  true);
        

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "middle click to play|pause sound\n"+
                        "2 fingers    to play|pause sound\n"+
                        "slider [stp] controls doing the 1D FFT every [stp] sound samples     \n"+
                        "bottom slider to the right of [stp] shows 4 different visualizations:\n"+
                        "AMPLITUDE of left|right sound channels as green|blue\n"+
                        "PHASE     of left|right sound channels as green|blue\n"+
                        "left  sound channel REAL|IMAGINARY     as green|blue\n"+
                        "right sound channel REAL|IMAGINARY     as green|blue\n";
        document.body.appendChild(buI);

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px";
        buI.style.textAlign = "center";
        document.body.appendChild(buI);      var noiue = buI;

        buI = document.createElement("a");
        buI.href = "https://particlo.org/21";
        buI.innerHTML = "wavelet convolution"
        noiue.appendChild(buI);

        chngX1D();
        chngX21D();
        render8bGl();
    }
    function render8aGl()
    {
        if(!rndA8){return;}

        var x  = 1<<x1D;
        var x4 = x<<2;
        shdMtx[ 0] =   x;
        shdMtx[ 1] = 1/x;
        shdMtx[ 5] =   xF8;
        shdMtx[ 6] = 1/xF8;
        shdMtx[ 7] = 1/yF8;
        shdMtx[10] = boL8v[14];
  
        var mx = 0;
        if(micRec8){mx = snd8tx;}
        else       {mx = snd8z ;} mx = mx<<2;

        for(var k = 0; k < 16; ++k)
        {
            var smdi = snd8t;
            var os = snd8t<<2;
            for(var i = 0|0; i < x4 && os<mx; i=(i+1)|0){swp8[i] = snd8[os]; os=(os+1)|0;}
            if(os==mx)//file end reached
            {
                if(!micRec8){rndA8 = false;} return;
            }else{
                snd8t += snd8Stp;
            }

            gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, xF8,yF8, gl.RGBA, gl.FLOAT, swp8);
            
            //render range in y axis
            shdMtx[8] = -1;
            shdMtx[9] =  1;

            shdMtx[12] = smdi;

            var g0 = 0|0;
            var g1 = 1|0;
            gl.viewport(0, 0, xF8, yF8);
            gl.bindFramebuffer(gl.FRAMEBUFFER, fB8[g1]);//interlace
            gl.useProgram(shaderP8a);
            gl.uniform1i(shdTex8a0, g0);
            gl.uniform1i(shdTex8a1,  2);
            gl.uniformMatrix4fv(shdMtx8a, false, shdMtx);
            gl.vertexAttribPointer(shdVtx8a, 1, gl.FLOAT, 0, 0, 0);
            gl.enableVertexAttribArray(shdVtx8a);
            gl.drawArrays(gl.TRIANGLES, 0, 6);
            var lst = (x1D-1)|0;
            for(var i = 0|0; i < x1D; i=(i+1)|0)//1D FFT
            {
                shdMtx[12] = 1<<(i+0);
                shdMtx[13] = 1<<(i+1);
                shdMtx[14] = 1/shdMtx[13];
                shdMtx[15] =-1*PI*2*shdMtx[14];//-1=notreversFFT  +1=reversFFT for +1 nrmlzFFTMath is missing in lst pass
                g0 = (g0+1)&1;
                g1 = (g1+1)&1;
                if(i==lst)
                {
                    g1 = 3|0;
                    var y = yF8<<y1D;
                    shdMtx[8] = ((ry8+  0)/y)*2-1;
                    shdMtx[9] = ((ry8+yF8)/y)*2-1;    ry8 = (ry8+yF8)&(y-1);
                    gl.viewport(0, 0, xF8, y);
                }
                gl.bindFramebuffer(gl.FRAMEBUFFER, fB8[g1]);
                //if(i==lst && ry8==0)//clear tex
                //{
                //    gl.clearColor(0,0,0,0);
                //    gl.clear(gl.COLOR_BUFFER_BIT);
                //}
                gl.useProgram(shaderP8b);
                gl.uniform1i(shdTex8b0, g0);
                gl.uniform1i(shdTex8b1,  2);
                gl.uniformMatrix4fv(shdMtx8b, false, shdMtx);
                gl.vertexAttribPointer(shdVtx8b, 1, gl.FLOAT, 0, 0, 0);
                gl.enableVertexAttribArray(shdVtx8b);
                gl.drawArrays(gl.TRIANGLES, 0, 6);
            }
            if(ry8==0)//screen end reached
            {
                if(!micRec8){rndA8 = false; return;}
            }
        }
    }
    function render8bGl()
    {
        rndAB8 = false;

        if(textMode != 3)
        {  textMode  = 3;
            gl.activeTexture(gl.TEXTURE0+7); gl.bindTexture(gl.TEXTURE_2D, tX8[7]);
            gl.activeTexture(gl.TEXTURE0+6); gl.bindTexture(gl.TEXTURE_2D, tX8[6]);
            gl.activeTexture(gl.TEXTURE0+5); gl.bindTexture(gl.TEXTURE_2D, tX8[5]);
            gl.activeTexture(gl.TEXTURE0+4); gl.bindTexture(gl.TEXTURE_2D, tX8[4]);
            gl.activeTexture(gl.TEXTURE0+3); gl.bindTexture(gl.TEXTURE_2D, tX8[3]);
            gl.activeTexture(gl.TEXTURE0+2); gl.bindTexture(gl.TEXTURE_2D, tX8[2]);
            gl.activeTexture(gl.TEXTURE0+1); gl.bindTexture(gl.TEXTURE_2D, tX8[1]);
            gl.activeTexture(gl.TEXTURE0+0); gl.bindTexture(gl.TEXTURE_2D, tX8[0]);
            cnvs0.width  = cnvs8aX;
            cnvs0.height = cnvs8aY;
        }

        if(rndr8d)
        {  rndr8d = false;
            rndrStps8();
        }

        render8aGl();

        //update input data
        shdMtx[0] = boL8v[7]*.1;            shdMtx[0]*= shdMtx[0];
        shdMtx[1] = 1;//boL8[8].value*.1;   shdMtx[1]*= shdMtx[1];
        shdMtx[2] = 2/(2-boL8v[9])-1;
        shdMtx[3] = 1<<x1D;
        shdMtx[4] = boL8v[15];
        shdMtx[5] = boL8v[16];
        //render range in y axis
        shdMtx[8] =-1;
        shdMtx[9] = 1;
        //adjust reading 2Dtexture
        shdMtx[10] = 1<<y1D;
        shdMtx[11] = yF8;
                               var cune = snd8Stp*(1<<y1D);
        if(audNd!=null)
        {
            var dine = sQx.currentTime*smplRt;
            var june = dine-snd8i;
            if( june>= cune)
            {
                snd8i  = dine;
                snd8m += june;
                snd8t  = snd8m;
                timMv8.value = snd8m;
                ry8   = 0;
                rndA8 = true;
            }
            shdMtx[12] = june;
        }
        else{shdMtx[12] = snd8p-snd8m;}
        shdMtx[12] = (shdMtx[12] - shdMtx[3]*.5)/cune;

        gl.viewport(0, 0, cnvs8aX, cnvs8aY);

        //gl.clearColor(.9,.9,.9,1);
        //gl.clearDepth(0);
        //gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        //if(textMode != 3)
        //{  textMode  = 3;
        //    gl.activeTexture(gl.TEXTURE0+3); gl.bindTexture(gl.TEXTURE_2D, tX8[3]);
        //    gl.activeTexture(gl.TEXTURE0+2); gl.bindTexture(gl.TEXTURE_2D, tX8[2]);
        //    gl.activeTexture(gl.TEXTURE0+1); gl.bindTexture(gl.TEXTURE_2D, tX8[1]);
        //    gl.activeTexture(gl.TEXTURE0+0); gl.bindTexture(gl.TEXTURE_2D, tX8[0]);
        //}
        gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        gl.useProgram(shaderP8c);
        gl.uniform1i(shdTex8c, 3);
        gl.uniformMatrix4fv(shdMtx8c, false, shdMtx);
        gl.vertexAttribPointer(shdVtx8c, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx8c);
        gl.drawArrays(gl.TRIANGLES, 0, 6);

        cntx8a.drawImage(cnvs0, 0, 0);

        if(rndA8||audNd!=null){rndRqst8();}
    }
    function rndRqst8()
    {
        if(rndAB8){return;}
           rndAB8 = true;
        requestAnimationFrame(render8bGl);
    }
    function paintS(dest,shID)
    {
        //to avoid reading from render target
        var a  = 4;
        var a0 = 0; if(a0 == dest){a0 = -a;} a0 += a;
        var a1 = 1; if(a1 == dest){a1 = -a;} a1 += a;
        var a2 = 2; if(a2 == dest){a2 = -a;} a2 += a;
        var a3 = 3; if(a3 == dest){a3 = -a;} a3 += a;

        var s = shs8d[shID];

        shdMtx[0] = inpX8;
        shdMtx[1] = inpY8;
        shdMtx[2] = sndGZ;
        shdMtx[3] = boL8v[14];
        shdMtx[4] = smplRt;

        gl.viewport(0,0,sndGZ,sndGZ);
        gl.bindFramebuffer(gl.FRAMEBUFFER, fB8[a+dest]);
        gl.useProgram(s.shaderP8d);
        gl.uniform1i(s.shdTex8d0,a0);
        gl.uniform1i(s.shdTex8d1,a1);
        gl.uniform1i(s.shdTex8d2,a2);
        gl.uniform1i(s.shdTex8d3,a3);
        gl.uniformMatrix4fv(s.shdMtx8d, false, shdMtx);
        gl.vertexAttribPointer(s.shdVtx8d, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(s.shdVtx8d);
        gl.drawArrays(gl.TRIANGLES, 0, 3);
    }

    var boL9 = new Array(8);
    var cnvsDiv9 = null;
    var cnvs9a = null;  var cnvs9b = null;
    var cntx9a = null;  var cntx9b = null;
    var cnvs9aX = 32;
    var cnvs9aY = 32;
    var xy2D = 9|0; //2^xfft2D
    var tX9 = new Array(16);//2pinpongFFT 2input 2output 1interlace 1imgORcam tex123456
    var fB9  = new Array(12); //2pinpongFFT 2input 2output
    var fB9z = new Uint32Array(fB9.length);
    var imgEml9 = null;
    var paintDo9 = false; //true=do paint  false=dont paint
    var camG = 0;//which side of screen currently moving
    var cam9 = new Float32Array([0,0,1, 0,0,1]);//2cameras, XY position, Z zoom

    var touchStart9 = null;
    var touchEnd9   = null;
    var touchMove9  = null;
    var mouseDown9  = null;
    var mouseUp9    = null;
    var mouseMove9  = null;
    var mouseWheel9 = null;
    var mosP = new Uint8Array([0,0,0]);//mouse 2clik pressed
    var inpX9 = 0;  var inpX92 = 0; 
    var inpY9 = 0;  var inpY92 = 0;
    var inpXd9 = 0; var inpXd92 = 0; 
    var inpYd9 = 0; var inpYd92 = 0;
    var holdI = false;//hold down while camera

    var camElem9 = null;//webcam
    var camStrm9 = null;//webcam

    var frSh9iV = false;//shader editor visible or hidden
    var frSh9iW = 0;    //shader editor 0=PAINT 1=WAVE

    var cnvDwnl = [null,null,null,null];
    var imgDwBu = new Array(4);
    var rBOB9 = false;//if BOB found then apply paint() and paint2()
    var evesv9 = null;
    var ldTxSZ9 = new Uint32Array([0,0]);//size of file loaded 2Dtexture, image or sound
    var rnd7Tx9 = false;
    var rndC9 = false;

    var shs9g    = null;//array of shaders object applied by rndrStps
    var rndrStps = null;//function defining rendering steps after clicking

    var imgFile1 ;
    var imgFile02;
    var imgFile01;
    var imgFile0 ;

    var camSuccess ;
    var camSuccess2;
    var camBut9;
    var iniCam;

    var inixy2D;
    var chngxy2D;
    var chngY2D;

    var rgba9;      var rgba9o     = null;//because reading from rgba9   is too slow
    var bright9;    var bright9o   = null;//because reading from bright9 is too slow
    var paint9;     var paint9o    = null;//because reading from paint9  is too slow
    var realAmpl9;  var realAmpl9o = null;//because reading from realAmpl9 is too slow
    var selChng9;
    var selhtml9;
    var spwnCode;
    var shaderCode9;
    var shaderCodeBck9;
    var shaderCode9b;
    

    var drop ;
    var drop2;
    var getImg9;

    var copyText9;
    var rawcopyText9;

    var rezCh9;
    var viewHeight9;

    var hidImg;

    var dfTx9 = 32;//default resolution of 6 helper textures

    function interface9()
    {
        imgEml9 = new Image(2, 2);

        for(let i = 0; i < tX9.length; ++i){tX9[i] = null;}
        for(let i = 0; i < fB9.length; ++i){fB9[i] = null;}

        let fnz = "24px";
        let buI = null;
        let dv1 = null;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "lets transform an image into the frequency domain using the GPU\n\n";
        document.body.appendChild(buI);

        let tbl = document.createElement("table");
        tbl.style.marginLeft = "auto";
        tbl.style.marginRight = "auto";
        document.body.appendChild(tbl);

            let tr = document.createElement("tr");
            tbl.appendChild(tr);

            let th = null;

            imgFile1 = function()
            {
                ldTxSZ9[0] = imgEml9.naturalWidth;
                ldTxSZ9[1] = imgEml9.naturalHeight;
                URL.revokeObjectURL(imgEml9.src);

                gl.deleteTexture(tX9[13]);
                gl.activeTexture(gl.TEXTURE0+13);   
                tX9[13] = gl.createTexture();
                gl.bindTexture(gl.TEXTURE_2D, tX9[13]);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
                gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, imgEml9);

                rnd7Tx9 = true;
                rendC9GL();
            };
            imgFile02 = function()
            {
                imgEml9.src    = URL.createObjectURL(evesv9);    evesv9 = null;
                imgEml9.onload = imgFile1;
            };
            imgFile01 = function(audioBff)
            {
                var l = Math.min(audioBff.length,(1<<14)*(1<<14));
                var sd = Math.ceil(Math.log2(Math.sqrt(l)));
                    sd = Math.min(sd,14);
                var im = 22;
                var jm = 22;
                for(var i = sd-1; i < sd+1; ++i){
                for(var j =    i; j < sd+1; ++j){
                    var a = (1<<i )*(1<<j )-l;
                    var b = (1<<im)*(1<<jm)-l;
                    if(a>=0 && a<b){im = i;
                                    jm = j;}
                }}
                im = (1<<im);
                jm = (1<<jm);
                var d = new Float32Array(4*im*jm);
                var m = Math.min(audioBff.numberOfChannels, 2);
                for(var i = 0; i < m; ++i)
                {
                    var dCh = audioBff.getChannelData(i);
                    for(var j = 0; j < dCh.length; ++j)
                    {
                        d[(j<<2)+i+1] = dCh[j];
                    }
                }

                ldTxSZ9[0] = im;
                ldTxSZ9[1] = jm;
                
                gl.deleteTexture(tX9[13]);
                gl.activeTexture(gl.TEXTURE0+13);   
                tX9[13] = gl.createTexture();
                gl.bindTexture(gl.TEXTURE_2D, tX9[13]);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
                gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, im, jm, 0, gl.RGBA, gl.FLOAT, d);

                rnd7Tx9 = true;
                rendC9GL();
            };
            imgFile0 = function(e)
            {
                if(!e.target.files){return;}
                cam9[0] = 0;
                cam9[1] = 0;
                cam9[2] = 1;

                cam9[3] = 0;
                cam9[4] = 0;
                cam9[5] = 1;
                
                evesv9 = e.target.files[0];

                iniAudio();
                e.target.files[0].arrayBuffer()
                .then(arrBff   => sQx.decodeAudioData(arrBff))
                .then(audioBff => imgFile01(audioBff))
                .catch(er      => imgFile02());
            };
            
            th = document.createElement("th");
            th.style.width = "200px";
            tr.appendChild(th);
            buI = document.createElement("input");
            buI.style.fontFamily = "inherit";
            buI.style.margin = "0px";
            buI.style.width = "200px";
            buI.type = "file";
            buI.onchange = imgFile0;
            th.appendChild(buI);

            camSuccess = function(stream)
            {
                camBut9.innerHTML = "stop camera";
                camStrm9           = stream;
                camElem9.srcObject = stream;
                camElem9.onloadedmetadata = camSuccess2;
            }
            camSuccess2 = function()
            {
                camElem9.play();

                gl.deleteTexture(tX9[13]);
                gl.activeTexture(gl.TEXTURE0+13);   
                tX9[13] = gl.createTexture();
                gl.bindTexture(gl.TEXTURE_2D, tX9[13]);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
                //gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, camElem9);

                ldTxSZ9[0] = camElem9.videoWidth ;
                ldTxSZ9[1] = camElem9.videoHeight;

                rendC9GL();
            }
            iniCam = function()
            {
                if(camStrm9 == null)
                {
                    navigator.mediaDevices.getUserMedia({audio: false, video: { width: 99999 }}).then(camSuccess);
                }
                else
                {
                    camStrm9.getTracks().forEach(track => track.stop());
                    camStrm9 = null;
                    camBut9.innerHTML = "camera";
                }
            }
            camElem9 = document.createElement("video");
            //th = document.createElement("th");
            //tr.appendChild(th);
            buI = document.createElement("button");
            buI.style.fontFamily = "inherit";
            buI.style.margin = "0px";
            buI.style.width = "200px";
            buI.innerHTML = "camera";
            buI.onclick = iniCam;
            th.appendChild(buI);
            camBut9 = buI;

            //html for texture resolution changes
            rezCh9 = new Array(2);
            th = document.createElement("th");
            th.style.width = "200px";
            tr.appendChild(th);
            buI = document.createElement("pre");
            buI.style.margin = "0px";
            buI.style.fontFamily = "inherit";
            buI.style.fontWeight = "normal";
            buI.style.fontSize = "20px";
            buI.innerHTML = "rez = "+ (1<<xy2D);
            th.appendChild(buI);
            rezCh9[0] = buI;

            inixy2D = function()
            {
                var f   = tX9[6] == null;
                var xyZ = 1<<xy2D;
                var dat = new Uint8Array(xyZ*xyZ*4);
                var w = 0;
                for(var i = 0; i <    xyZ; ++i)
                {
                    var i2 = i|0;
                    var ai = 0|0;
                    var bi = xy2D;
                    while(i2 != 0|0)//reverse bits in "i"
                    {
                        --bi;
                        ai = ai | ((i2&1)<<bi); 
                        i2 = i2>>1;
                    }
                    bi = ai >> 8;
                    ai = ai & 255;

                    for(var j = 0; j < xyZ; ++j)
                    {
                        var j2 = j|0;
                        var aj = 0|0;
                        var bj = xy2D;
                        while(j2 != 0|0)//reverse bits in "j"
                        {
                            --bj;
                            aj = aj | ((j2&1)<<bj); 
                            j2 = j2>>1;
                        }
                        bj = aj >> 8;
                        aj = aj & 255;

                        dat[w] = aj; ++w;
                        dat[w] = bj; ++w;
                        dat[w] = ai; ++w;
                        dat[w] = bi; ++w;
                    }
                }
                for(var i = 0; i < 6     ; ++i){tX9[ i] = texCreator(gl.RGBA,   xyZ,    xyZ, gl.FLOAT        , gl.NEAREST, null, gl.TEXTURE0+ i);}
                for(var i = 6; i <12 && f; ++i){tX9[ i] = texCreator(gl.RGBA, dfTx9,  dfTx9, gl.FLOAT        , gl.NEAREST, null, gl.TEXTURE0+ i);}//just to exist
                                                tX9[12] = texCreator(gl.RGBA,   xyZ,    xyZ, gl.UNSIGNED_BYTE, gl.NEAREST,  dat, gl.TEXTURE0+12);
                if(tX9[13]==null){              tX9[13] = texCreator(gl.RGBA,     1,      1, gl.UNSIGNED_BYTE, gl.NEAREST, null, gl.TEXTURE0+13);}//just to exist
                for(var i = 0; i < fB9.length; ++i){fB9[i] = frameBuffCreator(tX9[i]);}
                for(var i = 0; i <     6     ; ++i){fB9z[i] =   xyZ;}
                for(var i = 6; i <    12 && f; ++i){fB9z[i] = dfTx9;}
                gl.bindFramebuffer(gl.FRAMEBUFFER, null);
            }
            chngxy2D = function()
            {
                xy2D = rezCh9[1].value|0;
                var xyZ = 1<<xy2D;
                rezCh9[0].innerHTML = "rez = "+ xyZ;

                gl.bindFramebuffer(gl.FRAMEBUFFER, null);
                for(var i = 0; i < fB9.length; ++i){gl.deleteFramebuffer(fB9[ i]);}
                for(var i = 0; i <          6; ++i){gl.deleteTexture(    tX9[ i]);}
                                                    gl.deleteTexture(    tX9[12]);
                inixy2D();
                rnd7Tx9 = true;
                rendC9GL();
            }

            buI = document.createElement("input");
            buI.style.margin = "0px";
            buI.style.width = "150px";
            buI.type = "range";
            buI.min =   2;
            buI.max =   14;
            buI.value = xy2D;
            buI.step =  1;
            buI.oninput = chngxy2D;
            th.appendChild(buI);
            rezCh9[1] = buI;

            //html for viewing height change
            viewHeight9 = new Array(2);
            th = document.createElement("th");
            th.style.width = "200px";
            tr.appendChild(th);
            buI = document.createElement("pre");
            buI.style.margin = "0px";
            buI.style.fontFamily = "inherit";
            buI.style.fontWeight = "normal";
            buI.style.fontSize = "20px";
            buI.innerHTML = "view height";
            th.appendChild(buI);
            viewHeight9[0] = buI;
            chngY2D = function()
            {
                var a = viewHeight9[1].value*1;
                cnvsDiv9.style.height = a+"px";
                //cnvs9a.style.height = a+"px";
                var pxrt = window.devicePixelRatio;
                var rect = cnvs9a.getBoundingClientRect();
                cnvs9aX = rect.width *pxrt;
                cnvs9aY = rect.height*pxrt;
                cnvs0.width   = cnvs9aX;
                cnvs0.height  = cnvs9aY;
                cnvs9a.width  = cnvs9aX;
                cnvs9a.height = cnvs9aY;
                rendC9GL();
            }
            buI = document.createElement("input");
            buI.style.margin = "0px";
            buI.style.width = "150px";
            buI.type = "range";
            buI.min =   256;
            buI.max =   1024;
            buI.value = 512;
            buI.step =  1;
            buI.oninput = chngY2D;
            th.appendChild(buI);
            viewHeight9[1] = buI;

            //RGBA checkboxes
            rgba9  = new Array(4);
            rgba9o = new Float32Array(rgba9.length);
            th = document.createElement("th");
            th.style.width = "150px";
            tr.appendChild(th);
            buI = document.createElement("pre");
            buI.style.margin = "0px";
            buI.style.fontFamily = "inherit";
            buI.style.fontWeight = "normal";
            buI.style.fontSize = fnz;
            buI.innerHTML = "RGBA";
            th.appendChild(buI);
            for(var i = 0; i < rgba9o.length; ++i)
            {
                buI = document.createElement("input");
                buI.style.transform = "scale(1.5)";
                buI.style.margin = "0px 4px";
                buI.type = "checkbox";
                buI.checked = true;
                buI.value = true;
                buI.ii = i;
                buI.onchange = function(e)
                               {
                                   var i = e.target.ii;
                                   rgba9o[i] = rgba9[i].checked*1;
                                   rendC9GL();
                               };
                th.appendChild(buI);
                rgba9[i] = buI;
                rgba9o[i] = 1;
            }

            //brightness sliders
            bright9  = new Array(2);
            bright9o = new Float32Array(2);
            th = document.createElement("th");
            th.style.width = "150px";
            tr.appendChild(th);
            buI = document.createElement("input");
            buI.style.margin = "0px";
            buI.style.width = "150px";
            buI.type = "range";
            buI.min =   0;
            buI.max =   2;
            buI.value = 1;
            buI.step =  1/2048;
            buI.oninput = function(e){bright9o[0] = e.target.value*1;  rendC9GL();};
            th.appendChild(buI);
            bright9 [0] = buI;
            bright9o[0] = buI.value*1;
            buI = document.createElement("input");
            buI.style.margin = "0px";
            buI.style.width = "50px";
            buI.type = "range";
            buI.min =   0;
            buI.max =   1;
            buI.value = 0;
            buI.step =  1;
            buI.oninput = function(e){bright9o[1] = e.target.value*1;  rendC9GL();};
            th.appendChild(buI);
            bright9[1] = buI;

        tbl = document.createElement("table");
        tbl.style.marginLeft = "auto";
        tbl.style.marginRight = "auto";
        document.body.appendChild(tbl);

            tr = document.createElement("tr");
            tbl.appendChild(tr);

            th = document.createElement("th");
            tr.appendChild(th);
            buI = document.createElement("pre");
            buI.style.margin = "0px";
            buI.style.fontFamily = "inherit";
            buI.style.fontWeight = "normal";
            buI.style.fontSize = fnz;
            buI.innerHTML = "PAINT:";
            th.appendChild(buI);

            paint9  = new Array(4<<1);//shader    selector button 4sliders
            paint9o = new Float32Array(paint9.length>>1);
            for(var i = 0; i < (paint9.length>>1); ++i)
            {
                th = document.createElement("th");
                th.style.width = "150px";
                tr.appendChild(th);
                buI = document.createElement("pre");
                buI.style.margin = "0px";
                buI.style.fontFamily = "inherit";
                buI.style.fontWeight = "normal";
                buI.style.fontSize = "20px";
                buI.innerHTML = String.fromCharCode(97+i)+" = "+((i==1)/1024).toFixed(3);
                th.appendChild(buI);
                paint9[i<<1] = buI;
                buI = document.createElement("input");
                buI.style.margin = "0px";
                buI.style.width = "150px";
                buI.type = "range";
                buI.min =   0;
                buI.max =   1024;
                buI.value = (i==1)*128;
                buI.step =  1;
                buI.oninput = function(e)
                              {
                                  var a  = e.target.ii;
                                  var a2 = a<<1;
                                  var b  = paint9[a2+1].value*(1/1024);
                                  paint9[a2+0].innerHTML = String.fromCharCode(97+a)+" = "+b.toFixed(3);
                                  paint9o[a] = b;
                              };
                buI.ii = i;
                th.appendChild(buI);
                paint9[(i<<1)+1] = buI;

                paint9o[i] = parseFloat(buI.value)*(1/1024);
            }
            
            selChng9 = function()
            {
                var a = selhtml9.value;
                var b = shaderCode9[a].value;
                iniRndrStps9g(b);
            }
            th = document.createElement("th");
            th.style.width = "100px";
            tr.appendChild(th);
            buI = document.createElement("select");
            buI.onchange = selChng9;
            th.appendChild(buI);
            selhtml9 = buI;

            for(var i = 0; i < frSh9fun.length; ++i)
            {
                buI = document.createElement("option");
                buI.style.margin = "0px";
                buI.style.fontFamily = "inherit";
                //buI.style.fontWeight = "normal";
                //buI.style.fontSize = "20px";
                buI.value = i;
                buI.innerHTML = frSh9funTitle[i];
                selhtml9.appendChild(buI);
            }

            shaderCode9 = new Array(frSh9fun.length);
            spwnCode = function(e)
            {
                var i = e.target.ii;
                if( i!= 2){frSh9iW = i;}
                frSh9iV = !frSh9iV;
                         var vh = "visible"; var vs = "hidden";
                if(!frSh9iV){vh = "hidden";      vs = "visible";}

                document.body.style.overflow = vs;

                var a = selhtml9.value;
                if(frSh9iW==0){shaderCode9[a].style.visibility = vh;}
                if(frSh9iW==1){shaderCode9b.style.visibility   = vh;}
                               shaderCodeBck9.style.visibility = vh;
                if(!frSh9iV) //compile shader
                {
                    if(frSh9iW==0){iniRndrStps9g(shaderCode9[a].value);}
                    if(frSh9iW==1){iniShdr9b(shaderCode9b.value);}
                }
            };
            th = document.createElement("th");
            tr.appendChild(th);
            buI = document.createElement("button");
            buI.style.fontFamily = "inherit";
            buI.style.margin = "0px";
            buI.style.width = "70px";
            buI.innerHTML = "paint";
            buI.onclick = spwnCode;
            buI.ii = 0;
            th.appendChild(buI);

            th = document.createElement("th");
            tr.appendChild(th);
            buI = document.createElement("button");
            buI.style.fontFamily = "inherit";
            buI.style.margin = "0px";
            buI.style.width = "70px";
            buI.innerHTML = "wave";
            buI.onclick = spwnCode;
            buI.ii = 1;
            th.appendChild(buI);

            buI = document.createElement("div");
            buI.style.position = "fixed";
            buI.style.left  = "0px";
            buI.style.top   = "0px";
            buI.style.width = "100%";
            buI.style.height = "100%";
            buI.style.background = "rgba(100,100,100,0.5)";
            buI.style.zIndex = "1";
            buI.style.visibility = "hidden";
            buI.onclick = spwnCode;
            buI.ii = 2;
            document.body.appendChild(buI);
            shaderCodeBck9 = buI;

            for(var i = 0; i < frSh9fun.length+1; ++i)//+1 for the wave editor
            {
                buI = document.createElement("textarea");
                buI.style.whiteSpace = "pre";
                buI.style.wordWrap = "normal";
                buI.style.fontFamily = "inherit";
                buI.style.fontSize = "20px";
                buI.style.position = "fixed";
                buI.style.left  = "10%";
                buI.style.top   = "10%";
                buI.style.width = "80%";
                buI.style.height = "80%";
                buI.style.resize = "none";
                buI.style.background = "rgb(229,229,229)";
                buI.style.color = "rgb(0,0,0)";
                buI.style.zIndex = "2";
                buI.style.visibility = "hidden";
                buI.style.lineHeight = "100%";
                buI.spellcheck = false;
              //buI.oninput = runEqu;
              //buI.value = frSh9fun[i];
                document.body.appendChild(buI);
                if(i < frSh9fun.length){shaderCode9[i] = buI; buI.value = frSh9fun[i];}
                else                   {shaderCode9b   = buI; buI.value = frSh9bfun;}
            }

        tbl = document.createElement("table");
        tbl.style.marginLeft = "auto";
        tbl.style.marginRight = "auto";
        document.body.appendChild(tbl);

            realAmpl9  = new Array(2);    //amplitud|phase real|imaginary sliders
            realAmpl9o = new Float32Array(realAmpl9.length);
            tr = document.createElement("tr");
            tbl.appendChild(tr);
            for(var i = 0; i < realAmpl9.length; ++i)
            {
                th = document.createElement("th");
                th.style.width = "600px";
                tr.appendChild(th);
                buI = document.createElement("pre");
                buI.style.margin = "0px";
                buI.style.fontFamily = "inherit";
                buI.style.fontWeight = "normal";
                buI.style.fontSize = "20px";
                buI.innerHTML = "real|imaginary  OR  amplitude|phase";
                th.appendChild(buI);

                buI = document.createElement("input");
                buI.style.margin = "0px";
                buI.style.width = "200px";
                buI.type = "range";
                buI.min =   0;
                buI.max =   1;
                buI.value = 1;
                buI.step =  1;
                buI.ii   =  i;
                buI.oninput = function(e)
                              {
                                  realAmpl9o[e.target.ii] = e.target.value*1;
                                  rendC9GL();
                              };
                th.appendChild(buI);
                realAmpl9[i] = buI;
                realAmpl9o[i] = 1;
            }

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "100%";    
        dv1.style.height = "500px";
        dv1.style.margin = "0px auto 0px auto";
        document.body.appendChild(dv1);
        cnvsDiv9 = dv1;

        cnvs9a = document.createElement("canvas");
        cnvs9a.style.position = "absolute";
        cnvs9a.style.border = "0px";
        cnvs9a.style.margin = "0px";
        cnvs9a.style.width = "100%"; 
        cnvs9a.style.height = "100%";
        dv1.appendChild(cnvs9a);
        cntx9a = cnvs9a.getContext("2d");

            touchStart9 = function(e)
            {
                e.preventDefault();
                let rec = e.target.getBoundingClientRect();
                let l = e.touches;
                let wd = 4/rec.width;
                inpX9 = (                      l[0].clientX-rec.left)*wd;
                inpY9 = (rec.top +rec.height-1-l[0].clientY         )*wd;
                camG = 3*(inpX9 >= 2);
                
                if(l.length >= 3)
                {
                    rnd7Tx9 = true;
                    rendC9GL();
                }
                if(l.length == 2)
                {
                    inpX92 = (                      l[1].clientX-rec.left)*wd;
                    inpY92 = (rec.top +rec.height-1-l[1].clientY         )*wd;
                }
                if(l.length == 1)
                {
                    inpXd9 = 0;
                    inpYd9 = 0;
                    paintDo9 = true;   holdI = true;
                    rendC9GL();
                }
            };
            touchEnd9 = function(e)
            {
                holdI = false;
                e.preventDefault();
            };
            touchMove9 = function(e)
            {
                e.preventDefault();
                let rec = e.target.getBoundingClientRect();
                let l = e.touches;
                let wd = 4/rec.width;
                let x = (                      l[0].clientX-rec.left)*wd;
                let y = (rec.top +rec.height-1-l[0].clientY         )*wd;
                let dx = x-inpX9;
                let dy = y-inpY9;
                inpXd9 -= dx;
                inpYd9 -= dy;
                inpX9 = x;
                inpY9 = y;

                if(l.length >= 2)
                {
                    let l0 = Math.sqrt(Math.pow(inpX9-inpX92,2) + 
                                       Math.pow(inpY9-inpY92,2));

                    cam9[camG+0] -= dx*cam9[camG+2];
                    cam9[camG+1] -= dy*cam9[camG+2];

                    inpX92 = (                      l[1].clientX-rec.left)*wd;
                    inpY92 = (rec.top +rec.height-1-l[1].clientY         )*wd;

                    let l1 = Math.sqrt(Math.pow(inpX9-inpX92,2) + 
                                       Math.pow(inpY9-inpY92,2));

                    let ix = inpX9; //ix = ix-Math.floor(ix);
                    let iy = inpY9;
                    x = cam9[camG+0] + ix*cam9[camG+2];
                    y = cam9[camG+1] + iy*cam9[camG+2];
                    cam9[camG+2] *= l0/l1;
                    cam9[camG+0] = x - ix*cam9[camG+2];
                    cam9[camG+1] = y - iy*cam9[camG+2];
                }
                if(l.length == 1)
                {
                    paintDo9 = true;
                }
                rendC9GL();
            };
            
            mouseDown9 = function(e)
            {
                e.preventDefault();
                
                let b = e.button;
                if(b==0) mosP[0] = 1;
                if(b==2) mosP[1] = 1;

                let rec = e.target.getBoundingClientRect();
                let wd = 4/rec.width;
                let x = (                      e.clientX-rec.left)*wd;
                let y = (rec.top +rec.height-1-e.clientY         )*wd;
                inpX9 = x;
                inpY9 = y;
                camG = 3*(inpX9 >= 2);

                if(b==1)
                {
                    rnd7Tx9 = true;
                    rendC9GL();
                }
                if(mosP[1]!=0)
                {
                    inpXd9 = 0;
                    inpYd9 = 0;
                    paintDo9 = true;   holdI = true;
                    rendC9GL();
                }
            };
            mouseUp9 = function(e)
            {
                e.preventDefault();
                let b = e.button;
                if(b==0) {mosP[0] = 0;}
                if(b==2) {mosP[1] = 0; holdI = false;}
            };
            mouseMove9 = function(e)
            {
                let rec = e.target.getBoundingClientRect();
                let wd = 4/rec.width;
                let x = (                      e.clientX-rec.left)*wd;
                let y = (rec.top +rec.height-1-e.clientY         )*wd;
                let dx = x-inpX9;
                let dy = y-inpY9;
                inpXd9 -= dx;
                inpYd9 -= dy;
                inpX9 = x;
                inpY9 = y;

                if(mosP[0] != 0)
                {
                    cam9[camG+0] -= dx*cam9[camG+2];
                    cam9[camG+1] -= dy*cam9[camG+2];
                    rendC9GL();
                }
                if(mosP[1] != 0)
                {
                    paintDo9 = true;
                    rendC9GL();
                }
            };
            mouseWheel9 = function(e)
            {
                e.preventDefault();

                camG = 3*(inpX9 >= 2);
                let ix = inpX9; ix = ix-Math.floor(ix);
                let iy = inpY9;
                let x = cam9[camG+0] + ix*cam9[camG+2];
                let y = cam9[camG+1] + iy*cam9[camG+2];
                if(e.deltaY>0) cam9[camG+2] *=   1.125;
                if(e.deltaY<0) cam9[camG+2] *= 1/1.125;
                cam9[camG+0] = x - ix*cam9[camG+2];
                cam9[camG+1] = y - iy*cam9[camG+2];

                rendC9GL();
            };
            
            cnvs9a.addEventListener("touchstart",  touchStart9,  true);
            cnvs9a.addEventListener("touchend",    touchEnd9,    true);
            cnvs9a.addEventListener("touchcancel", touchEnd9,    true);
            cnvs9a.addEventListener("touchmove",   touchMove9,   true);

            cnvs9a.addEventListener("mousedown",   mouseDown9,   true);
            cnvs9a.addEventListener("mouseup",     mouseUp9,     true);
            cnvs9a.addEventListener("mouseout",    mouseUp9,     true);
            cnvs9a.addEventListener("mouseleave",  mouseUp9,     true);
            cnvs9a.addEventListener("mousemove",   mouseMove9,   true);
            cnvs9a.addEventListener("wheel",       mouseWheel9,  true);

            cnvs9a.addEventListener("contextmenu", event => event.preventDefault());

            drop = function(e)
            {
                e.preventDefault();
                if(e.dataTransfer.files.length!=0) {imgEml9.src = URL.createObjectURL(e.dataTransfer.files[0]);}
                else                               {imgEml9.src = e.dataTransfer.getData("URL");}
                imgEml9.onload = imgFile1;
                cam9[0] = 0;
                cam9[1] = 0;
                cam9[2] = 1;

                cam9[3] = 0;
                cam9[4] = 0;
                cam9[5] = 1;
            }
            drop2 = function(e)
            {
                e.preventDefault();
            }
            cnvs9a.ondrop = drop;
            cnvs9a.ondragover = drop2;

        tbl = document.createElement("table");
        //tbl.style.marginLeft = "auto";
        //tbl.style.marginRight = "auto";
        tbl.style.width = "100%";
        document.body.appendChild(tbl);

            tr = document.createElement("tr");
            tbl.appendChild(tr);

            getImg9 = function(e)
            {
                var ii = e.target.ii|0;
                var i1 = (ii & (~1)) +0;
                var i2 = (ii & (~1)) +1;
                
                var xl = 1<<xy2D;
                var sz = (xl*xl)|0;
                var pix1 = new Float32Array(sz<<2);
                var pix2 = new Float32Array(sz<<2);
                gl.bindFramebuffer(gl.FRAMEBUFFER, fB9[i1]);  gl.readPixels(0, 0, xl, xl, gl.RGBA, gl.FLOAT, pix1);
                gl.bindFramebuffer(gl.FRAMEBUFFER, fB9[i2]);  gl.readPixels(0, 0, xl, xl, gl.RGBA, gl.FLOAT, pix2);
                gl.bindFramebuffer(gl.FRAMEBUFFER, null);

                if(cnvDwnl[0] == null)
                {
                    cnvDwnl[0] = document.createElement('canvas');
                    cnvDwnl[1] = cnvDwnl[0].getContext('2d');

                    hidImg = function(){ cnvDwnl[3].style.visibility = "hidden"; }
                    
                    var buI;
                    buI = document.createElement("div");
                    buI.style.position = "fixed";
                    buI.style.left  = "0px";
                    buI.style.top   = "0px";
                    buI.style.width = "100%";
                    buI.style.height = "100%";
                    buI.style.background = "rgba(100,100,100,0.5)";
                    buI.style.zIndex = "1";
                    buI.onclick = hidImg;
                    document.body.appendChild(buI);
                    cnvDwnl[3] = buI;

                    cnvDwnl[2] = new Image();
                    cnvDwnl[2].style.position = "absolute";
                    cnvDwnl[2].style.left = "50%";
                    cnvDwnl[2].style.top = "50%";
                    //cnvDwnl[2].style.width = "100%";
                    cnvDwnl[2].style.height = "100%";
                    cnvDwnl[2].style.transform = "translate(-50%, -50%)";
                    cnvDwnl[2].style.margin = "auto";
                    buI.appendChild(cnvDwnl[2]);

                    var a = document.createElement("pre");
                    a.style.position = "absolute";
                    a.style.left = "50%";
                    a.style.top = "50%";
                    a.style.transform = "translate(-50%, -50%)";
                    a.style.color = "black";
                    a.style.textShadow = "1px 1px white";
                    a.style.pointerEvents = "none";
                    a.style.fontFamily = "inherit";
                    a.style.fontWeight = "bold";
                    a.style.fontSize = "20px";
                    a.innerHTML = "right click to copy or download";// \n may look empty because of the image transparency";
                    buI.appendChild(a);
                }

                cnvDwnl[0].height = xl;
                cnvDwnl[0].width  = xl;
                var imgDt = cnvDwnl[1].createImageData(xl, xl);

                var ri = realAmpl9[ii>>1].value|0; //ampPhase or realImag
                    ri = (ri<<1) + (ii&1);
                if(ri == 0)
                {
                    for(var i = 0; i < sz; ++i)//real
                    {
                        var i4 = i<<2;
                        var r0 = pix1[i4+0];
                        var r1 = pix1[i4+1];
                        var g0 = pix1[i4+2];
                        var g1 = pix1[i4+3];
                        var b0 = pix2[i4+0];
                        var b1 = pix2[i4+1];
                        var a0 = pix2[i4+2];
                        var a1 = pix2[i4+3];
                        var r2 = r0*.5+.5;  r2 *= 255;
                        var g2 = g0*.5+.5;  g2 *= 255;
                        var b2 = b0*.5+.5;  b2 *= 255;
                        var a2 = a0*.5+.5;  a2 *= 255; a2 = 255;
                        imgDt.data[i4+0] = r2;
                        imgDt.data[i4+1] = g2;
                        imgDt.data[i4+2] = b2;
                        imgDt.data[i4+3] = a2;
                    }
                }
                if(ri == 1)
                {
                    for(var i = 0; i < sz; ++i)//imaginary
                    {
                        var i4 = i<<2;
                        var r0 = pix1[i4+0];
                        var r1 = pix1[i4+1];
                        var g0 = pix1[i4+2];
                        var g1 = pix1[i4+3];
                        var b0 = pix2[i4+0];
                        var b1 = pix2[i4+1];
                        var a0 = pix2[i4+2];
                        var a1 = pix2[i4+3];
                        var r2 = r1*.5+.5;  r2 *= 255;
                        var g2 = g1*.5+.5;  g2 *= 255;
                        var b2 = b1*.5+.5;  b2 *= 255;
                        var a2 = a1*.5+.5;  a2 *= 255; a2 = 255;
                        imgDt.data[i4+0] = r2;
                        imgDt.data[i4+1] = g2;
                        imgDt.data[i4+2] = b2;
                        imgDt.data[i4+3] = a2;
                    }
                }
                if(ri == 2)
                {
                    for(var i = 0; i < sz; ++i)//amplitud
                    {
                        var i4 = i<<2;
                        var r0 = pix1[i4+0];
                        var r1 = pix1[i4+1];
                        var g0 = pix1[i4+2];
                        var g1 = pix1[i4+3];
                        var b0 = pix2[i4+0];
                        var b1 = pix2[i4+1];
                        var a0 = pix2[i4+2];
                        var a1 = pix2[i4+3];
                        var r2 = Math.sqrt(r0*r0 + r1*r1);  r2 *= 255;
                        var g2 = Math.sqrt(g0*g0 + g1*g1);  g2 *= 255;
                        var b2 = Math.sqrt(b0*b0 + b1*b1);  b2 *= 255;
                        var a2 = Math.sqrt(a0*a0 + a1*a1);  a2 *= 255; a2 = 255;
                        imgDt.data[i4+0] = r2;
                        imgDt.data[i4+1] = g2;
                        imgDt.data[i4+2] = b2;
                        imgDt.data[i4+3] = a2;
                    }
                }
                if(ri == 3)
                {
                    for(var i = 0; i < sz; ++i)//phase
                    {
                        var i4 = i<<2;
                        var r0 = pix1[i4+0];
                        var r1 = pix1[i4+1];
                        var g0 = pix1[i4+2];
                        var g1 = pix1[i4+3];
                        var b0 = pix2[i4+0];
                        var b1 = pix2[i4+1];
                        var a0 = pix2[i4+2];
                        var a1 = pix2[i4+3];
                        var r2 = Math.atan2(r1,r0);  r2 = (r2+PI)*(1/(PI*2)) * 255;
                        var g2 = Math.atan2(g1,g0);  g2 = (g2+PI)*(1/(PI*2)) * 255;
                        var b2 = Math.atan2(b1,b0);  b2 = (b2+PI)*(1/(PI*2)) * 255;
                        var a2 = Math.atan2(a1,a0);  a2 = (a2+PI)*(1/(PI*2)) * 255; a2 = 255;
                        imgDt.data[i4+0] = r2;
                        imgDt.data[i4+1] = g2;
                        imgDt.data[i4+2] = b2;
                        imgDt.data[i4+3] = a2;
                    }
                }

                //for(var i = 0; i <  xl    ; ++i){//flip image y axis
                //for(var j = 0; j < (xl>>1); ++j){
                //    var i4 = (i*xl+      j )<<2;
                //    var j4 = (i*xl+(xl-1-j))<<2;
                //    
                //    var a1 = imgDt.data[i4+0];
                //    var a2 = imgDt.data[i4+1];
                //    var a3 = imgDt.data[i4+2];
                //    var a4 = imgDt.data[i4+3];

                //    var b1 = imgDt.data[j4+0];
                //    var b2 = imgDt.data[j4+1];
                //    var b3 = imgDt.data[j4+2];
                //    var b4 = imgDt.data[j4+3];
                //    
                //    imgDt.data[i4+0] = b1;
                //    imgDt.data[i4+1] = b2;
                //    imgDt.data[i4+2] = b3;
                //    imgDt.data[i4+3] = b4;

                //    imgDt.data[j4+0] = a1;
                //    imgDt.data[j4+1] = a2;
                //    imgDt.data[j4+2] = a3;
                //    imgDt.data[j4+3] = a4;
                //}}
                for(var i = 0; i < (xl>>1); ++i){//flip image x axis
                for(var j = 0; j <  xl    ; ++j){
                    var i4 = (      i *xl+j)<<2;
                    var j4 = ((xl-1-i)*xl+j)<<2;
                    
                    var a1 = imgDt.data[i4+0];
                    var a2 = imgDt.data[i4+1];
                    var a3 = imgDt.data[i4+2];
                    var a4 = imgDt.data[i4+3];

                    var b1 = imgDt.data[j4+0];
                    var b2 = imgDt.data[j4+1];
                    var b3 = imgDt.data[j4+2];
                    var b4 = imgDt.data[j4+3];
                    
                    imgDt.data[i4+0] = b1;
                    imgDt.data[i4+1] = b2;
                    imgDt.data[i4+2] = b3;
                    imgDt.data[i4+3] = b4;

                    imgDt.data[j4+0] = a1;
                    imgDt.data[j4+1] = a2;
                    imgDt.data[j4+2] = a3;
                    imgDt.data[j4+3] = a4;
                }}

                cnvDwnl[1].putImageData(imgDt, 0, 0);
                cnvDwnl[2].src = cnvDwnl[0].toDataURL('image/png');
                cnvDwnl[3].style.visibility = "visible";
            }
            for(var i = 0; i < 4; ++i)
            {
                th = document.createElement("th");
                tr.appendChild(th);
                buI = document.createElement("button");
                buI.style.fontFamily = "inherit";
                buI.style.margin = "0px";
                buI.style.width = "150px";
                buI.innerHTML = "tex"+i+" get image";
                buI.onclick = getImg9;
                buI.ii = i;
                th.appendChild(buI);
                imgDwBu[i] = buI;
            }

        dv1 = document.createElement("div");
        dv1.style.position = "relative";
        dv1.style.width = "100%";    
        dv1.style.height = "256px";
        dv1.style.margin = "0px auto 0px auto";
        document.body.appendChild(dv1);

        cnvs9b = document.createElement("canvas");
        cnvs9b.style.position = "absolute";
        cnvs9b.style.border = "0px";
        cnvs9b.style.margin = "0px";
        cnvs9b.style.width = "100%"; 
        cnvs9b.style.height = "100%";
        cnvs9b.onclick = render9dGl;
        dv1.appendChild(cnvs9b);
        cntx9b = cnvs9b.getContext("2d");
        
            resizeText9 = function(e)
            {
                var ii = e.target.ii+4;
                var xl = 1<<xy2D;

                e.target.innerHTML = "tex"+ii+" resize " + xl;

                fB9z[ii] = xl;

                gl.bindFramebuffer(gl.FRAMEBUFFER, null);
                gl.deleteTexture(tX9[ii]);
                tX9[ii] = texCreator(gl.RGBA, xl,xl, gl.FLOAT, gl.NEAREST, null, gl.TEXTURE0+ii);
                fB9[ii] = frameBuffCreator(tX9[ii]);
                gl.bindFramebuffer(gl.FRAMEBUFFER, null);
                render9dGl();
            }

            tbl = document.createElement("table");
            tbl.style.width = "100%";
            document.body.appendChild(tbl);
            tr = document.createElement("tr");
            tbl.appendChild(tr);
            //for(let i = 0; i < 8; ++i)
            //{
            //    th = document.createElement("th");
            //    tr.appendChild(th);
            //    buI = document.createElement("div");
            //    buI.style.fontFamily = "inherit";
            //    buI.innerHTML = "tex"+(4+i);
            //    th.appendChild(buI);
            //}
            //tr = document.createElement("tr");
            //tbl.appendChild(tr);
            for(var i = 0; i < 8; ++i)
            {
                th = document.createElement("th");
              //th.colSpan = "2";
                tr.appendChild(th);
                buI = document.createElement("button");
                buI.style.fontFamily = "inherit";
                buI.style.margin = "0px";
                buI.style.width = "200px";
                if(i<2){
                buI.innerHTML = "tex"+(4+i)+" size rez";
                buI.disabled = true;
                }else{
                buI.innerHTML = "tex"+(4+i)+" resize " + dfTx9;
                buI.onclick = resizeText9;
                }
                buI.ii = i;
                th.appendChild(buI);
            }

        if(false)
        {
            tr = document.createElement("tr");
            tbl.appendChild(tr);
            for(let i = 0; i < 4; ++i)
            {
                th = document.createElement("th");
                tr.appendChild(th);
                buI = document.createElement("div");
                buI.style.fontFamily = "inherit";
                buI.innerHTML = "copy image into";
                th.appendChild(buI);
            }

            tr = document.createElement("tr");
            tbl.appendChild(tr);

            copyText9 = function(e)
            {
                var ii = e.target.ii|0;
                var i1 = (ii & (~1)) +0;
                var i2 = (ii & (~1)) +1;
                
                var xl = 1<<xy2D;
                var sz = (xl*xl)|0;
                var pix1 = new Float32Array(sz<<2);
                var pix2 = new Float32Array(sz<<2);
                gl.bindFramebuffer(gl.FRAMEBUFFER, fB9[i1]);  gl.readPixels(0, 0, xl, xl, gl.RGBA, gl.FLOAT, pix1);
                gl.bindFramebuffer(gl.FRAMEBUFFER, fB9[i2]);  gl.readPixels(0, 0, xl, xl, gl.RGBA, gl.FLOAT, pix2);
                gl.bindFramebuffer(gl.FRAMEBUFFER, null);

                var ri = realAmpl9[ii>>1].value|0; //ampPhase or realImag
                    ri = (ri<<1) + (ii&1);
                if(ri == 0)
                {
                    for(var i = 0; i < sz; ++i)//real
                    {
                        var i4 = i<<2;
                        var r0 = pix1[i4+0];
                        var r1 = pix1[i4+1];
                        var g0 = pix1[i4+2];
                        var g1 = pix1[i4+3];
                        var b0 = pix2[i4+0];
                        var b1 = pix2[i4+1];
                        var a0 = pix2[i4+2];
                        var a1 = pix2[i4+3];
                        var r2 = r0;
                        var g2 = g0;
                        var b2 = b0;
                        var a2 = a0;
                        pix1[i4+0] = r2;
                        pix1[i4+1] = g2;
                        pix1[i4+2] = b2;
                        pix1[i4+3] = a2;
                    }
                }
                if(ri == 1)
                {
                    for(var i = 0; i < sz; ++i)//imaginary
                    {
                        var i4 = i<<2;
                        var r0 = pix1[i4+0];
                        var r1 = pix1[i4+1];
                        var g0 = pix1[i4+2];
                        var g1 = pix1[i4+3];
                        var b0 = pix2[i4+0];
                        var b1 = pix2[i4+1];
                        var a0 = pix2[i4+2];
                        var a1 = pix2[i4+3];
                        var r2 = r1;
                        var g2 = g1;
                        var b2 = b1;
                        var a2 = a1;
                        pix1[i4+0] = r2;
                        pix1[i4+1] = g2;
                        pix1[i4+2] = b2;
                        pix1[i4+3] = a2;
                    }
                }
                if(ri == 2)
                {
                    for(var i = 0; i < sz; ++i)//amplitud
                    {
                        var i4 = i<<2;
                        var r0 = pix1[i4+0];
                        var r1 = pix1[i4+1];
                        var g0 = pix1[i4+2];
                        var g1 = pix1[i4+3];
                        var b0 = pix2[i4+0];
                        var b1 = pix2[i4+1];
                        var a0 = pix2[i4+2];
                        var a1 = pix2[i4+3];
                        var r2 = Math.sqrt(r0*r0 + r1*r1);
                        var g2 = Math.sqrt(g0*g0 + g1*g1);
                        var b2 = Math.sqrt(b0*b0 + b1*b1);
                        var a2 = Math.sqrt(a0*a0 + a1*a1);
                        pix1[i4+0] = r2;
                        pix1[i4+1] = g2;
                        pix1[i4+2] = b2;
                        pix1[i4+3] = a2;
                    }
                }
                if(ri == 3)
                {
                    for(var i = 0; i < sz; ++i)//phase
                    {
                        var i4 = i<<2;
                        var r0 = pix1[i4+0];
                        var r1 = pix1[i4+1];
                        var g0 = pix1[i4+2];
                        var g1 = pix1[i4+3];
                        var b0 = pix2[i4+0];
                        var b1 = pix2[i4+1];
                        var a0 = pix2[i4+2];
                        var a1 = pix2[i4+3];
                        var r2 = Math.atan2(r1,r0);
                        var g2 = Math.atan2(g1,g0);
                        var b2 = Math.atan2(b1,b0);
                        var a2 = Math.atan2(a1,a0);
                        pix1[i4+0] = r2;
                        pix1[i4+1] = g2;
                        pix1[i4+2] = b2;
                        pix1[i4+3] = a2;
                    }
                }

                var md = e.target.jj + 6;
                gl.deleteTexture(tX9[md]);
                tX9[md] = texCreator(gl.RGBA, xl,xl, gl.FLOAT, gl.NEAREST, pix1, gl.TEXTURE0+md);

                render9dGl();
            }
            
            for(let i = 0; i < 4; ++i)
            {
                th = document.createElement("th");
                tr.appendChild(th);
                for(let j = 0; j < 6; ++j)
                {
                    buI = document.createElement("button");
                    buI.style.fontFamily = "inherit";
                    buI.style.margin = "0px";
                    buI.style.width = "50px";
                    buI.innerHTML = "Tex"+(j+1);
                    buI.onclick = copyText9;
                    buI.ii = i;
                    buI.jj = j;
                    th.appendChild(buI);
                }
            }

            tr = document.createElement("tr");
            tbl.appendChild(tr);
            
            rawcopyText9 = function(e)
            {
                var ii = e.target.ii<<1;
                var xl = 1<<xy2D;
                var md = (e.target.jj<<1) + 6;
                gl.deleteTexture(tX9[md+0]);
                gl.deleteTexture(tX9[md+1]);
                tX9[md+0] = texCreator(gl.RGBA, xl,xl, gl.FLOAT, gl.NEAREST, null, gl.TEXTURE0+md+0);
                tX9[md+1] = texCreator(gl.RGBA, xl,xl, gl.FLOAT, gl.NEAREST, null, gl.TEXTURE0+md+1);
                fB9[md+0] = frameBuffCreator(tX9[md+0]);
                fB9[md+1] = frameBuffCreator(tX9[md+1]);
                copy2D(md+0, ii+0);
                copy2D(md+1, ii+1);
                gl.bindFramebuffer(gl.FRAMEBUFFER, null);

                render9dGl();
            }
            
            for(let i = 0; i < 2; ++i)
            {
                th = document.createElement("th");
                //th.colspan = "2";
                th.colSpan = "2";
                tr.appendChild(th);
                for(let j = 0; j < 3; ++j)
                {
                    var j2 = j << 1;
                    buI = document.createElement("button");
                    buI.style.fontFamily = "inherit";
                    buI.style.margin = "0px";
                    buI.style.width = "100px"; 
                    buI.innerHTML = "Tex"+(j2+1+0) + "&Tex"+(j2+1+1);
                    buI.onclick = rawcopyText9;
                    buI.ii = i;
                    buI.jj = j;
                    th.appendChild(buI);
                }
            }
        }

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = fnz;
        buI.style.margin = "20px 0px 200px 0px";
        buI.style.textAlign = "center";
        buI.innerHTML = "left   click to move  \n"+
                        "rigth  click to paint \n"+
                        "middle click to reset \n"+
                        "scroll       to zoom  \n"+
                        "1 finger  to paint    \n"+
                        "2 fingers to move|zoom\n"+
                        "3 fingers to reset    \n"+
                        "\n"+
                        //"there are 4 different images, from left to right:\n"+
                        //"the  \"z\"  of z*e<sup>i*&#120587;*2*(x+y)</sup> of the uploaded    image\n"+
                        //"the \"x+y\" of z*e<sup>i*&#120587;*2*(x+y)</sup> of the uploaded    image\n"+
                        //"the  \"z\"  of z*e<sup>i*&#120587;*2*(x+y)</sup> of the transformed image\n"+
                        //"the \"x+y\" of z*e<sup>i*&#120587;*2*(x+y)</sup> of the transformed image\n"+
                        //"\n"+
                        "painting in the uploaded    image automatically affects the other side\n"+
                        "painting in the transformed image automatically affects the other side\n"+
                        "applying the fourier transform to the transformed image results in the original image\n"+
                        "\n"+
                        "you can load sound files too                 \n"+
                        "all sound samples are put in one texture     \n"+
                        "like fitting letters of a story into a page  \n"+
                        "left  sound channel is put in the green color\n"+
                        "right sound channel is put in the blue  color\n"+
                        "\n"+
                        "\n"+
                        "\n"+
                        "\n"+
                        "this page was created using:                                              \n"+
                        "https://en.wikipedia.org/wiki/Fourier_transform                           \n"+
                        "https://teacher.desmos.com/activitybuilder/custom/560715c89e31647835a5c084\n"+
                        "https://www.youtube.com/watch?v=spUNpyF58BY                               \n"+
                        "https://www.youtube.com/watch?v=EsJGuI7e_ZQ                               \n"+
                        "https://homepages.inf.ed.ac.uk/rbf/HIPR2/fourier.htm                      \n";
        document.body.appendChild(buI);

        var jvscrptFT = `
    function wave(a)
    {
        return Math.cos(a);
        //return Math.asin(Math.cos(a))/pi2;
        //return (Math.cos(a)>=0)*2-1;
    }
    function dft1D(sgn,p,dou,din)//one dimension discrete fourier tranform
    {
        //din is Float64Array input  
        //dou is Float64Array output
        //Float64Array has real|imaginary pairs
        //2*2^p is the length of din and dou
        //sgn = -1 to tranform din into the frequency domain
        //    =  1 to tranform din into the time      domain
        var pi  = 3.1415926535897932384626433832795;
        var pi2 = pi*.5;
    
        var sz = 1 << p;
        var dv = 1/Math.sqrt(sz);
        var w = 0;
        for(var j = 0; j < sz; ++j)
        {
            var r  = 0;
            var s0 = 0;
            var s1 = 0;
            for(var i = 0; i < sz; ++i)
            {
                var ax = din[r];  ++r;
                var ay = din[r];  ++r;
                var b  = sgn * pi*2*i/sz*j;
                var bx = wave(b    );
                var by = wave(b-pi2);
                s0 += ax*bx - ay*by;
                s1 += ax*by + ay*bx;
            }
            dou[w] = s0*dv;  ++w;
            dou[w] = s1*dv;  ++w;
        }
    }
    function dft2D(sgn,p,dou,din)//two dimension discrete fourier tranform
    {
        //din is Float64Array input  
        //dou is Float64Array output
        //Float64Array has real|imaginary pairs
        //2*2^p*2^p is the length of din and dou
        //sgn = -1 to tranform din into the frequency domain
        //    =  1 to tranform din into the time      domain
        var pi  = 3.1415926535897932384626433832795;
        var pi2 = pi*.5;
    
        var sz = 1 << p;
        var dv = 1/sz;
        var w  = 0;
        for(var jj = 0; jj < sz; ++jj)
        {
        for(var ii = 0; ii < sz; ++ii)
        {
            var r  = 0;
            var s0 = 0;
            var s1 = 0;
            for(var j = 0; j < sz; ++j)
            {
            for(var i = 0; i < sz; ++i)
            {
                var ax = din[r];  ++r;
                var ay = din[r];  ++r;
                var b  = sgn * pi*2*(i/sz*ii+j/sz*jj);
                var bx = wave(b    );
                var by = wave(b-pi2);
                s0 += ax*bx - ay*by;
                s1 += ax*by + ay*bx;
            }
            }
            dou[w] = s0*dv;  ++w;
            dou[w] = s1*dv;  ++w;
        }
        }
    }
    function fft1D(sgn,p,dou,din)//one dimension fast fourier tranform
    {
        //din is Float64Array input  
        //dou is Float64Array output
        //Float64Array has real|imaginary pairs
        //2*2^p is the length of din and dou
        //sgn = -1 to tranform din into the frequency domain
        //    =  1 to tranform din into the time      domain
        var pi  = 3.1415926535897932384626433832795;
        var pi2 = pi*.5;
    
        var sz = 1 << p;
        var tm  = null;
        var nwd = new Float64Array(sz<<1);
        if((p&1)==0){tm = [dou,nwd];}
        else        {tm = [nwd,dou];}
        var dv = 1/Math.sqrt(sz);
        var w  = 0|0;
        var w0 = 0|0;
        var w1 = 1|0;
        var da0 = tm[w0];
        var da1 = tm[w1];
    
        var an  = 1|0;
        var an1 = 0|0;
        var cc  = 0|0;
        var msk = (sz-1)|0;
        var sft = (1<<31)>>(32-p);
        for(var i = 0|0; i < sz; i=(i+1)|0)//interlace and normalize
        {
            var ki = (an1/an)|0;
            var ko = (((ki<<1)+1)*an - an1)|0;              //https://oeis.org/search?q=0%2C1%2C0%2C2%2C0%2C1%2C0%2C3%2C0%2C1%2C0%2C2%2C0%2C1%2C0%2C4%2C&language=english&go=Search
            an1 = an;
            an  = ko;
            var r  = cc<<1;        cc = cc ^ ((sft>>ki)&msk);
            da0[w] = din[r  ]*dv;  w=(w+1)|0;
            da0[w] = din[r+1]*dv;  w=(w+1)|0;
        }
        for(var j = 0|0; j < p; j=(j+1)|0)//rotate and sum
        {
            w0  = (w0+1)&1;
            w1  = (w1+1)&1;
            da0 = tm[w0];
            da1 = tm[w1];
            var m0 = 1 << j;  var m4 = sgn*pi/m0;
            var m3 = ~m0;
            w = 0|0;
            for(var i = 0|0; i < sz; i=(i+1)|0)
            {
                var r  = i&m3;
                var r0 = (r   )<<1;
                var r1 = (r+m0)<<1;
                var ax = da1[r0  ];
                var ay = da1[r0+1];
                var bx = da1[r1  ];
                var by = da1[r1+1];
                var rot = i*m4;
                var rtx = wave(rot    );
                var rty = wave(rot-pi2);
                da0[w] = ax + bx*rtx - by*rty;  w=(w+1)|0;   
                da0[w] = ay + bx*rty + by*rtx;  w=(w+1)|0;
            }
        }
    }
    function fft2D(sgn,p,dou,din)//two dimension fast fourier tranform
    {
        //din is Float64Array input  
        //dou is Float64Array output
        //Float64Array has real|imaginary pairs
        //2*2^p*2^p is the length of din and dou
        //sgn = -1 to tranform din into the frequency domain
        //    =  1 to tranform din into the time      domain
        var pi = 3.1415926535897932384626433832795;
        var pi2 = pi*.5;
    
        var sz = 1 << p;
        var nwd = new Float64Array((sz*sz)<<1);
                 var tm = null;
        if((p&1)==0){tm = [dou,nwd];}
        else        {tm = [nwd,dou];}
        var dv = 1/sz;
        var w  = 0|0;
        var w0 = 0|0;
        var w1 = 1|0;
        var da0 = tm[w0];
        var da1 = tm[w1];
    
        var anJ  = 1|0;
        var an1J = 0|0;
        var ccJ  = 0|0;
        var msk = (sz-1)|0;
        var sft = (1<<31)>>(32-p);
        for(var j = 0|0; j < sz; j=(j+1)|0)
        {
            var kiJ = (an1J/anJ)|0;
            var koJ = (((kiJ<<1)+1)*anJ - an1J)|0;          //https://oeis.org/search?q=0%2C1%2C0%2C2%2C0%2C1%2C0%2C3%2C0%2C1%2C0%2C2%2C0%2C1%2C0%2C4%2C&language=english&go=Search
            an1J = anJ;
            anJ  = koJ;
            var rJ = ccJ;    ccJ = ccJ ^ ((sft>>kiJ)&msk);
        
            var anI  = 1|0;
            var an1I = 0|0;
            var ccI  = 0|0;
            for(var i = 0|0; i < sz; i=(i+1)|0)//interlace and normalize
            {
                var kiI = (an1I/anI)|0;
                var koI = (((kiI<<1)+1)*anI - an1I)|0;
                an1I = anI;
                anI  = koI;
                var rI = ccI;    ccI = ccI ^ ((sft>>kiI)&msk);
                var r  = ((rJ << p)+rI)<<1;    
                da0[w] = din[r  ]*dv;  w=(w+1)|0;
                da0[w] = din[r+1]*dv;  w=(w+1)|0;
            }
        }
        for(var n = 0|0; n < p; n=(n+1)|0)//rotate and sum
        {
            w0  = (w0+1)&1;
            w1  = (w1+1)&1;
            da0 = tm[w0];
            da1 = tm[w1];
            var m0 = 1 << n;  var m4 = sgn*pi/m0;
            var m3 = ~m0;
            w = 0|0;
            for(var j = 0|0; j < sz; j=(j+1)|0)
            {
            for(var i = 0|0; i < sz; i=(i+1)|0)
            {
                var rJ = j&m3;
                var rI = i&m3;
                var r0 = (((rJ   ) << p)+(rI   ))<<1;
                var r1 = (((rJ   ) << p)+(rI+m0))<<1;
                var r2 = (((rJ+m0) << p)+(rI   ))<<1;
                var r3 = (((rJ+m0) << p)+(rI+m0))<<1;
                var ax = da1[r0  ];
                var ay = da1[r0+1];
                var bx = da1[r1  ];
                var by = da1[r1+1];
                var cx = da1[r2  ];
                var cy = da1[r2+1];
                var dx = da1[r3  ];
                var dy = da1[r3+1];
                var rotI  = i*m4;
                var rotJ  = j*m4;
                var rotIJ = rotI+rotJ;
                var rbx = wave(rotI     );
                var rby = wave(rotI -pi2);
                var rcx = wave(rotJ     );
                var rcy = wave(rotJ -pi2);
                var rdx = wave(rotIJ    );
                var rdy = wave(rotIJ-pi2);
                da0[w] = ax + bx*rbx - by*rby
                            + cx*rcx - cy*rcy
                            + dx*rdx - dy*rdy;  w=(w+1)|0;   
                da0[w] = ay + bx*rby + by*rbx
                            + cx*rcy + cy*rcx
                            + dx*rdy + dy*rdx;  w=(w+1)|0;
            }
            }
        }
    }
    
    function floatToString(flt, str)
    {
        var a = Math.abs(flt);
                var str = "";
        if(flt>= 0){str += " ";}
        if(a  < 10){str += " ";}
             return str += flt.toFixed(3);//+" ";
    }
    function prnt1D(dat)
    {
        var str = "";
        for(var i = 0; i < dat.length; ++i)
        {
            str += floatToString(dat[i], str);
        }
        console.log(str);
    }
    function prnt2D(dat,p)
    {
        var sz = 1 << p;
        //if true  then output HTML text
        //if false then output HTML image
        if(true)
        {
            var str = "";
            var r   = 0;
            for(var j = 0; j < sz; ++j)
            {
            for(var i = 0; i < sz; ++i)
            {
            	str += floatToString(dat[r], str);  ++r; //str += " ";
            	str += floatToString(dat[r], str);  ++r;   str += " ";
            }
            str += "\\n";
            }
            str += "\\n";
            var buI = null;
            buI = document.createElement("pre");
            buI.style.margin = "0px";
            buI.style.fontFamily = "inherit";
            buI.style.fontWeight = "normal";
            buI.style.fontSize = "14px";
            buI.innerHTML = str;
            document.body.appendChild(buI);
        }
        else
        {
            var szsz = sz*sz;
            var col = new Uint8ClampedArray(szsz<<2);
            for(var i = 0; i < col.length; ++i){var a = ((dat[i<<1]*.5+.5)*256)|0;
                                                col[(i<<2)+0] = a;
                                                col[(i<<2)+1] = a;
                                                col[(i<<2)+2] = a;
                                                col[(i<<2)+3] = 255;}
            var imdt = new ImageData(col, sz,sz);
            var cnvE = document.createElement("canvas");
                cnvE.width  = sz;
                cnvE.height = sz;
              //cnvE.style.position = "absolute";
              //cnvE.style.border = "0px";
                cnvE.style.margin = "2px";
              //cnvE.style.width  = "128px"; 
              //cnvE.style.height = "128px";
            document.body.appendChild(cnvE);
            var ctx = cnvE.getContext("2d");
                ctx.putImageData(imdt, 0, 0);
            
            for(var i = 0; i < szsz; ++i){var a = ((dat[(i<<1)+1]*.5+.5)*256)|0;
                                          col[(i<<2)+0] = a;
                                          col[(i<<2)+1] = a;
                                          col[(i<<2)+2] = a;
                                          col[(i<<2)+3] = 255;}
                imdt = new ImageData(col, sz,sz);
                cnvE = document.createElement("canvas");
                cnvE.width  = sz;
                cnvE.height = sz;
              //cnvE.style.position = "absolute";
              //cnvE.style.border = "0px";
                cnvE.style.margin = "2px";
              //cnvE.style.width  = "128px"; 
              //cnvE.style.height = "128px";
            document.body.appendChild(cnvE);
                ctx = cnvE.getContext("2d");
                ctx.putImageData(imdt, 0, 0);
        }
    }
    
    var pP = 3;
    
    //1D tests
    var dat0 = new Float64Array((1 << pP)<<1);
    var dat1 = new Float64Array((1 << pP)<<1);
    var dat2 = new Float64Array((1 << pP)<<1);
    for(var i = 0; i < dat0.length; ++i){dat0[i] = (Math.random()*20-10)|0;}
    for(var i = 0; i < dat2.length; ++i){dat2[i] = dat0[i];}
                               prnt1D(dat0);
    dft1D(-1,pP,dat1,dat0);    prnt1D(dat1);
    dft1D(+1,pP,dat0,dat1);    prnt1D(dat0);  console.log("\\n");
    fft1D(-1,pP,dat1,dat2);    prnt1D(dat1);
    fft1D(+1,pP,dat0,dat1);    prnt1D(dat0);
    
    //2D tests
    //var dat0 = new Float64Array(((1 << pP)*(1 << pP))<<1);
    //var dat1 = new Float64Array(((1 << pP)*(1 << pP))<<1);
    //var dat2 = new Float64Array(((1 << pP)*(1 << pP))<<1);
    //for(var i = 0; i < dat0.length; ++i){dat0[i] = Math.random()*2-1;}
    //for(var i = 0; i < dat2.length; ++i){dat2[i] = dat0[i];}
    //                           prnt2D(dat0,pP);
    //dft2D(-1,pP,dat1,dat0);    prnt2D(dat1,pP);
    //dft2D(+1,pP,dat0,dat1);    prnt2D(dat0,pP);
    //fft2D(-1,pP,dat1,dat2);    prnt2D(dat1,pP);
    //fft2D(+1,pP,dat0,dat1);    prnt2D(dat0,pP);`;

        buI = document.createElement("pre");
        buI.style.fontFamily = "inherit";
        buI.style.fontSize = "14px";
        buI.style.margin = "20px 0px 200px 0px";
        buI.style.lineHeight = "100%";
        //buI.style.textAlign = "center";
        buI.innerHTML = `fourier transform javascript code\n`+jvscrptFT;
        document.body.appendChild(buI);

        chngY2D();
        inixy2D();
        rendC9GL();
        requestAnimationFrame(render9dGl);
    }
    function render9aGl()//paint
    {
        if(!paintDo9){return;}          paintDo9 = false;
        if(camStrm9 != null && holdI)  {paintDo9 =  true;}

        rndrStps();
    }
    function copy2D(dest,sorc)
    {
        var xl = fB9z[dest];
        gl.viewport(0,0,xl,xl);
        gl.bindFramebuffer(gl.FRAMEBUFFER, fB9[dest]);
        gl.useProgram(shaderP9f);
        gl.uniform1i(shdTex9f, sorc);
        //gl.uniformMatrix4fv(shdMtx9f, false, shdMtx);
        gl.vertexAttribPointer(shdVtx9f, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx9f);
        gl.drawArrays(gl.TRIANGLES, 0, 3);
    }
    function paint2D(dest,shID)
    {
        var xl = fB9z[dest];

        var n = 12;//12 and 13 are never rendered targets. if() to avoid reading from render target
        var a4  = 4 ; if(a4 ==dest||a4 ==dest+1){a4  = n; ++n;}
        var a5  = 5 ; if(a5 ==dest||a5 ==dest+1){a5  = n; ++n;}
        var a6  = 6 ; if(a6 ==dest||a6 ==dest+1){a6  = n; ++n;}
        var a7  = 7 ; if(a7 ==dest||a7 ==dest+1){a7  = n; ++n;}
        var a8  = 8 ; if(a8 ==dest||a8 ==dest+1){a8  = n; ++n;}
        var a9  = 9 ; if(a9 ==dest||a9 ==dest+1){a9  = n; ++n;}
        var a10 = 10; if(a10==dest||a10==dest+1){a10 = n; ++n;}
        var a11 = 11; if(a11==dest||a11==dest+1){a11 = n; ++n;}

        var s = shs9g[shID];

        shdMtx[ 0] = cam9[camG+0];
        shdMtx[ 1] = cam9[camG+1];
        shdMtx[ 2] = cam9[camG+2];
        shdMtx[ 3] = xl;
        shdMtx[ 4] = inpX9;
        shdMtx[ 5] = inpY9;
        shdMtx[ 6] = inpXd9; inpXd9 = 0;
        shdMtx[ 7] = inpYd9; inpYd9 = 0;
        shdMtx[ 8] = rgba9o[0];
        shdMtx[ 9] = rgba9o[1];
        shdMtx[10] = rgba9o[2];
        shdMtx[11] = rgba9o[3];
        shdMtx[12] = paint9o[0];
        shdMtx[13] = paint9o[1];
        shdMtx[14] = paint9o[2];
        shdMtx[15] = paint9o[3];
        shdMtxB[0] = realAmpl9o[inpX9>>1];

        gl.viewport(0,0,xl,xl);

        shdMtxB[1] = 0;
        gl.bindFramebuffer(gl.FRAMEBUFFER, fB9[dest+0]);
        gl.useProgram(s.shaderP9g);
        gl.uniform1i(s.shdTex9g4 ,a4 );
        gl.uniform1i(s.shdTex9g5 ,a5 );
        gl.uniform1i(s.shdTex9g6 ,a6 );
        gl.uniform1i(s.shdTex9g7 ,a7 );
        gl.uniform1i(s.shdTex9g8 ,a8 );
        gl.uniform1i(s.shdTex9g9 ,a9 );
        gl.uniform1i(s.shdTex9g10,a10);
        gl.uniform1i(s.shdTex9g11,a11);
        gl.uniformMatrix4fv(s.shdMtx9g0, false, shdMtx );
        gl.uniformMatrix4fv(s.shdMtx9g1, false, shdMtxB);
        gl.vertexAttribPointer(s.shdVtx9g, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(s.shdVtx9g);
        gl.drawArrays(gl.TRIANGLES, 0, 3);//resulting real

        shdMtxB[1] = 1;
        gl.bindFramebuffer(gl.FRAMEBUFFER, fB9[dest+1]);
        gl.useProgram(s.shaderP9g);
        gl.uniform1i(s.shdTex9g4 ,a4 );
        gl.uniform1i(s.shdTex9g5 ,a5 );
        gl.uniform1i(s.shdTex9g6 ,a6 );
        gl.uniform1i(s.shdTex9g7 ,a7 );
        gl.uniform1i(s.shdTex9g8 ,a8 );
        gl.uniform1i(s.shdTex9g9 ,a9 );
        gl.uniform1i(s.shdTex9g10,a10);
        gl.uniform1i(s.shdTex9g11,a11);
        gl.uniformMatrix4fv(s.shdMtx9g0, false, shdMtx );
        gl.uniformMatrix4fv(s.shdMtx9g1, false, shdMtxB);
        gl.vertexAttribPointer(s.shdVtx9g, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(s.shdVtx9g);
        gl.drawArrays(gl.TRIANGLES, 0, 3);//resulting imaginary
    }
    function fft2D(dest,sorc,sgn)
    {
        var lt = xy2D-1;
        var xl = 1<<xy2D;
        shdMtx[0] =   xl;
        shdMtx[1] = 1/xl;
        shdMtx[2] = xy2D;
        
        gl.viewport(0,0,xl,xl);

        for(var i = 0; i < 2; ++i)  //which pair RG-BA to read
        {
            gl.bindFramebuffer(gl.FRAMEBUFFER, fB9[4+1]);
            gl.useProgram(shaderP9a);
            gl.uniform1i(shdTex9a0, 12);
            gl.uniform1i(shdTex9a1, sorc+i);
            gl.uniformMatrix4fv(shdMtx9a, false, shdMtx);
            gl.vertexAttribPointer(shdVtx9a, 1, gl.FLOAT, 0, 0, 0);
            gl.enableVertexAttribArray(shdVtx9a);
            gl.drawArrays(gl.TRIANGLES, 0, 3);
            for(var j = 0; j < xy2D; ++j)//2D FFT
            {
                shdMtx[ 8] = 1<<(j+0); //which FFT pass
                shdMtx[ 9] = 1<<(j+1);
                shdMtx[10] = 1/shdMtx[9];
                shdMtx[11] =sgn*shdMtx[10]*PI*2;
                        var r = 4+(j&1);
                if(j == lt){r = dest+i;}
                gl.bindFramebuffer(gl.FRAMEBUFFER, fB9[r]);
                gl.useProgram(shaderP9b);
                gl.uniform1i(shdTex9b, 4+((j+1)&1));
                gl.uniformMatrix4fv(shdMtx9b, false, shdMtx);
                gl.vertexAttribPointer(shdVtx9b, 1, gl.FLOAT, 0, 0, 0);
                gl.enableVertexAttribArray(shdVtx9b);
                gl.drawArrays(gl.TRIANGLES, 0, 3);
            }
            //gl.bindFramebuffer(gl.FRAMEBUFFER, fB9[dest+i]);
            //gl.useProgram(shaderP9c);
            //gl.uniform1i(shdTex9c, p0);
            //gl.uniformMatrix4fv(shdMtx9c, false, shdMtx);
            //gl.vertexAttribPointer(shdVtx9c, 1, gl.FLOAT, 0, 0, 0);
            //gl.enableVertexAttribArray(shdVtx9c);
            //gl.drawArrays(gl.TRIANGLES, 0, 3);
        }
    }
    function rendC9GL()
    {
        if(rndC9){return;}
           rndC9 = true;
        requestAnimationFrame(render9cGl);
    }
    function render9cGl()//render
    {
        rndC9 = false;

        if(textMode != 4)
        {  textMode =  4;
            for(var i = 0; i < 14; ++i)
            {
                gl.activeTexture(gl.TEXTURE0+i);
                gl.bindTexture(gl.TEXTURE_2D, tX9[i]);
            }
            cnvs0.width  = cnvs9aX;
            cnvs0.height = cnvs9aY;
        }

        var xl = 1<<xy2D;

        if(camStrm9 != null)
        {
            gl.activeTexture(gl.TEXTURE0+13);
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, camElem9);
          //gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGBA, gl.UNSIGNED_BYTE, camElem9);
            rnd7Tx9 = true;
            rendC9GL();
        }

        if(rnd7Tx9)
        {  rnd7Tx9 = false;
            
            shdMtx[0] = xl/ldTxSZ9[0];
            shdMtx[1] = xl/ldTxSZ9[1];

            gl.viewport(0, 0, xl, xl);

            shdMtx[2] = 0;
            gl.bindFramebuffer(gl.FRAMEBUFFER, fB9[0]);
            gl.useProgram(shaderP9e);
            gl.uniform1i(shdTex9e, 13);
            gl.uniformMatrix4fv(shdMtx9e, false, shdMtx);
            gl.vertexAttribPointer(shdVtx9e, 1, gl.FLOAT, 0, 0, 0);
            gl.enableVertexAttribArray(shdVtx9e);
            gl.drawArrays(gl.TRIANGLES, 0, 3);

            shdMtx[2] = 1;
            gl.bindFramebuffer(gl.FRAMEBUFFER, fB9[1]);
            gl.useProgram(shaderP9e);
            gl.uniform1i(shdTex9e, 13);
            gl.uniformMatrix4fv(shdMtx9e, false, shdMtx);
            gl.vertexAttribPointer(shdVtx9e, 1, gl.FLOAT, 0, 0, 0);
            gl.enableVertexAttribArray(shdVtx9e);
            gl.drawArrays(gl.TRIANGLES, 0, 3);

            fft2D(2,0,-1);
        }

        render9aGl();
        
        shdMtx[0] = 1/xl;
        shdMtx[1] = cam9[0];
        shdMtx[2] = cam9[1];
        shdMtx[3] = cam9[2];

        shdMtx[4] = cam9[3];
        shdMtx[5] = cam9[4];
        shdMtx[6] = cam9[5];
        shdMtx[7] = 4*cnvs9aY/cnvs9aX;
        //RGBA
        shdMtx[ 8] = rgba9o[0];
        shdMtx[ 9] = rgba9o[1];
        shdMtx[10] = rgba9o[2];
        shdMtx[11] = rgba9o[3];
        //gamma
        shdMtx[12] = 2/(2-bright9o[0])-1;
        shdMtx[13] = bright9o[1];
        shdMtx[14] = realAmpl9o[0];
        shdMtx[15] = realAmpl9o[1];

        gl.viewport(0, 0, cnvs9aX, cnvs9aY);

        //gl.clearColor(.9,.9,.9,1);
        //gl.clearDepth(0);
        //gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        gl.useProgram(shaderP9d);
        gl.uniform1i(shdTex9d0, 0);
        gl.uniform1i(shdTex9d1, 1);
        gl.uniform1i(shdTex9d2, 2);
        gl.uniform1i(shdTex9d3, 3);
        gl.uniformMatrix4fv(shdMtx9d, false, shdMtx);
        gl.vertexAttribPointer(shdVtx9d, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx9d);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        cntx9a.drawImage(cnvs0, 0, 0);
    }
    function render9dGl()//render all 6 textures
    {
        if( textMode != 4.5)
        {   textMode =  4.5;
            for(var i = 0; i < 14; ++i)
            {
                gl.activeTexture(gl.TEXTURE0+i);
                gl.bindTexture(gl.TEXTURE_2D, tX9[i]);
            }
            var pxrt = window.devicePixelRatio;
            var rect = cnvs9b.getBoundingClientRect();
            var xrz = rect.width *pxrt;
            var yrz = rect.height*pxrt;
            cnvs0.width  = xrz;
            cnvs0.height = yrz;
            cnvs9b.width  = xrz;
            cnvs9b.height = yrz;
            gl.viewport(0, 0, xrz, yrz);
        }

        //gl.clearColor(.9,.9,.9,1);
        //gl.clearDepth(0);
        //gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        gl.useProgram(shaderP9k);
        gl.uniform1i(shdTex9k4 , 4);
        gl.uniform1i(shdTex9k5 , 5);
        gl.uniform1i(shdTex9k6 , 6);
        gl.uniform1i(shdTex9k7 , 7);
        gl.uniform1i(shdTex9k8 , 8);
        gl.uniform1i(shdTex9k9 , 9);
        gl.uniform1i(shdTex9k10,10);
        gl.uniform1i(shdTex9k11,11);
        gl.vertexAttribPointer(shdVtx9k, 1, gl.FLOAT, 0, 0, 0);
        gl.enableVertexAttribArray(shdVtx9k);
        gl.drawArrays(gl.TRIANGLES, 0, 3);

        cntx9b.drawImage(cnvs0, 0, 0);
    }

    var PI = 3.1415926535897932384626433832795;
</script>
</body>
</html>
